<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Eunsonny's Blog]]></title><description><![CDATA[Eunsonny's Blog]]></description><link>http://github.com/dylang/node-rss</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 29 Feb 2024 14:38:17 GMT</lastBuildDate><item><title><![CDATA[Yarn Classic에서 Pnpm으로 with TurboRepo]]></title><description><![CDATA[패키지 매니저 전환기]]></description><link>https://eunsonny.github.io/posts/from-yarn-classic-to-pnpm-with-turborepo</link><guid isPermaLink="false">https://eunsonny.github.io/posts/from-yarn-classic-to-pnpm-with-turborepo</guid><pubDate>Sat, 10 Feb 2024 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;해당 글은 동일한 내용으로 &lt;a href=&quot;https://medium.com/wantedjobs/yarn-classic%EC%97%90%EC%84%9C-pnpm%EC%9C%BC%EB%A1%9C-%EC%A0%84%ED%99%98%ED%95%98%EA%B8%B0-with-turborepo-7c0c37cb3f9e&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;회사 블로그&lt;/a&gt;에 기고 되었습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;yarn-classic이-가진-문제&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#yarn-classic%EC%9D%B4-%EA%B0%80%EC%A7%84-%EB%AC%B8%EC%A0%9C&quot; aria-label=&quot;yarn classic이 가진 문제 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Yarn Classic이 가진 문제&lt;/h2&gt;
&lt;p&gt;원티드스페이스 프로젝트는 Turbo Repo를 사용한 모노레포 구조에 패키지 매니저로는 Yarn Classic을 사용하고 있었습니다. Yarn Classic이란 Yarn 1.x 버전을 지칭 하는데요. 성능면에서 다소 느릴 뿐만 아니라 의존성 중복 저장 문제를 호이스팅을 통해 해결하기 때문에 유령 의존성 현상을 야기 할 수 있다는 단점이 존재합니다.&lt;/p&gt;
&lt;p&gt;특히 모노레포 구조에서는 하나의 레포지토리에서 여러 프로젝트의 의존성을 관리해야 하기 때문에 프로젝트가 서로 다른 프로젝트의 의존성에 의존하는 등 더 빈번하고 크리티컬한 유령 의존성 현상이 발생할 수 있습니다. 실제로 원스 프로젝트에서도 &lt;a href=&quot;https://www.npmjs.com/package/depcheck&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;depcheck&lt;/a&gt;를 통해 확인한 결과 다양한 유령 의존성이 존재함을 알 수 있었습니다.&lt;/p&gt;
&lt;h3 id=&quot;유령-의존성-현상이란&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9C%A0%EB%A0%B9-%EC%9D%98%EC%A1%B4%EC%84%B1-%ED%98%84%EC%83%81%EC%9D%B4%EB%9E%80&quot; aria-label=&quot;유령 의존성 현상이란 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;유령 의존성 현상이란&lt;/h3&gt;
&lt;p&gt;과연 이 유령 의존성 현상이란 무엇이며 왜 문제가 되는 것 일까요? 한 번 짚고 넘어가겠습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/071c0fe047ef735845e6762c7d1a89af/8b640/hoisting.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzUlEQVQoz32S22rUUBSG8yTijXe+jBc+hNciaC+sJ/QBvJOiIF5IKVSweFeRgbaItDBlxjJNJjOTNJPDNOdJJqedT5I5YEH8N2uzN+v//7X2QaoB6prZ3ENPfKwswZ77CFGxTNVtNEgWMVfeFWYaYS4iJr7JPA03vAZSXVU0S39wgrb3Cn3vNUH/x5K0Ml0paHb+uMt49yWTz9vYx7sUtbhpuOanlyco7x6i7jwi631fuyCEaKMWS2ExlRl/2mb44Qnpr6+bYuuTSJbm8/Owj23NMf0I042JFwW6rpGkKXEUk+fZpkCSgRnCcJZjxVVrJlbF2g6P9ke8fdCh1zHxQhPD0IijEFmWcRynJWVJgT60cWcB00BhYJzi+jNs2yGKIsIwxPd9qkogWYnCqXlAUExRzk3kc4MiL1uzprsGZ4caz+8f0PlywXv3Hk/lO4zCM7SRwdQ08NxrFPmSPEuRvllv2Brc5sj5yO6zC3YeH+OYHv3fPSzLag2rUrRdlkVFLhIWVUQlyvZe0yxHs3x0O0A1XKSaZlTtrLpdxkEXQfXX49b8D03ecq5RRxOCcI60FqRlxAv1LlvKLaLSWZHFjb/4r2jgeS6jkUqWLfgDlFugPjUToPkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/071c0fe047ef735845e6762c7d1a89af/8ac56/hoisting.webp 240w,
/static/071c0fe047ef735845e6762c7d1a89af/d3be9/hoisting.webp 480w,
/static/071c0fe047ef735845e6762c7d1a89af/e46b2/hoisting.webp 960w,
/static/071c0fe047ef735845e6762c7d1a89af/f992d/hoisting.webp 1440w,
/static/071c0fe047ef735845e6762c7d1a89af/7017d/hoisting.webp 1454w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/071c0fe047ef735845e6762c7d1a89af/8ff5a/hoisting.png 240w,
/static/071c0fe047ef735845e6762c7d1a89af/e85cb/hoisting.png 480w,
/static/071c0fe047ef735845e6762c7d1a89af/d9199/hoisting.png 960w,
/static/071c0fe047ef735845e6762c7d1a89af/07a9c/hoisting.png 1440w,
/static/071c0fe047ef735845e6762c7d1a89af/8b640/hoisting.png 1454w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/071c0fe047ef735845e6762c7d1a89af/d9199/hoisting.png&quot;
            alt=&quot;https://classic.yarnpkg.com/blog/2018/02/15/nohoist/&quot;
            title=&quot;https://classic.yarnpkg.com/blog/2018/02/15/nohoist/&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;왼쪽과 같은 의존성 트리를 가진 프로젝트가 있다고 가정해 보겠습니다. 왼쪽 트리에서 &lt;strong&gt;[A (1.0)]&lt;/strong&gt; 과 &lt;strong&gt;[B (1.0)]&lt;/strong&gt; 을 두 번 설치 하는 것은 디스크 공간 측면에서 비효율적입니다. 따라서 Npm(ver 3~), Yarn Classic은 호이스팅 &amp;#x26; 병합을 통해 오른쪽 트리와 같이 평탄화(flat) 된 종속성 트리로 모양을 바꿉니다. (놀랍게도 Npm ver 2 까지는 모든 의존성을 중복 설치했다고 합니다.) 이를 통해 디스크 공간을 절약하고 트리 경로 깊이 내려가지 않아도 최상위에서 원하는 의존성을 탐색할 수 있게 되므로 보다 효율적입니다.&lt;/p&gt;
&lt;p&gt;그러나 이로 인해 프로젝트에서 직접 의존하고 있지 않은 패키지(위의 이미지 상에서는 [B (1.0)]에 해당)를 암묵적으로 참조하게 되는 경우가 발생합니다. 이것이 바로 유령 의존성 현상입니다. 이처럼 유령 의존성 현상이 발생하면 어떠한 의존성 파일을 지웠을 때 암묵적으로 참조 했던 패키지도 삭제될 수 있는 등 의존성 트리의 유효성을 보증 받기 어렵습니다.&lt;/p&gt;
&lt;h2 id=&quot;why-pnpm&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#why-pnpm&quot; aria-label=&quot;why pnpm permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Why Pnpm?&lt;/h2&gt;
&lt;p&gt;앞서 언급한 문제점을 해결할 수 있는 방법으로는 크게 두 가지가 있습니다. 바로 Yarn Berry와 Pnpm 입니다. Yarn Berry 에서는 Plug’n’Play 전략을 통해 종속성 중복 저장 문제를 해결하며 호이스팅을 사용하지 않는 &lt;code class=&quot;language-text&quot;&gt;nohoist&lt;/code&gt;가 기본 값입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bf5603ebacd4925c3266c6a8ab8405f0/80cfc/turborepo-pnp.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/UlEQVQY00XQW3KFIBAEUPe/xuQjCigib1EIQqccb5mPUz3FmxmWVeOba3yNEuNiMeudLCYRd1zEpgq71yff+sIWMtjqodwJHSuGzXgwISGEwLwsUEpBSol1VViVgtYa26bhvUcIAc57WGspnXMwxtC64B1dPKTSIJWmCa0f9wHGWHLX94ac80ehLKWgtfYCOsLZMJwVUNpimhjGj59xAmOcxibGIcQMzgW4EGBc0LiYF4QQiQ8BMQZqw3CU/nzBbNiUhFEK3jtyv/pICegNvV1v9vbkddVHreitwt9fDueF1SbsZ0FMGSFmpF/g+EilI+aGPbc3//V/pVMP/wBW3cs2T/RNLAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/bf5603ebacd4925c3266c6a8ab8405f0/8ac56/turborepo-pnp.webp 240w,
/static/bf5603ebacd4925c3266c6a8ab8405f0/d3be9/turborepo-pnp.webp 480w,
/static/bf5603ebacd4925c3266c6a8ab8405f0/e46b2/turborepo-pnp.webp 960w,
/static/bf5603ebacd4925c3266c6a8ab8405f0/f992d/turborepo-pnp.webp 1440w,
/static/bf5603ebacd4925c3266c6a8ab8405f0/5540a/turborepo-pnp.webp 1844w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/bf5603ebacd4925c3266c6a8ab8405f0/8ff5a/turborepo-pnp.png 240w,
/static/bf5603ebacd4925c3266c6a8ab8405f0/e85cb/turborepo-pnp.png 480w,
/static/bf5603ebacd4925c3266c6a8ab8405f0/d9199/turborepo-pnp.png 960w,
/static/bf5603ebacd4925c3266c6a8ab8405f0/07a9c/turborepo-pnp.png 1440w,
/static/bf5603ebacd4925c3266c6a8ab8405f0/80cfc/turborepo-pnp.png 1844w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/bf5603ebacd4925c3266c6a8ab8405f0/d9199/turborepo-pnp.png&quot;
            alt=&quot;https://github.com/vercel/turbo/issues/693#issuecomment-1278886166&quot;
            title=&quot;https://github.com/vercel/turbo/issues/693#issuecomment-1278886166&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;그러나 원티드스페이스 프로젝트는 Turbo Repo로 구성 되어 있고 Turbo Repo에서는 Yarn Berry의 PnP를 지원하지 않기 때문에 실질적인 선택지는 Pnpm 하나 뿐 이였습니다. 하지만 Pnpm은 Npm 또는 Yarn Classic과 비교 했을 때 더 좋은 성능과 보안을 제공 하므로 객관적으로도 매력적인 옵션이라고 생각합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fac09b61cb47b5beb19da1182c192064/93582/benchmark.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 106.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAACTUlEQVQ4y6WUXU/UQBSG92cSr7zx3p9gvDFGjXjnhbfGxHhjSGBZPhKUZGEVypdAAInswnbbbrdQ+t3OPGamXbKQYExpctJ35pzz5syZd05DSon6goHN5dk21vCUnb5P9zLlX58Acikp9L/EQggaY8IizRBXIfgx2dAlsQfkoxHpcEhsW2SuSz5yiSxL7yWOw3X/QpvaCwcmSRTSkKIgySUXu6usvZpi8+0UzqdnuK153NYc7vwcw+YsbqupTeP5OUatpjYVo/Fii9z3VYXlEXa7Ds+bG6yd7CIyFzlxvPvw3bU+cpam9Ac2+2tLHPfsG2dRFCAlUghEhZUprPbu+jRWhGmaEscRPdNkxTgi8LwqUZQVVM2erGLc90nfGDdU0UGc0TWWMT68wNnau0msRSiERBY5W6fnzPw4JPAihDciT5J6hFIKrSNzv4Mx/Yit909xmrOkA7MMrHrz/xVWTuOPxeuZVVaNDsnVFUpO9SqsdHi+12b9zWPsrx/xFhbIr/2ahFXgr57NrNEhzMJSNnUvRenQuw45/bnE8V4HK0FfUu1bVjrMsgzT6rN0cIxh+qUO6xLGUcTQu6S706bXN6v39ABCWT2n3sDk22+XTDyQMIkj4kxgH6xz8n0ax++XiUVN2eR5rt+t6Vg02ytsHx4h46R+hVROe7/NzrsndL98Jtjc0BNZT5F7COUd30QPy8CNswEvF9v0g/iWDicHxTjx1jycWCvcUJIp8pwoKUjVaCsKkiTRptpRjrdYY2VBEBBFkd5TWJmKDcNQ47/mzVYE5R8pogAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/fac09b61cb47b5beb19da1182c192064/8ac56/benchmark.webp 240w,
/static/fac09b61cb47b5beb19da1182c192064/d3be9/benchmark.webp 480w,
/static/fac09b61cb47b5beb19da1182c192064/e46b2/benchmark.webp 960w,
/static/fac09b61cb47b5beb19da1182c192064/f992d/benchmark.webp 1440w,
/static/fac09b61cb47b5beb19da1182c192064/bc816/benchmark.webp 1524w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/fac09b61cb47b5beb19da1182c192064/8ff5a/benchmark.png 240w,
/static/fac09b61cb47b5beb19da1182c192064/e85cb/benchmark.png 480w,
/static/fac09b61cb47b5beb19da1182c192064/d9199/benchmark.png 960w,
/static/fac09b61cb47b5beb19da1182c192064/07a9c/benchmark.png 1440w,
/static/fac09b61cb47b5beb19da1182c192064/93582/benchmark.png 1524w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/fac09b61cb47b5beb19da1182c192064/d9199/benchmark.png&quot;
            alt=&quot;https://pnpm.io/benchmarks&quot;
            title=&quot;https://pnpm.io/benchmarks&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;또한 Pnpm은 Npm과 사용법이 비슷하며 마이그레이션 과정이 단순하다는 점도 장점이라 생각되었습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;결론적으로 Pnpm을 선택한 이유를 정리해보자면 다음과 같습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;유령 의존성 문제를 해결하면서 현재 사용하고 있는 Turbo Repo와의 궁합이 가장 좋은 조합&lt;/li&gt;
&lt;li&gt;기존에 사용하던 Yarn Classic과 비교해 설치와 실행이 빠르고 더 나은 보안성을 제공함&lt;/li&gt;
&lt;li&gt;Npm과 사용법이 비슷하며 (Yarn Berry와 비교하여) 마이그레이션 과정이 단순함&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;pnpm이-종속성-중복-저장-문제를-해결하는-방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#pnpm%EC%9D%B4-%EC%A2%85%EC%86%8D%EC%84%B1-%EC%A4%91%EB%B3%B5-%EC%A0%80%EC%9E%A5-%EB%AC%B8%EC%A0%9C%EB%A5%BC-%ED%95%B4%EA%B2%B0%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;pnpm이 종속성 중복 저장 문제를 해결하는 방법 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Pnpm이 종속성 중복 저장 문제를 해결하는 방법&lt;/h3&gt;
&lt;p&gt;그렇다면 Pnpm은 어떤 방법으로 종속성 중복 저장 문제를 해결하고 유령 의존성을 없애는 것 일까요? Pnpm은 호이스팅 대신 &lt;a href=&quot;https://pnpm.io/next/symlinked-node-modules-structure&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Content-addressable Store&lt;/a&gt; 방식을 통해 중복 의존성 저장 문제를 해결합니다. 전역 스토어에 종속성을 설치한 다음 심볼릭 링크와 하드링크를 사용하여 디렉터리 구조를 구성하는 방식인데요 좀 더 자세히 살펴보자면 다음과 같습니다.&lt;/p&gt;
&lt;p&gt;처음 Pnpm은 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;home dir&gt;/.pnpm-store&lt;/code&gt;에 종속성을 설치합니다. 이곳이 전역 스토어 이며 모든 종속성 버전은 해당 폴더에 물리적으로 한번만 저장 됩니다.&lt;/p&gt;
&lt;p&gt;그런 다음 프로젝트에서 필요한 패키지를 프로젝트의 최상위 &lt;code class=&quot;language-text&quot;&gt;node_modules/.pnpm&lt;/code&gt; 경로에 &lt;a href=&quot;https://pnpm.io/faq#why-does-my-node_modules-folder-use-disk-space-if-packages-are-stored-in-a-global-store&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;하드링크&lt;/a&gt;합니다. 여기서 말하는 필요한 패키지란 &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt;에 나열되어 프로젝트에서 직접적으로 의존하는 의존성 뿐만 아니라 의존성의 의존성까지 포함합니다. 이렇게 필요한 모든 종속성은 &lt;code class=&quot;language-text&quot;&gt;node_modules/.pnpm&lt;/code&gt;디렉터리 아래에 평탄화 되어 위치합니다. 이후 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;의 최상위 종속성(프로젝트에서 직접적으로 의존하는 패키지를 의미합니다.)과 의존성의 의존성들을 평탄화 되지 않은 형태로 중첩되어(nested) 존재하며&lt;code class=&quot;language-text&quot;&gt;node_modules/.pnpm&lt;/code&gt;에 위치한 것들과 Symbolic Link로 연결됩니다.&lt;/p&gt;
&lt;p&gt;예시로 &lt;code class=&quot;language-text&quot;&gt;demo-foo@ 1.0.1&lt;/code&gt; 과 &lt;code class=&quot;language-text&quot;&gt;demo-baz@ 1.0.0&lt;/code&gt;에 의존성을 가지는 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;의 구조를 그려본다면 다음과 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 679px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6adab39ad40422e047187c415018f43b/1b747/pnpm-dependency-tree.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABv0lEQVQ4y4VT2ZKCQBBzPfDACxCY4RIEOUT9/7/rrUSHcqtcfUjNMAzpTtKM1putHPxAXO8gfhDKyl7LfLGUxXLF1exf8e7MYLTbO5IXJ7nebhIq9YfwP3wktOaPLuIklbI6S103cq5r0VEsM2s+YDqzuL52/5bQyEJnSkfStC0JQ6Vlu9tLEIaEjiKe2evN5w4NWRQncswLabtOqvOZvuJjWALiveNyv1zZ3wmt+YIPURxL23YECmy2O/EOPoHAUOSbx6NXudkxl667PCUrdui4HjvDFDiuy4/gJZqYWQuuj/3jbPAQkorTiZLrpmG3uIB3GC2QGwv2joH7xGOPewPheDLloSFEAAgjzTK59L3c7nfpr1c+K61pCYCwUDxJUqogIYzGRcyjSRlkkAcfscIWAOOD4j/AeMo9n8cTvhtCgZw0zRgISDGHKAQgFFT3gOceIZmg/CCQIFS0Y2SGFOyQDDKMDS4cfF+SNOOwd5cLrUAhhPNKCAyEtr2WNDvSu+JUMtVjnvNXhGcg6vsrizRNK2VZsWheFLSmrCpxPY+ymTIkQQIqYIV0rFpHQzBKaX5kOsGIoTuEA7kYfDObv3xHUsVET5AdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/6adab39ad40422e047187c415018f43b/8ac56/pnpm-dependency-tree.webp 240w,
/static/6adab39ad40422e047187c415018f43b/d3be9/pnpm-dependency-tree.webp 480w,
/static/6adab39ad40422e047187c415018f43b/8fbda/pnpm-dependency-tree.webp 679w&quot;
              sizes=&quot;(max-width: 679px) 100vw, 679px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/6adab39ad40422e047187c415018f43b/8ff5a/pnpm-dependency-tree.png 240w,
/static/6adab39ad40422e047187c415018f43b/e85cb/pnpm-dependency-tree.png 480w,
/static/6adab39ad40422e047187c415018f43b/1b747/pnpm-dependency-tree.png 679w&quot;
            sizes=&quot;(max-width: 679px) 100vw, 679px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/6adab39ad40422e047187c415018f43b/1b747/pnpm-dependency-tree.png&quot;
            alt=&quot;pnpm-dependency-tree&quot;
            title=&quot;pnpm-dependency-tree&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;아직도 감이 안오신다면 다음은 프로젝트 구조에서 심볼릭 링크와 하드 링크가 어떻게 구성되는지 더 잘 이해할 수 있도록 도와주는 이미지입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 684px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e282a6400e52669f3fc40155025eef19/2c288/pnpm-work.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVQoz22SPZMTMQyG9///GSoqigMKhiEcDUdCkeQgcdbfluz1euleRk72CAzFO/JI1iPJ1kDTjFVcG0wgnLTDWXsELsi1db/Y+7v/im/xgdeEeXmRCamDbcq4JIaKBMcF693/aYUOPs+IZYb2sUOoNgRijC7ApoLIhEAJx9HARkKkgsQFR2XxeXvEl90zdODeSO9Q0wzHFcp46JC6U4LaE84mwDgHqw5wRuOn0nDGw1uP7eGMh80W7x53ONuIsgIFFnLFeOuQBVgbLi5CmQDPE6Z5gYsKhrjHprbgaX/Cqzcf8PrtBspFlHYDGq7weYIyDjpEcJ27aKowUbr0UDbgZBR8lk+aUVrD9+cRD5tveP+4uwFbzxvKLB/SMC1Lr7ICxZfK1J9BgD+0BRHDh4hEhP3J4OPXPT49HTAG+gNcAfcSmMDF5rb0YjKmvJP4Jfm6LrXrmnPNHUjGuxPXisiMi/XwlJE4w4YESwydIi7OwybqoHQDipVp5DzU5Rf+1vKyNvIck1QuFblOSGygjO0r5iJdC8XU10lsygW/AWMc9DCSjtKoAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/e282a6400e52669f3fc40155025eef19/8ac56/pnpm-work.webp 240w,
/static/e282a6400e52669f3fc40155025eef19/d3be9/pnpm-work.webp 480w,
/static/e282a6400e52669f3fc40155025eef19/e213b/pnpm-work.webp 684w&quot;
              sizes=&quot;(max-width: 684px) 100vw, 684px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/e282a6400e52669f3fc40155025eef19/8ff5a/pnpm-work.png 240w,
/static/e282a6400e52669f3fc40155025eef19/e85cb/pnpm-work.png 480w,
/static/e282a6400e52669f3fc40155025eef19/2c288/pnpm-work.png 684w&quot;
            sizes=&quot;(max-width: 684px) 100vw, 684px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/e282a6400e52669f3fc40155025eef19/2c288/pnpm-work.png&quot;
            alt=&quot;pnpm-work&quot;
            title=&quot;pnpm-work&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;결과적으로 모든 종속성은 전역 스토어에 물리적으로 한번만 저장되어 단일한 진실 공급원(**Single Source Of Truth)**를 구성하고 이를 통해 디스크 공간을 크게 절약합니다. 또한 &lt;code class=&quot;language-text&quot;&gt;node_modules/.pnpm&lt;/code&gt;디렉터리 아래에 하드링크된 의존성들을 평탄화 하여 위치 시킴으로써 유령 의존성 문제와 &lt;a href=&quot;https://rushjs.io/pages/advanced/npm_doppelgangers/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Npm 도플갱어 문제&lt;/a&gt;를 해결합니다.&lt;/p&gt;
&lt;h2 id=&quot;pnpm-도입-과정&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#pnpm-%EB%8F%84%EC%9E%85-%EA%B3%BC%EC%A0%95&quot; aria-label=&quot;pnpm 도입 과정 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Pnpm 도입 과정&lt;/h2&gt;
&lt;p&gt;자 그럼 실질적인 Pnpm 도입 과정에 대해서 설명하겠습니다. 원스 프로젝트는 Turbo Repo로 구성한 모노레포에 Pnpm을 도입하였으므로 이를 참고해주세요!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;npm install -g pnpm&lt;/code&gt; 을 통해 Pnpm을 전역으로 설치 합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pnpm의 workspace 기능을 사용하면 모노레포를 지원할 수 있습니다. 모노레포 프로젝트의 루트에 &lt;a href=&quot;https://pnpm.io/pnpm-workspace_yaml&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;pnpm-workspace.yaml&lt;/a&gt; 파일을 생성하고 workspace를 선언합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token literal-property property&quot;&gt;packages&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;docs&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;apps/*&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;packages/*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;App에서 workspace package들을 별칭으로 참조할 수 있도록 apps 내부 프로젝트의 package.json 파일을 수정합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// root/apps/dashboard/package.json&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token string-property property&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&quot;@wantedspace-inc/api&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;workspace:*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&quot;@wantedspace-inc/constants&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;workspace:*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&quot;@wantedspace-inc/css&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;workspace:*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&quot;@wantedspace-inc/hooks&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;workspace:*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&quot;@wantedspace-inc/icons&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;workspace:*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;프로젝트의 루트에 &lt;code class=&quot;language-text&quot;&gt;.npmrc&lt;/code&gt; 파일을 생성하여 추가적인 설정을 해줄 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.npmrc&lt;/code&gt;에서 &lt;code class=&quot;language-text&quot;&gt;node-linker=hoisted&lt;/code&gt; 옵션을 사용하면 Yarn Classic과 같은 방식으로, &lt;code class=&quot;language-text&quot;&gt;node-linker=pnp&lt;/code&gt;로 사용하면 Plug’n’Play 방식으로 사용할 수 있습니다. 다만 저는 추가적인 세팅이 필요하지 않아 &lt;code class=&quot;language-text&quot;&gt;.npmrc&lt;/code&gt; 파일을 생성하지 않았습니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;모든 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;와 캐시를 삭제하고 &lt;code class=&quot;language-text&quot;&gt;pnpm install&lt;/code&gt; 명령어를 통해 의존성들을 재설치 한 뒤 로컬에서 App이 잘 실행되는지 확인합니다. 기존에 유령 의존성 문제가 존재하지 않았다면 프로젝트가 로컬에서 잘 실행이 되었겠지만 저의 상황은 그렇지 못했습니다. 유령 의존성으로 인한 각종 에러메세지와 만나게 되었습니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;프로젝트 내에 존재하는 유령 의존성을 좀 더 쉽고 빠르게 찾기 위해 &lt;a href=&quot;https://www.npmjs.com/package/depcheck&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;depcheck&lt;/a&gt;를 이용했습니다. &lt;code class=&quot;language-text&quot;&gt;depcheck&lt;/code&gt;는 프로젝트의 종속성들을 분석하여 불필요한 종속성, 유령 의존성 등을 찾아주는 툴 입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f4b8b43fbc97e75bfb037060131d9efa/74d4a/depcheck.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.58333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYElEQVQ4y62TWW+DMBCEOZVTUSAJYHPZHCH0pf//10012xq1VVURtQ8jE7A/z+5svNbOGKdXmO4FSvcodA9rJlT1gFxZKN2hUBZZ3vwq7jd2gpemCUqtEMcRPM/7uy6XC4yxUEojDCP4QYBAFMoahiF8318B89/3pWmKsixhjEHXdajrWp6ptm3l2263Ww7yUPBx6Y8X0SEhhN3vdwzDgGma8Hg8RH3fy/umaaC1xvl8xvF4xOl0+nLRoiRJZCOBhHGlCMjzHFmWoSgK2UMRttlsBBbH8c8OeZglWmsFSsjhcEAURdJDiiWuCuV2u4kj1y9X9jzP4sy5IXQV8Hq9LjCCxnEUt7yIsM8hrAIy5aqqlpLZ0/1+L67cyvK32+16h0yZLhkC0/uHwTYSDJ3ytxsJOmQwTwE5VwRx3ujQ9c3paYfsIWEsmaGwjxwbglcn+x3IsXF/NT4zaQ4xS34W+AZLx1PJ+o8OVAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/f4b8b43fbc97e75bfb037060131d9efa/8ac56/depcheck.webp 240w,
/static/f4b8b43fbc97e75bfb037060131d9efa/d3be9/depcheck.webp 480w,
/static/f4b8b43fbc97e75bfb037060131d9efa/e46b2/depcheck.webp 960w,
/static/f4b8b43fbc97e75bfb037060131d9efa/f992d/depcheck.webp 1440w,
/static/f4b8b43fbc97e75bfb037060131d9efa/882b9/depcheck.webp 1920w,
/static/f4b8b43fbc97e75bfb037060131d9efa/93fa3/depcheck.webp 2422w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/f4b8b43fbc97e75bfb037060131d9efa/8ff5a/depcheck.png 240w,
/static/f4b8b43fbc97e75bfb037060131d9efa/e85cb/depcheck.png 480w,
/static/f4b8b43fbc97e75bfb037060131d9efa/d9199/depcheck.png 960w,
/static/f4b8b43fbc97e75bfb037060131d9efa/07a9c/depcheck.png 1440w,
/static/f4b8b43fbc97e75bfb037060131d9efa/29114/depcheck.png 1920w,
/static/f4b8b43fbc97e75bfb037060131d9efa/74d4a/depcheck.png 2422w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/f4b8b43fbc97e75bfb037060131d9efa/d9199/depcheck.png&quot;
            alt=&quot;depcheck&quot;
            title=&quot;depcheck&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;의존성 분석 결과를 참고하여 유령 의존성은 설치하거나 적절한 의존성을 사용할 수 있도록 수정해주고 불필요한 의존성은 삭제합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Resolution 등 의존성과 관련해 설정한 것들이 있다면 이 역시 Pnpm 환경에서 적용될 수 있도록 잘 이관해줍니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;원스 프로젝트는 Amplify Preview를 스테이징 환경으로 사용 하는데요. 여기서 약간의 문제가 있었습니다. Pnpm은 심볼릭 링크를 지원하지 않는 환경에서는 동작하지 않습니다. 따라서 lambda와 같은 서버리스 호스팅 환경이나 Electron App에서는 사용할 수 없습니다. 관련한 이슈를 &lt;a href=&quot;https://github.com/orgs/nodejs/discussions/37509&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;여기&lt;/a&gt;에서 확인할 수 있으며 Pnpm 공식문서에서는 다음과 같은 경우 &lt;a href=&quot;https://pnpm.io/npmrc#node-linker&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;node-linker=hoisted 옵션을 사용해 해결&lt;/a&gt;할 것을 권장합니다. AWS에서도 &lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/amplify/latest/userguide/monorepo-configuration.html#turborepo-pnpm-monorepo-configuration&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Turborepo 및 pnpm 모노레포 앱 구성&lt;/a&gt;과 관하여 같은 해결책을 제안합니다.&lt;/p&gt;
&lt;p&gt;그러나 &lt;code class=&quot;language-text&quot;&gt;node-linker=hoisted&lt;/code&gt; 옵션을 사용한다는 것은 호이스팅을 이용해 중복 종속성을 해결한다는 뜻이고 이는 Pnpm으로 전환한 의미가 퇴색된다고 생각했습니다. 뿐만 아니라 실제 프로덕션 빌드 시에는 Github Action를 사용하고 있었기 때문에 &lt;code class=&quot;language-text&quot;&gt;node-linker=hoisted&lt;/code&gt;를 사용하지 않고도 정상적으로 배포가 가능한 상황이였습니다.&lt;/p&gt;
&lt;p&gt;따라서 프로젝트 루트에 &lt;code class=&quot;language-text&quot;&gt;.npmrc&lt;/code&gt;를 생성해 호이스팅 설정을 하는 대신 Amplify 빌드 설정에 &lt;code class=&quot;language-text&quot;&gt;echo &quot;node-linker=hoisted&quot; &gt; .npmrc&lt;/code&gt; 명령어를 추가했습니다. Amplify 빌드 설정을 담고 있는&lt;code class=&quot;language-text&quot;&gt;amplify.yml&lt;/code&gt;의 전체 내용은 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token literal-property property&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token literal-property property&quot;&gt;applications&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; frontend&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;phases&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;preBuild&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token literal-property property&quot;&gt;commands&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; npm install &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;g pnpm
            &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; cd &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; echo &lt;span class=&quot;token string&quot;&gt;&quot;$PWD&quot;&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; echo &lt;span class=&quot;token string&quot;&gt;&quot;node-linker=hoisted&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;npmrc
            &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; pnpm install &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;no&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;frozen&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;lockfile
        &lt;span class=&quot;token literal-property property&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token literal-property property&quot;&gt;commands&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; echo &lt;span class=&quot;token string&quot;&gt;&quot;$PWD&quot;&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; $&lt;span class=&quot;token constant&quot;&gt;NODE_ENV_VARIABLES&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;.env.development&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; then cat &lt;span class=&quot;token string&quot;&gt;&quot;./$AMPLIFY_MONOREPO_APP_ROOT/$NODE_ENV_VARIABLES&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./$AMPLIFY_MONOREPO_APP_ROOT/.env.production&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; fi
            &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; pnpm run &lt;span class=&quot;token string&quot;&gt;&quot;build:$AMPLIFY_MONOREPO_APP&quot;&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;artifacts&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;baseDirectory&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; build
        &lt;span class=&quot;token literal-property property&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;**/*&apos;&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; node_modules&lt;span class=&quot;token comment&quot;&gt;/**/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;appRoot&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; apps&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;dashboard&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Amplify Preview 에서 정상적으로 잘 빌드 되는 것을 확인할 수 있었습니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;이후 프로덕션 빌드를 수행하는 Github Action에서 Pnpm install cache를 사용할 수 있도록 workflow를 변경하였습니다. &lt;a href=&quot;https://github.com/pnpm/action-setup&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;pnpm/action-setup&lt;/a&gt; 플러그인 레포지토리에 사용방법이 친절하게 나와 있으며 코드는 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Install pnpm
  &lt;span class=&quot;token literal-property property&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; pnpm&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;action&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;setup@v2
  &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;run_install&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Get pnpm store directory
  &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; pnpm&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;store&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;dir&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;path
  &lt;span class=&quot;token literal-property property&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; bash
  &lt;span class=&quot;token literal-property property&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
    echo &lt;span class=&quot;token string&quot;&gt;&quot;STORE_PATH=$(pnpm store path --silent)&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; $&lt;span class=&quot;token constant&quot;&gt;GITHUB_ENV&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Setup pnpm cache
  &lt;span class=&quot;token literal-property property&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; actions&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cache@v3
  &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; pnpm&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;cache
  &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;STORE_PATH&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; runner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;os &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;pnpm&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;$&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hashFiles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;**/pnpm-lock.yaml&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    restore&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;keys&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
      $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; runner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;os &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;pnpm&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;store&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Install dependencies
  &lt;span class=&quot;token literal-property property&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; pnpm install &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;no&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;frozen&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;lockfile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;도입-후-결과&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%8F%84%EC%9E%85-%ED%9B%84-%EA%B2%B0%EA%B3%BC&quot; aria-label=&quot;도입 후 결과 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;도입 후 결과&lt;/h2&gt;
&lt;p&gt;이 후 얼마간의 테스트 기간을 거쳐 프로덕션 배포를 성공적으로 진행하였습니다.&lt;/p&gt;
&lt;p&gt;Pnpm 마이그레이션 이전과 이후의 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt; 크기를 비교해 보았을 때 다소 늘어난 것을 확인할 수 있었는데요. 유령 의존성을 직접 의존할 수 있도록 설치한 점, 모노레포 내 프로젝트에서 같은 라이브러리의 서로 다른 버전 사용하는 점 등이 영향을 미쳤을 것으로 예상되어 관련한 최적화 작업을 진행할 계획입니다.&lt;/p&gt;
&lt;p&gt;모노레포 내의 A 프로젝트에서는 React 17을 B 프로젝트에서는 React 18을 사용한다고 가정할 경우, &lt;code class=&quot;language-text&quot;&gt;node_modules/.pnpm&lt;/code&gt;에는 React 17과 18이 모두 나열되고 공간을 차지하게 되어 디스크 공간 측면에서 비효율적입니다. 따라서 가능하다면 프로젝트에서 공통으로 사용하는 의존성들은 같은 버전으로 맞춰주는 것이 이상적인데요. 이 경우 &lt;a href=&quot;https://jamiemason.github.io/syncpack/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;syncpack&lt;/a&gt;을 사용하면 각 프로젝트에서 일치 하지 않는 의존성 버전을 분석해주고 autofix 기능도 제공해주니 사용을 고려해볼 수 있겠습니다.&lt;/p&gt;
&lt;p&gt;또한 속도 면에서는 Amplify Preview에서는 의존성 설치 시간이 Done in 74.52s → Done in 25.1s 정도로 약 3배 정도 단축 되었으며, Github action에서는 평균적으로 45~50초 정도 걸리던 설치 시간이 25-30초 정도로 줄어드는 등 개선이 이뤄진 것을 확인할 수 있었습니다.&lt;/p&gt;
&lt;p&gt;추가적으로 Pnpm과 직접적 연관이 있는 것은 아니나 Turbo Repo를 사용하면서 빌드 툴로 Github Action을 사용하고 있다면 Vercel의 Remote Cache를 사용하지 않아도 &lt;a href=&quot;https://turbo.build/repo/docs/ci/github-actions#caching-with-github-actionscache&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;github actions/cache를 사용하여 CI 단계별 캐싱&lt;/a&gt;을 적용해 빌드 속도를 개선할 수 있는 여지도 있습니다. 참고 사항으로 언급해두겠습니다.&lt;/p&gt;
&lt;p&gt;마지막으로 저는 과거 다른 프로젝트에서 Yarn Classic → Yarn Berry(PnP)으로 전환한 경험이 있는데요. 당시 &lt;code class=&quot;language-text&quot;&gt;node_module&lt;/code&gt;을 사용하지 않고 의존성을 &lt;code class=&quot;language-text&quot;&gt;.zip&lt;/code&gt; 포맷으로 저장하는 Yarn Berry PnP의 특성상 IDE에서 zip 파일로 된 종속성을 읽어올 수 있도록 추가적인 세팅이나 extension을 설치하는 과정이 다소 번거롭게 느껴졌었습니다. 이에 반해 Pnpm으로 변환하는 과정은 보다 단순하여 편리하다는 생각이 들었습니다.&lt;/p&gt;
&lt;p&gt;또한 Pnpm을 통해 모노레포 환경에서 엄격한 의존성 관리가 가능하게 되어, 특히 Turbo Repo를 사용하고 있다면 적극 추천하는 선택지이며 Turbo Repo를 사용하지 않더라도 한 번 쯤 도입을 고려해볼만한 매력적인 기술인 것 같습니다.&lt;/p&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;h3 id=&quot;별책부록&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%B3%84%EC%B1%85%EB%B6%80%EB%A1%9D&quot; aria-label=&quot;별책부록 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;별책부록&lt;/h3&gt;
&lt;p&gt;위에 내용까지가 회사 블로그에 기고한 내용이고 이 곳에는 나만의 별책부록을 작성해본다. 이 글을 작성하기 위해서 각종 자료와 공식문서를 꼼꼼히 찾아 읽고 Pnpm뿐만 아니라 YarnBerry와 Yarn, Npm까지 패키지 매니저의 동작방식에 대해서 더 잘 이해할 수 있게 되었다. 역시 글로 정리하면서 더 많이 배운다.&lt;/p&gt;
&lt;p&gt;패키지 매니저를 비교한 글들을 읽다보면 Npm(Ver 3-), Yarn Classic에서 평탄화된 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;라는 말이 자주 등장하는데, Pnpm 관련 글을 읽으면서도 자꾸 평탄화 언급이 나와서 처음에는 무슨 차이인지 다소 햇갈렸다. 하지만 핵심만 살펴보자면 다음과 같다.&lt;/p&gt;
&lt;p&gt;Npm과 Yarn Classic은 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;를 직접적인(물리적인) 저장소로 사용하며 이를 효율적으로 사용하기 위해 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;’&lt;strong&gt;를&lt;/strong&gt;’ 평탄화 한다. 그러나 Yarn Berry나 Pnpm은 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;를 직접적인 저장소로 사용하지 않고 따로 저장소를 둔다. Yarn Berry나 Pnpm은 저장소를 따로 둔 대신 중첩된 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;를 가진다 대신 저장소를 평탄화 하는데 이것이 핵심이다. 좀 더 정확히 말하자면 Yarn Berry P’n’P에서는 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt; 자체를 없애고 &lt;code class=&quot;language-text&quot;&gt;.pnp.cjs&lt;/code&gt;로 대체하는데 &lt;code class=&quot;language-text&quot;&gt;.pnp.cjs&lt;/code&gt; 파일에 중첩된 형태의 의존성 트리를 기술해놓는다. 그리고 Yarn Berry는 인터페이스 링커를 Pnpm은 하드링크와 심볼링 링크를 이용해 저장소와 &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;를 연결해서 사용하는 것이다.&lt;/p&gt;
&lt;p&gt;따라서 마지막으로 링커에 대해 설명하고 이 글을 마무리 하려고 한다.&lt;/p&gt;
&lt;h4 id=&quot;링커란&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%A7%81%EC%BB%A4%EB%9E%80&quot; aria-label=&quot;링커란 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;링커란?&lt;/h4&gt;
&lt;p&gt;링커는 서로 다른 소프트웨어 컴포넌트나 시스템 간의 인터페이스를 연결하는 역할을 하는 소프트웨어나 도구를 가리킵니다.&lt;/p&gt;
&lt;p&gt;하드링크와 심볼릭 링크(심볼릭 링크를 흔히 “심볼릭 링크” 또는 “소프트링크”라고 부릅니다)는 파일 시스템에서 파일이나 디렉토리를 참조하는 두 가지 주요 방법입니다. 이러한 링크는 운영 체제의 파일 관리에서 중요한 역할을 하며, 사용자가 파일이나 디렉토리에 대한 다양한 경로나 이름으로 접근할 수 있게 해줍니다. 하드링크와 심볼릭 링크는 기능적으로 다르며, 각각의 특성을 아래에서 설명합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;하드링크&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;하드링크는 파일의 실제 위치를 가리키는 포인터입니다. 하드링크를 생성하면, 원본 파일과 같은 파일 시스템 내의 데이터 블록을 참조하는 새로운 디렉토리 엔트리가 만들어집니다.&lt;/li&gt;
&lt;li&gt;하드링크는 원본 파일과 동일한 파일 시스템 내에 있어야 합니다.&lt;/li&gt;
&lt;li&gt;하드링크를 통해 파일에 접근하면, 원본 파일이 삭제되어도 링크를 통해 여전히 데이터에 접근할 수 있습니다. 파일 시스템은 모든 하드링크가 삭제될 때까지 파일의 데이터를 유지합니다.&lt;/li&gt;
&lt;li&gt;하드링크는 파일의 내용에 대한 다른 “이름” 또는 “경로”를 제공하지만, 원본 파일과 완전히 동일한 권한과 속성을 가집니다.&lt;/li&gt;
&lt;li&gt;디렉토리에 대한 하드링크를 만드는 것은 대부분의 운영 체제에서 허용되지 않습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;심볼릭 링크 (소프트링크)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;심볼릭 링크는 다른 파일이나 디렉토리를 가리키는 파일입니다. 이는 원본 파일의 경로를 저장하는 별도의 파일로, 원본 파일이나 디렉토리의 “단축 경로” 또는 “참조” 역할을 합니다.&lt;/li&gt;
&lt;li&gt;심볼릭 링크는 다른 파일 시스템에 있는 파일이나 디렉토리를 가리킬 수 있습니다.&lt;/li&gt;
&lt;li&gt;원본 파일이 삭제되면 심볼릭 링크는 더 이상 유효하지 않은 참조(종종 “끊어진 링크”라고 함)가 됩니다.&lt;/li&gt;
&lt;li&gt;심볼릭 링크는 원본 파일과는 독립적인 권한과 속성을 가질 수 있으며, 파일의 실제 내용 대신 경로 정보만을 포함합니다.&lt;/li&gt;
&lt;li&gt;심볼릭 링크는 파일뿐만 아니라 디렉토리에도 사용될 수 있습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;하드링크와 심볼릭 링크는 용도에 따라 선택하여 사용할 수 있습니다. 예를 들어, 데이터의 중복을 방지하면서 여러 위치에서 동일한 파일에 접근해야 할 때 하드링크를 사용할 수 있습니다. 반면, 다른 파일 시스템에 있는 파일이나 디렉토리에 대한 참조가 필요할 때는 심볼릭 링크가 더 적합할 수 있습니다.&lt;/p&gt;
&lt;br /&gt;
&lt;h3 id=&quot;참고자료&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C&quot; aria-label=&quot;참고자료 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;참고자료&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://classic.yarnpkg.com/blog/2018/02/15/nohoist/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;nohoist in Workspaces&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.logrocket.com/javascript-package-managers-compared/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;JavaScript package managers compared: npm, Yarn, or pnpm? - LogRocket Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jonathancreamer.com/inside-the-pain-of-monorepos-and-hoisting/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Inside the pain of monorepos and hoisting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.bitsrc.io/how-to-easily-manage-dependencies-in-a-js-monorepo-6216bd6621ea&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;How to Easily Manage Dependencies in a JS Monorepo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://dev.to/chlorine/how-does-pnpm-work-5mh&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;How does pnpm work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://adamcoster.com/blog/pnpm-config&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Configure pnpm for the best possible developer experience | Adam Coster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://divriots.com/blog/switching-to-pnpm/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;A story of how we migrated to pnpm - ‹div›RIOTS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[최근 기술 근황]]></title><description><![CDATA[근래에 나는 기술적으로 무얼했을까]]></description><link>https://eunsonny.github.io/posts/Latest-technology-updates</link><guid isPermaLink="false">https://eunsonny.github.io/posts/Latest-technology-updates</guid><pubDate>Sun, 28 Jan 2024 00:00:00 GMT</pubDate><content:encoded>&lt;h3 id=&quot;새로운-프로젝트와의-만남&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%83%88%EB%A1%9C%EC%9A%B4-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%99%80%EC%9D%98-%EB%A7%8C%EB%82%A8&quot; aria-label=&quot;새로운 프로젝트와의 만남 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;새로운 프로젝트와의 만남&lt;/h3&gt;
&lt;p&gt;2023년 말 이직을 했고 새로운 프로젝트를 만났다. 새로운 프로젝트는 turbo repo로 웹, 앱 그외의 package들이 함께 있는 모노레포 형태였고, 메인 프로젝트는 SSR이 없는 Vite + React + TS의 스택을 쓰고 있었다.&lt;/p&gt;
&lt;h4 id=&quot;eslint--prettier을-biome으로-전환&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#eslint--prettier%EC%9D%84-biome%EC%9C%BC%EB%A1%9C-%EC%A0%84%ED%99%98&quot; aria-label=&quot;eslint  prettier을 biome으로 전환 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Eslint + Prettier을 Biome으로 전환&lt;/h4&gt;
&lt;p&gt;기존 프로젝트는 Eslint는 거의 사용하지 않고 사실 상 Prettier만 사용하고 있었는데, 이걸 Biome으로 교체했다. Biome은 linter와 formatter의 역할을 동시에 수행하는 툴로 Rust로 작성되었다. 일단 장점은 빠르고… 빠르고, 그리고 빠르다! 린터와 포맷터의 역할을 둘 다 하기 때문에 Biome을 사용하면 Eslint를 사용할 때 줄줄이 달고 다니던 Plugin들을 없앨 수 있다. 단점이라면 Biome에서 제공하는 룰안에서 세팅을 지정하기 때문에 Eslint Plugin을 통해 세세한 룰 세팅을 선호는 사람이라면 Biome의 룰들이 부족하게 느껴질 수 있겠다.&lt;/p&gt;
&lt;h4 id=&quot;yarn-classic에서-pnpm으로-전환&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#yarn-classic%EC%97%90%EC%84%9C-pnpm%EC%9C%BC%EB%A1%9C-%EC%A0%84%ED%99%98&quot; aria-label=&quot;yarn classic에서 pnpm으로 전환 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Yarn Classic에서 Pnpm으로 전환&lt;/h4&gt;
&lt;p&gt;Yarn Classic은 다소 느리고 유령의존성 문제가 있기 때문에 패키지 매니저를 교체하고 싶었고 선택할 수 있는 옵션으로는 크게 Yarn Berry와 Pnpm이 있었으나 Turbo Repo에서는 Yarn berry의 Plug’n’Play 모드를 지원하지 않기 때문에 사실상 선택지는 Pnpm 하나 뿐이었다. 결과적으로 Pnpm으로 잘 전환했고 이와 관련한 글을 작성하려고 하는데 음 언제쓰지? 🤔&lt;/p&gt;
&lt;h4 id=&quot;react-16에서-18로-버전-업데이트&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#react-16%EC%97%90%EC%84%9C-18%EB%A1%9C-%EB%B2%84%EC%A0%84-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8&quot; aria-label=&quot;react 16에서 18로 버전 업데이트 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;React 16에서 18로 버전 업데이트&lt;/h4&gt;
&lt;p&gt;pnpm으로 마이그레이션하면서 React의 버전도 16에서 18로 업데이트했다. 그 과정에서 다른 라이브러리와 호환성이 안맞는것 같아 React 버전을 이리 바꾸고 저리 바꾸는 고군분투의 과정이 있었는데 그 과정에서 &lt;a href=&quot;https://legacy.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;New JSX Transform&lt;/a&gt; 이슈와 만나게 됐다.&lt;/p&gt;
&lt;p&gt;문제인즉슨 메인 프로젝트의 Package.json에서는 React 16.9 버전을 사용하는 것으로 되어있었으나 유령의존성으로 인해 실제는 Packages에서 사용하는 React 17에 의존하고 있었다. 따라서 메인프로젝트에서 React 17에서 제공하는 New JSX Transform으로 &lt;code class=&quot;language-text&quot;&gt;import React from &apos;react&apos;&lt;/code&gt; 구문없이 JSX 사용이 가능했으나, pnpm으로 변환하면서 유령의존성이 사라지고 본래대로 package.json에 적혀있던 16.9 버전에 의존하게 되면서 에러가 터지게 된 것이였다.&lt;/p&gt;
&lt;p&gt;이 문제를 해결하면서 &lt;a href=&quot;https://so-so.dev/react/import-react-from-react/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;그 많던 import React from ‘react’는 어디로 갔을까&lt;/a&gt; 이 블로그 글의 도움을 많이 받았는데, 여담이지만 신기하게도 내가 무언가가 궁금해서 찾다보면 항상 이 블로그에서 도움을 많이 받게 되더라. 신기방기 🤫 이 블로그를 일부러 찾아들어간게 아니라 정보를 막 찾다가 ‘앗 내가 필요한 글이다’ 라고 생각하고 보면 이 블로그인 경우가 많았다. 나중엔 내 블로그도 이런 역할을 했음 좋겠단 작은 소망이 있다.&lt;/p&gt;
&lt;p&gt;또 React 버전을 업데이트하면서 만나게 된 이슈는 &lt;a href=&quot;https://github.com/reactwg/react-18/discussions/21&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Automatic batching for fewer renders in React 18&lt;/a&gt;와 관련되어 있는데, 레거시 코드 중 setState 함수를 동기적으로 사용하도록 의도된 코드가 있었는데 React 18의 &lt;code class=&quot;language-text&quot;&gt;createRoot&lt;/code&gt;를 사용하게 되면서 auto batching 되어 문제가 되었던 것이다. 나는 무조건 React가 setState를 batching 처리 하는 것으로 알고 있었는데 React 18 이전에서는 React 이벤트 핸들러 내부에서 발생하는 업데이트만 배칭을 하였다, 는 것을 알게 되었다.&lt;/p&gt;
&lt;p&gt;라이브러리를 하나 fork 하기도 했는데 &lt;code class=&quot;language-text&quot;&gt;react-sortable-tree&lt;/code&gt;라고 프로젝트에서 핵심적으로 쓰고 있는 라이브러리인데 3년전 부터 업데이트가 없고 (메인테이너야 어디갔니…) React 17 이후 버전을 지원하지 못하고 있어서 fork 뜬 뒤 React 18을 지원할 수 있도록 커스텀했다. 대체할 만한 다른 라이브러리가 있는지도 찾아보았지만 &lt;code class=&quot;language-text&quot;&gt;react-sortable-tree&lt;/code&gt;가 제공하는 편의사항(API)를 커버할만한 대체 라이브러리를 찾지 못했다. 🥲 &lt;code class=&quot;language-text&quot;&gt;react-sortable-tree&lt;/code&gt;를 커스텀 하는 것이 가장 빠른 방법인 듯한데, 기왕에 커스텀 하게 된 거 디자인이나 성능 부분도 좀 더 디벨롭해보면 좋을 듯 싶다.&lt;/p&gt;
&lt;h3 id=&quot;기술탐구와-블로그에-글쓰기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B8%B0%EC%88%A0%ED%83%90%EA%B5%AC%EC%99%80-%EB%B8%94%EB%A1%9C%EA%B7%B8%EC%97%90-%EA%B8%80%EC%93%B0%EA%B8%B0&quot; aria-label=&quot;기술탐구와 블로그에 글쓰기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;기술탐구와 블로그에 글쓰기&lt;/h3&gt;
&lt;p&gt;일단 Pnpm 전환기에 대한 글을 써야하고 사실 작년부터 TreeShaking에 대한 글을 하나 쓰려고 준비 중이였는데 계속 미루고 있다. (요거 파보는 과정에서 TreeShaking을 지원하는 UI 라이브러리도 하나 만들었는데) 이거 말고도 글로 쓰고 싶은 주제들은 꽤 많은데 다 쓰려면 좀 더 부지런을 떨어야 한다. 쨌든 TreeShaking에 이어서 번들러에 많은 관심을 가지고 있고, RSC도 나에겐 아직 탐구 대상이다.&lt;/p&gt;
&lt;h3 id=&quot;기술-서적-읽기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B8%B0%EC%88%A0-%EC%84%9C%EC%A0%81-%EC%9D%BD%EA%B8%B0&quot; aria-label=&quot;기술 서적 읽기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;기술 서적 읽기&lt;/h3&gt;
&lt;p&gt;개인적으로는 올해 기술서적 10개 읽기가 목표인데 작년 연말즈음 이펙티브 타입스크립트를 완독했고, 이 후 한 번 더 가볍게 2회독 했다.&lt;/p&gt;
&lt;p&gt;그 후에 읽은 것들은&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;쏙쏙 들어오는 함수형 코딩&lt;/li&gt;
&lt;li&gt;그림과 작동원리로 쉽게 이해하는 AWS 구조와 서비스&lt;/li&gt;
&lt;li&gt;혼자서 공부하는 컴퓨터 구조 + 운영체제 (읽는중)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이다. 쏙쏙 책은 설명을 정말 쉽게 잘 풀어서 써 놓은데다가 내용 자체가 유익했고, AWS 책은 전반적으로 AWS가 제공하는 서비스들에 대해서 쓱 훑어보고 싶어서 고른 책이였는데 나쁘지 않았다. 그치만 VPC에 대해서 자세히 알고 싶다면 다른 책을 읽어야 할 듯.&lt;/p&gt;
&lt;p&gt;혼자서 공부하는 컴퓨터 구조 + 운영체제는 지금 읽으면 이해도 더 잘 되고 도움이 될 것 같아서 읽고 있다. CS 기초 지식이야 알아두면 어떻게든 도움이 되겠지만, 과거에는 내가 코드를 치고 구현하는 것과 조금 동떨어진 지식인 것 같기도 하고 내가 알고 있는 지식과의 연결고리를 만들기가 어려워 선뜻 손이 가지 않았는데 최근에는 이래저래 읽는 아티클들에서 CS와 관련된 용어들이 자주 등장하다보니 지금쯤 읽어두면 좋지 않을까 싶어서 선택했다.&lt;/p&gt;
&lt;p&gt;아 진짜 사놓고 안 읽은 책도 많고 앞으로 읽고 싶은 책도 많은데 뇌가 한 세 개쯤 되었으면 좋겠다!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[컴포넌트 폴더구조 고민하기]]></title><description><![CDATA[여러분 프로젝트의 폴더구조는 안녕하신가요?]]></description><link>https://eunsonny.github.io/posts/nextjs-project-foldering</link><guid isPermaLink="false">https://eunsonny.github.io/posts/nextjs-project-foldering</guid><pubDate>Wed, 06 Sep 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;최근 회사에서 팀원들과 프로젝트의 폴더구조에 대해서 이야기하는 미팅을 여러차례 가졌다. 중점적으로 논의한 것은 &lt;code class=&quot;language-text&quot;&gt;컴포넌트를 어떠한 기준으로 폴더링 할 것인가&lt;/code&gt;였는데 프로젝트가 시간이 흘러 커지며 현재의 구조로는 여러가지 불편함을 갖게 되었기 때문이다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b2f4f5386bef60a25a784696bea8a3dc/1134b/%ED%9A%8C%EC%9D%98_slack.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA30lEQVQY04WQS0vDUBBG8ysEV03TPG7IO/WmpUmT3KRSd0q1IPhYZOHC/78/ci/SFgq6OJyZxQzfjDV9vvF8eCItKsIoZeGFOK442xXYjs9s7hl0rZkvgpMvsaaPI8eXR/rxgX64p1M71Lhn2O1pu9H0clWT5XfkpcQLInwRG1+iA2ism9sZgUipm57VumFTt9Rbxabpf+lOVOuGrJAUy8o4L8/WS/VFlu0Ixl7y/a4Y1BaRSuIkJ0oKkmxpHKclYZSZgb8wCR3bxVYD8WGiff1CVArf038Lrn7130Kd8AfcdJsev4aG7gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/b2f4f5386bef60a25a784696bea8a3dc/8ac56/%ED%9A%8C%EC%9D%98_slack.webp 240w,
/static/b2f4f5386bef60a25a784696bea8a3dc/d3be9/%ED%9A%8C%EC%9D%98_slack.webp 480w,
/static/b2f4f5386bef60a25a784696bea8a3dc/e46b2/%ED%9A%8C%EC%9D%98_slack.webp 960w,
/static/b2f4f5386bef60a25a784696bea8a3dc/f992d/%ED%9A%8C%EC%9D%98_slack.webp 1440w,
/static/b2f4f5386bef60a25a784696bea8a3dc/bb6b4/%ED%9A%8C%EC%9D%98_slack.webp 1470w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/b2f4f5386bef60a25a784696bea8a3dc/8ff5a/%ED%9A%8C%EC%9D%98_slack.png 240w,
/static/b2f4f5386bef60a25a784696bea8a3dc/e85cb/%ED%9A%8C%EC%9D%98_slack.png 480w,
/static/b2f4f5386bef60a25a784696bea8a3dc/d9199/%ED%9A%8C%EC%9D%98_slack.png 960w,
/static/b2f4f5386bef60a25a784696bea8a3dc/07a9c/%ED%9A%8C%EC%9D%98_slack.png 1440w,
/static/b2f4f5386bef60a25a784696bea8a3dc/1134b/%ED%9A%8C%EC%9D%98_slack.png 1470w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/b2f4f5386bef60a25a784696bea8a3dc/d9199/%ED%9A%8C%EC%9D%98_slack.png&quot;
            alt=&quot;스크린샷 2023-09-11 오후 10.56.23.png&quot;
            title=&quot;스크린샷 2023-09-11 오후 10.56.23.png&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;현재-프로젝트-폴더구조의-문제점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%98%84%EC%9E%AC-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90&quot; aria-label=&quot;현재 프로젝트 폴더구조의 문제점 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;현재 프로젝트 폴더구조의 문제점&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;pages 폴더 하위에 &lt;code class=&quot;language-text&quot;&gt;Component.tsx&lt;/code&gt; 파일이 존재하여 컴포넌트 이름으로 라우팅이 가능하다(?)&lt;/p&gt;
&lt;p&gt;메인 프로젝트의 태생은 Next.js가 아니라 CRA 프로젝트였고 시간이 지나면서 Next.js로 마이그레이션을 진행했다. Next.js를 사용해 본 사람은 잘 알겠지만 파일시스템 기반의 라우팅을 지원해 pages 폴더 하위의 폴더 또는 파일 구조에 따라서 라우팅이 가능하다. 그런데 이 프로젝트의 태생이 Next.js가 아니었던지라 기존에 pages 폴더 하위에 해당 페이지에서 사용하는 컴포넌트의 파일도 함께 위치하고 있었고 이로 인해 컴포넌트 파일도 path가 되어 라우팅이 가능한 기묘한 현상이 나타나게 되었다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;기준없이 뒤섞이고 비대해진 Components 폴더&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;도메인 로직을 갖지 않은 공통 컴포넌트들은 root 폴더 바로 밑의 components 폴더에 모아두었다. 아토믹 디자인 패턴을 일부? 차용하여 Components 폴더 밑에서 Atoms과 그 외의 컴포넌트로 분류하여 담아두었는데, 이 방법도 썩 효과적이진 못했다. Atoms의 조건에 해당하는 컴포넌트들은 그리 많지 않았기 때문에 그 외의 컴포넌트들이 모여있는 부분은 기준없이 뒤섞이고 비대해 졌다.&lt;/p&gt;
&lt;h2 id=&quot;폴더구조를-개선하기-위한-여러가지-방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0%EB%A5%BC-%EA%B0%9C%EC%84%A0%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EC%97%AC%EB%9F%AC%EA%B0%80%EC%A7%80-%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;폴더구조를 개선하기 위한 여러가지 방법 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;폴더구조를 개선하기 위한 여러가지 방법&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d79b7c205c48ae0e9ab9ec5965fe1870/807a0/%EC%95%84%ED%8B%B0%ED%81%B4_slack.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbUlEQVQoz2WS646bMBBGeZAqDWAgsEDMxVydhFv20qiq2n+V+v6vcSrMZpu2P45mJFvH34xsneqCVmWEYYwrDrjeA36E8CNcPzT1juuFG3740G9n1s/vI79+aCp9QXYjWXNGNhey9kKWVxSqJS8bsqL+IJUlsqhMf8yUqXlZm3tWojTV8pW0X0i7CanXOvIpOLITEbu9+Advw/bYOz62G7C/4/hYT7KkXm40y416vtG+fKOab6jpC7meyIv3lKpB5pVJtiZZk4kgwjHr+TO6FSeSbrhS6JlczxSn2Yyb9yPteWaYn5mvb4zTlfn6yjAuzMsLy/UV/xBji024ilesp1jS6AGpOj7Ljp3sP7Bliytb0kojq97sd32o6CfSokb4IY5YRQ/CMMmo+4GyPSPbgbS5cOxGgkJjl2ecXLPPeuxEYQcJdiQ3vOg/mREGcWYkSXXCTxUiKfFShXtItsvm20Smd0WA8457l4nDX8LfXO74S5OYdHUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/d79b7c205c48ae0e9ab9ec5965fe1870/8ac56/%EC%95%84%ED%8B%B0%ED%81%B4_slack.webp 240w,
/static/d79b7c205c48ae0e9ab9ec5965fe1870/d3be9/%EC%95%84%ED%8B%B0%ED%81%B4_slack.webp 480w,
/static/d79b7c205c48ae0e9ab9ec5965fe1870/e46b2/%EC%95%84%ED%8B%B0%ED%81%B4_slack.webp 960w,
/static/d79b7c205c48ae0e9ab9ec5965fe1870/f992d/%EC%95%84%ED%8B%B0%ED%81%B4_slack.webp 1440w,
/static/d79b7c205c48ae0e9ab9ec5965fe1870/60dd2/%EC%95%84%ED%8B%B0%ED%81%B4_slack.webp 1652w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/d79b7c205c48ae0e9ab9ec5965fe1870/8ff5a/%EC%95%84%ED%8B%B0%ED%81%B4_slack.png 240w,
/static/d79b7c205c48ae0e9ab9ec5965fe1870/e85cb/%EC%95%84%ED%8B%B0%ED%81%B4_slack.png 480w,
/static/d79b7c205c48ae0e9ab9ec5965fe1870/d9199/%EC%95%84%ED%8B%B0%ED%81%B4_slack.png 960w,
/static/d79b7c205c48ae0e9ab9ec5965fe1870/07a9c/%EC%95%84%ED%8B%B0%ED%81%B4_slack.png 1440w,
/static/d79b7c205c48ae0e9ab9ec5965fe1870/807a0/%EC%95%84%ED%8B%B0%ED%81%B4_slack.png 1652w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/d79b7c205c48ae0e9ab9ec5965fe1870/d9199/%EC%95%84%ED%8B%B0%ED%81%B4_slack.png&quot;
            alt=&quot;스크린샷 2023-09-11 오후 11.05.15.png&quot;
            title=&quot;스크린샷 2023-09-11 오후 11.05.15.png&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;따라서 이러한 문제점을 개선하기 위해 팀원 들과 폴더구조 개선 방향에 대해 논의 하기로 했다. 회의에 앞서 어떤 방법이 좋을지 고민하면서 다음과 같은 글을 찾아 읽고, 팀원들에게 공유했다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://itchallenger.tistory.com/m/646&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;리액트 프로젝트의 결합도를 관리하는 방법&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ahnheejong.name/articles/package-structure-with-the-principal-of-locality-in-mind/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;지역성의 원칙을 고려한 패키지 구조: 기능별로 나누기&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;공유한 아티클 중 특히 &lt;a href=&quot;https://ahnheejong.name/articles/package-structure-with-the-principal-of-locality-in-mind/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;이 글&lt;/a&gt;을 참고하여 기능별 혹은 도메인 별로 폴더구조를 가져가는 방안에 대해서 많은 이야기를 나누었고 팀원들 다수가 &lt;strong&gt;기능별 폴더링의 장점에 대해서는 공감하지만 현재 프로젝트에 개선 방법으로 도입하기 에는 어려움이 있다는 결론&lt;/strong&gt;에 다달았다.&lt;/p&gt;
&lt;p&gt;우리가 어려움으로 꼽은 이유와 나눈 의견들은 다음과 같았다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;현재 서비스에서 ‘기능별’ 분류라는 것이 다소 모호하거나 주관적인 판단이 분류에 개입될 여지가 크다.
&lt;ul&gt;
&lt;li&gt;차량그룹등록 페이지 내의 보험정보 등록 컴포넌트는 차량그룹등록 기능으로 분류되어야 할까? 보험등록 기능으로 분류되어야 할까?&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;새로운 프로젝트를 구성하는 것이라면 모르겠지만, 지금의 프로젝트에 기능별 분류를 도입한다면 현재 컴포넌트 폴더링 + 기능별 컴포넌트 폴더링이 혼재한 과도기(?)가 존재할 것이고 오히려 더 복잡해질 것 같다.&lt;/li&gt;
&lt;li&gt;사실 ERP에 가까운 우리 서비스의 특성상 &lt;strong&gt;대부분의 페이지가 이미 기능별로 분류되어 있기 때문에 페이지별로 컴포넌트를 분류하는 것이 기준이 더 명확하며 응집도도 높은 분류&lt;/strong&gt;가 될 것이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;페이지-기반의-컴포넌트-분류-폴더링하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%8E%98%EC%9D%B4%EC%A7%80-%EA%B8%B0%EB%B0%98%EC%9D%98-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EB%B6%84%EB%A5%98-%ED%8F%B4%EB%8D%94%EB%A7%81%ED%95%98%EA%B8%B0&quot; aria-label=&quot;페이지 기반의 컴포넌트 분류 폴더링하기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;페이지 기반의 컴포넌트 분류 폴더링하기&lt;/h2&gt;
&lt;p&gt;따라서 현재 프로젝트에 도입이 더 수월하고 직관적인 기준의 &lt;code class=&quot;language-text&quot;&gt;페이지 기반 컴포넌트 폴더링&lt;/code&gt;을 도입 하기로 했다.&lt;/p&gt;
&lt;h3 id=&quot;domaincomponents-구조&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#domaincomponents-%EA%B5%AC%EC%A1%B0&quot; aria-label=&quot;domaincomponents 구조 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;domainComponents 구조&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;├── components &lt;span class=&quot;token comment&quot;&gt;// common한 컴포넌트&lt;/span&gt;
├── domainComponents   
│   ├── contract   
│   │   └── detail  &lt;span class=&quot;token comment&quot;&gt;// 페이지 &lt;/span&gt;
│   │   │   ├── Table
│   │   │   │   ├── Row
│   │   │   │   │   ├── Row.tsx
│   │   │   │   │   ├── Row.style.ts
│   │   │   │   │   └── index.ts
│   │   │   │   ├── Header
│   │   │   │   │   ├── Header.tsx
│   │   │   │   │   ├── Header.style.ts
│   │   │   │   │   └── index.ts
│   │   │   │   ├── useTable.tsx
│   │   │   │   ├── Table.tsx 
│   │   │   │   ├── Table.style.ts
│   │   │   │   └── index.ts 
│   │   │   ├── DatePicker
│   │   │   │   ├── Hooks
│   │   │   │   │   ├── useDate.ts
│   │   │   │   │   └── useTime.ts
│   │   │   │   ├── DatePicker.tsx 
│   │   │   │   ├── DatePicker.style.ts
│   │   │   │   └── index.ts 
│   │   │   ├── detail.const.ts
│   │   │   ├── detail.utils.ts
│   │   │   ├── detail.type.ts
│
├── pages
│   ├── contract
│      └── detail
│
└── package.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;1-domaincomponents-하위의-폴더구조는-pages-하위의-폴더구조를-따라간다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-domaincomponents-%ED%95%98%EC%9C%84%EC%9D%98-%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0%EB%8A%94-pages-%ED%95%98%EC%9C%84%EC%9D%98-%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0%EB%A5%BC-%EB%94%B0%EB%9D%BC%EA%B0%84%EB%8B%A4&quot; aria-label=&quot;1 domaincomponents 하위의 폴더구조는 pages 하위의 폴더구조를 따라간다 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. domainComponents 하위의 폴더구조는 Pages 하위의 폴더구조를 따라간다.&lt;/h4&gt;
&lt;p&gt;즉 domainComponents는 라우팅 구조에 따라서 폴더를 생성하고, 해당 페이지(폴더) 하위에 종속되는 컴포넌트들을 생성합니다.&lt;/p&gt;
&lt;h4 id=&quot;2-컴포넌트-파일명은-컴포넌트이름tsx로-작성한다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%ED%8C%8C%EC%9D%BC%EB%AA%85%EC%9D%80-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EC%9D%B4%EB%A6%84tsx%EB%A1%9C-%EC%9E%91%EC%84%B1%ED%95%9C%EB%8B%A4&quot; aria-label=&quot;2 컴포넌트 파일명은 컴포넌트이름tsx로 작성한다 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. 컴포넌트 파일명은 컴포넌트이름.tsx로 작성한다.**&lt;/h4&gt;
&lt;p&gt;Table 컴포넌트일 경우 Table 폴더를 만들고 그 밑에 Table.tsx 파일을 만들어 컴포넌트를 작성합니다. 스타일 파일은 Table.style.ts, 상수 파일은 Table.const.ts와 같이 작성합니다. 단 custom hook의 경우 use -.tsx 파일명으로 생성합니다.&lt;/p&gt;
&lt;p&gt;custom hook의 파일명을 Table.hook.ts로 작성하지 않는 이유는 해당 컴포넌트에서 두 개의 custom hook을 사용하게 될 수 있기 때문입니다. 그리고 한 컴포넌트 내에서 두 개의 커스텀 훅을 사용할 경우, hooks 폴더를 생성하고 그 밑에 사용하는 여러 개의 커스텀훅을 넣어 놓습니다.&lt;/p&gt;
&lt;h4 id=&quot;3-컴포넌트의-export는-indexts-파일에서-한다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EC%9D%98-export%EB%8A%94-indexts-%ED%8C%8C%EC%9D%BC%EC%97%90%EC%84%9C-%ED%95%9C%EB%8B%A4&quot; aria-label=&quot;3 컴포넌트의 export는 indexts 파일에서 한다 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. 컴포넌트의 export는 index.ts 파일에서 한다.&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Table 폴더의 index.ts 파일&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./Table&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;const-type-util-등의-파일은-페이지-당-하나씩-생성한다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#const-type-util-%EB%93%B1%EC%9D%98-%ED%8C%8C%EC%9D%BC%EC%9D%80-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%8B%B9-%ED%95%98%EB%82%98%EC%94%A9-%EC%83%9D%EC%84%B1%ED%95%9C%EB%8B%A4&quot; aria-label=&quot;const type util 등의 파일은 페이지 당 하나씩 생성한다 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;const, type, util 등의 파일은 ‘페이지’ 당 하나씩 생성한다.&lt;/h4&gt;
&lt;p&gt;예시로 &lt;code class=&quot;language-text&quot;&gt;contract/detail&lt;/code&gt; 페이지에서 사용되는 &lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;util&lt;/code&gt; 등이 있다면 하위 컴포넌트 폴더가 아니라 페이지 폴더 하위에 &lt;code class=&quot;language-text&quot;&gt;detail.const.ts&lt;/code&gt;와 같이 파일을 만들어 작성합니다. 만약 두 개 이상의 페이지에서 사용되는 &lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;util&lt;/code&gt; 등이라면 root폴더 하위에 있는 공통의 &lt;code class=&quot;language-text&quot;&gt;constants&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;types&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;utils&lt;/code&gt; 폴더 밑에 파일을 생성하여 작성합니다.&lt;/p&gt;
&lt;h3 id=&quot;domaincomponents라는-개선방안에서-여전히-아쉽거나-고민되는-점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#domaincomponents%EB%9D%BC%EB%8A%94-%EA%B0%9C%EC%84%A0%EB%B0%A9%EC%95%88%EC%97%90%EC%84%9C-%EC%97%AC%EC%A0%84%ED%9E%88-%EC%95%84%EC%89%BD%EA%B1%B0%EB%82%98-%EA%B3%A0%EB%AF%BC%EB%90%98%EB%8A%94-%EC%A0%90&quot; aria-label=&quot;domaincomponents라는 개선방안에서 여전히 아쉽거나 고민되는 점 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;domainComponents라는 개선방안에서 여전히 아쉽거나 고민되는 점&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;domainComponents라는 폴더명은 과연 적절한 것일까?
&lt;ul&gt;
&lt;li&gt;domainComponents의 디테일한 구조를 정의 하면서 애매 하다고 느꼈던 점은 Component라는 이름의 폴더 하위에 const, hook, util 등의 파일이 위치하게 된다는 것이었다. 물론 해당 컴포넌트에 직접적으로 사용되는 파일만 위치하도록 하고 두 개 이상의 컴포넌트에서 사용하게 되면 common 영역으로 빼도록 규칙을 정했지만 그래도 여전히 남는 찝찝함이란… 🥲&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;페이지 기반의 컴포넌트 폴더링은 괜찮은 방법인걸까?
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;폴더링 방법에 정답이야 없지만 그래도 일반적으로 통용되는 방식의 범주에 있는지가 궁금해졌다. 이 궁금증은 재밌게도 &lt;a href=&quot;https://medium.com/musinsa-tech/journey-of-a-frontend-monorepo-8f5480b80661&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;모노레포 이렇게 좋은데 왜 안써요?&lt;/a&gt;라는 의외의 글에서 해소 되었는데 해당 글에서는 &lt;code class=&quot;language-text&quot;&gt;pages-modules&lt;/code&gt;라는 폴더 하위에 도메인 별로 분류하여 관리하는 것을 볼 수 있었다. components 뿐만 아니라 각종 모듈도 페이지 기준의 분류법을 적용한 것인데, 이 사례를 보면서 페이지 기반의 컴포넌트 폴더링이 나쁘지 않은 선택 이였다는 힌트를 얻을 수 있었고 나아가 컴포넌트 뿐만 아니라 다른 모듈들도 페이지 기준으로 분류하는 page-modules의 방법도 고려해 봄 직 하다는 생각이 들었다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;좋은-폴더구조란-어떤-것일까&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A2%8B%EC%9D%80-%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0%EB%9E%80-%EC%96%B4%EB%96%A4-%EA%B2%83%EC%9D%BC%EA%B9%8C&quot; aria-label=&quot;좋은 폴더구조란 어떤 것일까 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;좋은 폴더구조란 어떤 것일까?&lt;/h2&gt;
&lt;p&gt;폴더구조는 프로젝트의 첫인상이다. 책으로 따지면 목차 같은 것인데, 이 목차가 잘 구성되어 있다면 한 눈에 책의 흐름이나 구조를 파악할 수 있다. 폴더구조도 마찬가지로 잘 정리되어 있다면 프로젝트의 아키텍처나 흐름을 단번에 파악할 수 있도록 해줄 것이며, 코드의 응집도를 높혀 수정이 용이하도록 할 것이다. 곱씹어 생각할 수록 참 기본적이지만 중요한 부분이라는 생각이 든다.&lt;/p&gt;
&lt;p&gt;그렇다면 과연 좋은 폴더구조란 어떤 것일까? 정답은 없지만 이번에 고민해보며 몇 가지 중요하다고 생각한 점을 꼽아보자면 아래와 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;프로젝트의 아키텍처나 흐름을 파악하는데 도움을 주는 구조&lt;/li&gt;
&lt;li&gt;연관성이 높은 것들끼리는 가까이 있어 응집도가 높은 구조&lt;/li&gt;
&lt;li&gt;원하는 파일의 위치를 바로 예측하고 쉽게 찾아갈 수 있는 구조&lt;/li&gt;
&lt;li&gt;일관성 있는 철학이 있는 구조 (파일을 작성할 때 A에 넣어야 하나, B에 넣어야 하나 고민하지 않을수 있도록)&lt;/li&gt;
&lt;li&gt;가능하다면 depth가 너무 깊지 않은 구조&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;프로젝트-폴더구조에-대해서-다시금-고민해보면서-느낀-점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C-%EB%8B%A4%EC%8B%9C%EA%B8%88-%EA%B3%A0%EB%AF%BC%ED%95%B4%EB%B3%B4%EB%A9%B4%EC%84%9C-%EB%8A%90%EB%82%80-%EC%A0%90&quot; aria-label=&quot;프로젝트 폴더구조에 대해서 다시금 고민해보면서 느낀 점 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;프로젝트 폴더구조에 대해서 다시금 고민해보면서 느낀 점&lt;/h2&gt;
&lt;p&gt;최근 폴더구조나 컴포넌트 구성에 대해 고민하다보면 프로젝트(서비스)는 끊임없이 변화하며 성장한다는 점에서 마치 유기체 같다는 생각을 하게된다. 곤충이 성장하기 위해 주기적으로 탈피를 하며 새로운 옷을 입 듯 프로젝트도 성장하며 그 규모와 특성에 따라 적절한 변화가 필요하다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://ahnheejong.name/articles/package-structure-with-the-principal-of-locality-in-mind/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;이 글&lt;/a&gt;에서 이야기 하듯 규모가 작은 프로젝트에서는 계층별 구조로도 충분할 수도 있고 성장해가면서 또 다른 구조가 필요할 수도 있다. 처음부터 프로젝트 구조를 잡을 때부터 대규모 프로젝트를 고려한 구조를 만들수도 있겠지만 어찌보면 그것이 오버엔지니어링일 수도 있는 것이고, 또 프로젝트 구조라는 것이 단순히 규모의 문제만은 아니기 때문에 참 어렵다. 🤔&lt;/p&gt;
&lt;p&gt;프로젝트는 시간이 흐르며 다양한 변화를 맞이 하겠지만 폴더구조의 개선 혹은 변경은 비용이 상당히 많이 드는 일이라는 점에서 최대한 적은 변경으로 서비스를 확장해 나갈 수 있도록 미리 생각해보는 것이 필요하겠다. 그러니까 내가 고민해야 할 것은, 어떠한 프로젝트를 만났을 때 그 프로젝트의 규모나 특성 그리고 앞으로의 확장성을  고려하여 적절한 옷을 입힐 수 있도록 여러가지 구조를 고민해보고 Best practice를 찾는 것이 아닐까&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ErrorBoundary로 우아하게 에러 처리하기]]></title><description><![CDATA[최후의 방어전선 구축하기]]></description><link>https://eunsonny.github.io/posts/Handling-errors-gracefully-with-ErrorBoundary</link><guid isPermaLink="false">https://eunsonny.github.io/posts/Handling-errors-gracefully-with-ErrorBoundary</guid><pubDate>Sat, 24 Jun 2023 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;에러-바운더리란&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%97%90%EB%9F%AC-%EB%B0%94%EC%9A%B4%EB%8D%94%EB%A6%AC%EB%9E%80&quot; aria-label=&quot;에러 바운더리란 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;에러 바운더리란?&lt;/h2&gt;
&lt;p&gt;에러 바운더리(Error Boundary)는 React에서 에러 처리를 담당하는 컴포넌트이다. 컴포넌트 트리의 일부를 격리하여 예기치 않은 에러로부터 애플리케이션을 보호하고 대체 UI를 렌더링할 수 있게 한다. 이를 통해 사용자 경험을 개선하고 애플리케이션 전체의 중단을 방지할 수 있다. 에러 바운더리는 React 16부터 도입되었으며, &lt;code class=&quot;language-text&quot;&gt;componentDidCatch&lt;/code&gt; 메서드를 사용하여 에러 처리를 구현한다. 이를 활용하면 안정성과 유지 보수성을 향상시킬 수 있다.&lt;/p&gt;
&lt;p&gt;단 에러 바운더리는 다음과 같은 에러는 캐치하지 못한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;이벤트 핸들러&lt;/li&gt;
&lt;li&gt;비동기적 코드&lt;/li&gt;
&lt;li&gt;서버 사이드 렌더링&lt;/li&gt;
&lt;li&gt;자식이 아닌 에러 바운더리 자체에서 발생하는 에러&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;에러-바운더리를-사용하고자-한-이유&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%97%90%EB%9F%AC-%EB%B0%94%EC%9A%B4%EB%8D%94%EB%A6%AC%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B3%A0%EC%9E%90-%ED%95%9C-%EC%9D%B4%EC%9C%A0&quot; aria-label=&quot;에러 바운더리를 사용하고자 한 이유 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;에러 바운더리를 사용하고자 한 이유&lt;/h2&gt;
&lt;p&gt;에러 바운더리를 사용함으로써 얻을 수 있는 이점에는 여러가지가 있지만 적극적으로 에러 바운더리를 사용하고자 한 가장 큰 이유는 &lt;strong&gt;에러 관리 포인트를 최소화&lt;/strong&gt; 하고 싶었기 때문이다. 특히 본래의 ErrorBoundary는 데이터 페칭과 같은 비동기적 코드 에러를 캐치하지 못하지만 React Query의 defaultOptions에 &lt;code class=&quot;language-text&quot;&gt;useErrorBoundary:true&lt;/code&gt; 를 사용함으로써 서버 통신과 관련한 비동기적 에러도 ErrorBoundary에서 함께 핸들링 할 수 있다는 점에서 (리액트 쿼리의 도입과 함께) 이 점을 적극 활용하여 중앙 집중식 에러 관리를 할 수 있겠다고 생각했다.&lt;/p&gt;
&lt;p&gt;기존에는 아래의 코드와 같은 형태로 에러를 핸들링했다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// start loading&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; apiClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// handle error&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;모든 API 호출 함수마다 try-catch문으로 감싸 주었다. 이런 방식은 고전적인 방식(?)이기는 하지만 실수로 try-catch문을 빼먹을 수 있다는 휴먼에러 발생 가능성이 있다. 따라서 매번 try-catch 문으로 감싸주어야 하는 불편함과 휴먼에러의 위험성을 제거하고 중앙 집중식 에러 핸들링 하고자 하는 것이 목표였다.&lt;/p&gt;
&lt;p&gt;만약 React Query와 같은 라이브러리를 쓰지 못하는 상황에서 ErrorBoundary로 비동기 통신 에러를 핸들링하고 싶다면 다음과 같은 방법도 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MyComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setError&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;비동기 에러 발생시에 컴포넌트 내부에서 Error를 throw 해 ErrorBoundary에서 캐치할 수 있도록 하는 것이다. 아마 React Query의 &lt;code class=&quot;language-text&quot;&gt;useErrorBoundary:true&lt;/code&gt; 옵션을 사용하면 React Query 내부적으로 에러가 발생했을 때 에러를 throw 하도록 구현되어 있을 것이라 추측된다.&lt;/p&gt;
&lt;h2 id=&quot;에러바운더리를-사용함으로써-장점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%97%90%EB%9F%AC%EB%B0%94%EC%9A%B4%EB%8D%94%EB%A6%AC%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%A8%EC%9C%BC%EB%A1%9C%EC%8D%A8-%EC%9E%A5%EC%A0%90&quot; aria-label=&quot;에러바운더리를 사용함으로써 장점 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;에러바운더리를 사용함으로써 장점&lt;/h2&gt;
&lt;p&gt;React의 Error Boundary를 사용하면 발생한 에러를 적절히 격리시켜 애플리케이션의 전반적인 작동에 영향을 주지 않게끔 관리할 수 있다. 이를 통해 사용자에게는 문제가 발생한 부분 대신 대체 UI를 제공하고 대처 방법을 가이드함으로써 좋은 사용자 경험을 유지할 수 있다. 또한, 에러 바운더리에서 수집한 에러 정보를 활용해 에러 원인을 신속하게 파악하고 수정하는데 도움이 된다. 이러한 장점들은 전체적인 코드의 안정성과 신뢰성을 높일 수 있다.&lt;/p&gt;
&lt;p&gt;뿐만 아니라 대수적 효과를 지원하는 코드를 작성할 수 있게 된다. 여기서 잠깐 &lt;strong&gt;대수적 효과&lt;/strong&gt;에 대해 알아보자면&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;💡 어떤 코드 조각을 감싸는 맥락으로 책임을 분리하는 방식을 대수적 효과라고 한다. 객체 지향의 의존성 주입, 의존성 역전과 유사하다고 볼 수 있다.
&lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// start loading&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; apiClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// handle error  }&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;기존 코드의 경우, 매번 try-catch 문으로 감싸 주어야 한다는 불편함과 함께 성공하는 케이스와 실패하는 케이스의 코드가 함께 적혀있어 함수가 실제로 수행하고자 하는 동작이 가려지게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; apiClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ErrorBoundary를 사용하면 실패하는 경우의 동작은 에러 바운더리에 위임하고 데이터를 호출하는 함수는 위와 같이 순수하게 데이터만 가져오는 동작만 선언하여 사용할 수 있게 된다. Suspense를 사용하여 로딩 상태를 위임하는 것도 같은 대수적 효과로 볼 수 있다.&lt;/p&gt;
&lt;h2 id=&quot;나타날-수-있는-에러의-종류-분류하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%82%98%ED%83%80%EB%82%A0-%EC%88%98-%EC%9E%88%EB%8A%94-%EC%97%90%EB%9F%AC%EC%9D%98-%EC%A2%85%EB%A5%98-%EB%B6%84%EB%A5%98%ED%95%98%EA%B8%B0&quot; aria-label=&quot;나타날 수 있는 에러의 종류 분류하기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;나타날 수 있는 에러의 종류 분류하기&lt;/h2&gt;
&lt;p&gt;그렇다면 ErrorBoundary에서 처리해야 하는 에러의 종류는 어떤 것들이 있을까? 우선 크게 예측이 가능한 에러와 예측이 불가능한 에러로 나누어 생각해 본 뒤, 각 에러에 대해 유저에게 어떤 가이드를 제공할 수 있을지에 따라 크게 4 가지로 분류했다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;GET이 실패한 상황:&lt;/strong&gt; data fetching에 실패하여 데이터 자체를 보여줄 수 없는 경우&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;데이터 변경 HTTP 메서드가 실패한 상황:&lt;/strong&gt; 사용자의 액션에 정상적으로 반응하지 못 하는 경우&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;요청 권한이 없는 상황:&lt;/strong&gt; 로그인이 끊겨 401 unauthorized 를 마주하는 경우&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;unknown Error&lt;/strong&gt;: 일시적인 네트워크 에러, 브라우저에서 발생하는 에러 등&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ErrorBoundary 내부에서 각 에러 타입에 적합한 대체 UI와 유저가 에러를 해결하기 위한 가이드를 제공하도록 로직을 작성할 것이다.&lt;/p&gt;
&lt;h2 id=&quot;에러-처리-전략&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%97%90%EB%9F%AC-%EC%B2%98%EB%A6%AC-%EC%A0%84%EB%9E%B5&quot; aria-label=&quot;에러 처리 전략 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;에러 처리 전략&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;GET이 실패한 상황&lt;/strong&gt;: 데이터 패칭에 실패하게 되면 현재 보여 줄 수 있는 데이터가 없거나 정확하지 않은 데이터를 노출하게 된다. 부정확한 데이터를 노출하는 것은 적절하지 않다고 생각하여 대체 UI를 보여주기로 했다. 또한 대체 UI에서 다시 시도하기 버튼을 노출해 유저가 에러 상황에서 데이터 패칭을 재시도 할 수 있도록 가이드한다. 추가적으로 토스트 메세지도 노출해 주도록 하자.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;데이터 변경 HTTP 메서드가 실패한 상황:&lt;/strong&gt; POST, PUT, DELETE와 같은 변경 메서드는 사용자 액션에 의해 발생한다. 액션의 성공/실패 여부를 즉각 피드백 해줄 필요가 있다. 하지만, 액션이 실패했다고 하여 대체 UI를 보여줄 필요가 있을까? 사용자가 실패했다는 것을 인지하게 하고, 다시 요청하게끔 유도만 하면 될 것이다. 즉, 이 경우에는 토스트 UI만 발동시킨다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;unauthorized(401) Error&lt;/strong&gt;: 권한이 없어 발생하는 에러기 때문에 401 에러가 발생할 경우 로그인 페이지로 유도하려 했으나, 401 에러가 발생할 수 있는 케이스가 생각보다 다양하다는 것을 확인하고 무조건적으로 로그인 페이지로 유도하는 것은 적절하지 않다고 생각했다. (예를 들어 나의 서비스의 경우에는 비밀번호 변경 페이지에서 기존 비밀번호와 새로운 비밀번호를 적어 POST 했을 때 기존의 비밀번호가 일치하지 않으면 401을 리턴한다. 이 경우 갑자기 로그인 페이지로 유도한다면 유저는 상당히 당황스러운 경험을 하게 될 것이다 😅) 대신 토스트 메세지를 노출하여 유저가 문제를 인지하고 로그인 하거나 또는 하려던 액션을 재시도 할 수 있도록 가이드 했다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;unknown Error&lt;/strong&gt;: 해당 에러는 다양한 상황에 원인을 알 수 없는 에러임으로 토스트 메세지를 노출하고 대체 UI에서 메인 화면으로 이동할 수 있도록 가이드 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;globalerrorboundary-생성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#globalerrorboundary-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;globalerrorboundary 생성하기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GlobalErrorBoundary 생성하기&lt;/h2&gt;
&lt;p&gt;위에서 정의한 모든 타입의 에러를 처리할 수 있는 &lt;code class=&quot;language-text&quot;&gt;GlobalErrorBoundary&lt;/code&gt;를 생성할 것이다. &lt;code class=&quot;language-text&quot;&gt;GlobalErrorBoundary&lt;/code&gt;는 이름에 걸맞게 app.tsx에서 pageComponent 전체를 감싸 Error의 최종 방어전선의 역할을 하도록 한다.&lt;/p&gt;
&lt;p&gt;우선 에러의 타입을 정의해 준다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GlobalErrorBoundaryState&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AxiosError&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unauthorized&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosMutationError&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 &lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromError&lt;/code&gt;에서 각 에러 타입을 state에 업데이트 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDerivedStateFromError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; GlobalErrorBoundaryState &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 다음 렌더링에서 폴백 UI가 보이도록 상태를 업데이트 한다.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AxiosError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;unknown&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;unauthorized&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;method &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;get&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;axiosGetError&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;axiosMutationError&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;componentDidCatch&lt;/code&gt;에서는 각 에러 타입에 따라 대체 UI 이외에 부가적으로 취할 액션을 정의해 준다. 나의 경우에는 AxiosError의 경우에는 서버에서 보내준 에러 문구를, unknown 에러의 경우에는 ‘알 수 없는 에러가 발생했습니다.’라는 문구를 토스트 메세지로 노출하도록 했다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;componentDidCatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorInfo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ErrorInfo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 에러 리포팅 서비스에 에러를 기록할 수 있음&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// logErrorToMyService(error, errorInfo)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; errorState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorState &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AxiosError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;errorMesssageHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;unknown&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Toast&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;알 수 없는 에러가 발생했습니다.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;error&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;대체 UI의 경우에는 axiosGetError와 unknown 에러의 경우에만 노출하고, 나머지 에러의 경우에는 기존 페이지를 그대로 노출한다. 대체 UI는 renderFallback이란 Props로 받아와서 렌더링한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; children&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; renderFallback &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; renderFallbackErrorCases &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;axiosGetError&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;unknown&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; renderFallbackErrorCases&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;renderFallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        errorCase&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        onReset&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resetErrorBoundary&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; children
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;최종-완성-된-globalerrorboundary는-다음과-같다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B5%9C%EC%A2%85-%EC%99%84%EC%84%B1-%EB%90%9C-globalerrorboundary%EB%8A%94-%EB%8B%A4%EC%9D%8C%EA%B3%BC-%EA%B0%99%EB%8B%A4&quot; aria-label=&quot;최종 완성 된 globalerrorboundary는 다음과 같다 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;최종 완성 된 GlobalErrorBoundary는 다음과 같다&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GlobalErrorCase&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unauthorized&quot;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosMutationError&quot;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RenderFallbackProps&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ErrorType &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; Error &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Error&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ErrorType&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; GlobalErrorCase&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;onReset&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;unknown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RenderFallbackType&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ErrorType &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  props&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; RenderFallbackProps&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ErrorType&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; ReactNode&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ErrorBoundaryProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; PropsWithRef&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;
  PropsWithChildren&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    onReset&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    renderFallback&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; RenderFallbackType&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GlobalErrorBoundaryState&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AxiosError&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; message&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unauthorized&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosMutationError&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initialState&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; GlobalErrorBoundaryState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GlobalErrorBoundary&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;
  PropsWithChildren&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ErrorBoundaryProps&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  GlobalErrorBoundaryState
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ErrorBoundaryProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDerivedStateFromError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; GlobalErrorBoundaryState &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 다음 렌더링에서 폴백 UI가 보이도록 상태를 업데이트 한다.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AxiosError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unauthorized&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;method &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;get&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosMutationError&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// error fallback에 전달할 reset handler&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;resetErrorBoundary&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; onReset &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    onReset &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onReset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ErrorBoundary state를 초기화&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;componentDidCatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorInfo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ErrorInfo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 에러 리포팅 서비스에 에러를 기록할 수 있음&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// logErrorToMyService(error, errorInfo)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; errorState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorState &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AxiosError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;errorMesssageHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Toast&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;알 수 없는 에러가 발생했습니다.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;error&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; children&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; renderFallback &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; renderFallbackErrorCases &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; renderFallbackErrorCases&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;renderFallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        errorCase&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        onReset&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resetErrorBoundary&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; children&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; GlobalErrorBoundary&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;localerrorboundary-생성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#localerrorboundary-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;localerrorboundary 생성하기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LocalErrorBoundary 생성하기&lt;/h2&gt;
&lt;p&gt;추가적으로 LocalErrorBoundary를 생성해준다. 다음과 같은 상황을 고려한 것인데 네이버 화면을 예로 들어 설명하려고 한다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7dc0e1293e2b8245fd4b77664b312b9c/efe17/naver.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC1ElEQVQozz2S62scZRTG5//yg/4vfrIQWkQCtlqloNBUQbCbNJemJWpWWo2hoKmKNDYqqSu1u5psJ9tLdnZ3dnbn/s4713dmfzIb6YHD83DOgXN7tHObm1xp3uG9rSYXVta4sLzG+eUaV3nn5haLt748izVWWbh+g3PXVzi/ss5CY5XF9U0WN27z9q0vuNT8hkt3dtAc6XBw8As/790jCn2qsoBKUZv5tMPz1kMqlQMz1ByBMoeqqAnM1BnPk3lKG1sWG+s3uPbJEt0TnYFpEucZfWNK4+rHXLl8kdPhEF+EJHlOlqa4owGe7yEjQSwFUkb49oQsEmizooDZ7KxzlkGWUsYJaShQSQx1PkshTV6hcF2MoYkxGKCqGXFekKcpVZqi5aGP77pEYUAcRXMviwJVZJRFjsoKVJ5TFQVVWTITAbln4zg2WRwihcQPJJFtU8USTUWCiW1jTSboeo/xeIIx6GMObUanHoGfkNYTKEVRVajQJ+0/pwxclDul8hyyqUU2MqiiEC3zPX5tnfBw/4D331qgub7KzavvcnfzNj9+f59nL3sMhiYj02RkTZH2FN+yEEk6v1Kuyvo18w3LJEFLfZfDjs7pS4Ov1jbYu7fL3u42Pb3Lca+L67nIOCGSMaGMKUXAwBjTswISBZPplEAIxsMhql45nggO95+w/+An7n67RavVYWf7Pk+P27QP/8BxHZzAwbLHBDKiCDziMEbmM6KkoJQpZGU9KmUSo2Wez9fNJo3GZ3y4dJGd3e9447XXufbRB3z+6RKdow4nfZ0nL475s/svgTPFGQyQnk8uIrrTPr+bXR6bPVReoKWuTfvvv3im6/zT7jAy+hy1H9PrHtF69AgpAkzXpj+10A2DMhL0+wajsUUttuXhb7ypb3P5xQ8UqkLLI0ERCWZpMkcVR6SeQNohaeChZEQmQtIwoK7Nw4AwCOeyUUqB+l/DCqSM+Q/EbF3vAcQEswAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/7dc0e1293e2b8245fd4b77664b312b9c/8ac56/naver.webp 240w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/d3be9/naver.webp 480w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/e46b2/naver.webp 960w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/f992d/naver.webp 1440w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/882b9/naver.webp 1920w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/a0179/naver.webp 2860w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/7dc0e1293e2b8245fd4b77664b312b9c/8ff5a/naver.png 240w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/e85cb/naver.png 480w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/d9199/naver.png 960w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/07a9c/naver.png 1440w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/29114/naver.png 1920w,
/static/7dc0e1293e2b8245fd4b77664b312b9c/efe17/naver.png 2860w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/7dc0e1293e2b8245fd4b77664b312b9c/d9199/naver.png&quot;
            alt=&quot;naver.png&quot;
            title=&quot;naver.png&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;한 화면 안에 날씨, 증시, 쇼핑 등 다양한 정보를 노출하고 있다. 만약 쇼핑과 날씨에 대한 정보는 제대로 받아왔지만 증시 데이터를 받아오는데 에러가 발생 했을 때 &lt;code class=&quot;language-text&quot;&gt;GlobalErrorBoundary&lt;/code&gt; 만을 사용한다면 화면 전체에 대체 UI가 노출 될 것이다. 그러나 이러한 대처는 안좋은 유저경험을 제공하게 된다. 데이터를 잘 받아온 날씨와 쇼핑 부분은 화면은 정상적으로 노출하고 증시 부분에 대해서만 대체 UI를 제공함으로써 더 나은 UX를 제공할 수 있다.&lt;/p&gt;
&lt;p&gt;따라서 이러한 에러의 경계선을 만들어 줄 수 있도록 &lt;code class=&quot;language-text&quot;&gt;LocalErrorBoundary&lt;/code&gt;를 만들어 적용하고 싶은 부분에 따로 감싸 줄 수 있도록 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LocalErrorBoundaryState&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;shouldRethrow&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AxiosError&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; message&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;LocalErrorBoundary&lt;/code&gt;에서는 unknown 에러와 axiosGetError 만을 캐치하고 나머지 에러는 throw하여 GlobalErrorBoundary에서 처리될 수 있도록 한다.&lt;/p&gt;
&lt;h3 id=&quot;완성된-localerrorboundary의-코드&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%99%84%EC%84%B1%EB%90%9C-localerrorboundary%EC%9D%98-%EC%BD%94%EB%93%9C&quot; aria-label=&quot;완성된 localerrorboundary의 코드 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;완성된 LocalErrorBoundary의 코드&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LocalErrorBoundaryProps&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ErrorType &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; Error &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Error&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; PropsWithRef&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;
  PropsWithChildren&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;/**
     * @description 발생할 수 있는 error에 대한 기준값으로 이 값이 변경되면 error를 초기화한다.
     */&lt;/span&gt;
    resetKeys&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;unknown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    onReset&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    renderFallback&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; RenderFallbackType&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    onError&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ErrorType&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ErrorInfo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LocalErrorBoundaryState&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;shouldRethrow&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AxiosError&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; message&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initialState&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; LocalErrorBoundaryState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BaseErrorBoundary&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;
  PropsWithChildren&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;LocalErrorBoundaryProps&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  LocalErrorBoundaryState
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; initialState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  updatedWithError &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; LocalErrorBoundaryProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDerivedStateFromError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; LocalErrorBoundaryState &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 다음 렌더링에서 폴백 UI가 보이도록 상태를 업데이트 한다.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AxiosError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;method &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;get&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;shouldRethrow&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;resetState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;updatedWithError &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// error fallback에 전달할 reset handler&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;resetErrorBoundary&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; onReset &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    onReset &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onReset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ErrorBoundary state를 초기화&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resetState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;componentDidCatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorInfo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ErrorInfo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 에러 리포팅 서비스에 에러를 기록할 수 있음&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// logErrorToMyService(error, errorInfo)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; errorState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; onError &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axiosGetError&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      onError &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorInfo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;errorMesssageHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      onError &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorInfo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Toast&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;알 수 없는 에러가 발생했습니다.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;error&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorCase &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;shouldRethrow&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;componentDidUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prevProps&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; LocalErrorBoundaryProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; resetKeys &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;updatedWithError&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;updatedWithError &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isDifferentArray&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prevProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resetKeys&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; resetKeys&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resetErrorBoundary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorCase &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; children&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; renderFallback &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; errorCase &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;shouldRethrow&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;renderFallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        errorCase&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        onReset&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resetErrorBoundary&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; children&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; LocalErrorBoundary &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;forwardRef&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  ComponentPropsWithoutRef&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; BaseErrorBoundary&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; resetRef&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ref &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;useRef&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;BaseErrorBoundary&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;useImperativeHandle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resetRef&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; ref&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resetErrorBoundary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BaseErrorBoundary&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token spread&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;ref&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

LocalErrorBoundary&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;displayName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;LocalErrorBoundary&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;추가적으로 LocalErrorBoundary에서는 옵셔널하게 onError와 resetKeys라는 Props를 받을 수 있도록 하여 onError를 통해 에러 발생시에 취하고 싶은 추가적인 엑션을 설정하거나, resetKeys가 변경되면 에러가 리셋될 수 있도록 했다.
&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;실제 서비스에 적용된다면 어떤 모습일까?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;서비스의 메뉴 목록 중에는 아래의 이미지에서 보여지듯 유저의 마일리지를 실시간으로 노출해주는 항목이 있다. 만약 어떠한 이유로 인해 마일리지를 값을 받아오는 API 통신에서 에러가 발생 했을 때 메뉴 전체가 대체UI로 노출된다면 유저는 어디로도 이동할 수 없는 진퇴양난의 상황에 빠지게 될 수도 있다😫. 하지만 이러한 경우에 에러가 발생할 수 있는 컴포넌트만 LocalErrorBoundary로 감싸준다면? 짜잔- 오른쪽의 화면처럼 에러가 발생한 마일리지 메뉴 항목만 대체 UI를 노출할 수 있다.
&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/330bcfc3bfca680766f8a15b413ed5fd/ae694/localErrorBoundary.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 89.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAADb0lEQVQ4y4WUXUybVRjHX8fXhKAUMHNeOGOyqZSWQcO0jYnJvCC6oVcmM7C1ZYIaLzAkCIJZvNVwo0EvySThI0u4MS5kL0sLIdGW3kCyS5dRa7H0g9IW+vm+/ZlzulZE1Cf55z3nvM/5n+c8z/85iu2NN3n73fdIHRxQtiJQ0DSJTDaHrut8cetL2ju6+cWzwXErFosSuVwOpfOVl+m5fJn9/X2Wl5f5ze8nvLsrSYRpWkF+Rz8d5vy5c2x4PGz4fPh8PmKxKNlsWv4X/vl8HqX7hee4YusmGomwtbVFPB7n8PAQTdc5TOukMyXC8U8+pK31KTzra+yGwzx8+CvB4B/s7ITI51KVSJXu55/hqrWT3wMB9hMJuVi27aBOOJYvEX78AW2G0/y86pbzBw+gpyeD1Zrg228EoUY+r6N0nTXQYzERDocldnZ2ZOgcIRb22dAAFxprWL+/QhGd7e04q6vg80Eo9JefcraxnkuWLhYX5rDb7YyNjTM6OsrIyAjXr9+gr68Pv9/P8NAgp08pLC4ssLS0xJ07i7hcP7K29hN37y5x+/YPbG5uojTU1dFlNqGqKl99PcXs7Czz8/PMzc0xPT3N1NQU0WgUp91O7akn+P67aewOB/39Nxga+oibN4e4du19bDYrMzMzKIYGAxdfMssq/5fZ+x3UK3XcW1ZJJpOycEImAoVCXn5llZufPkNnu4VIJCIXRPk1Tasgm81KQqdjkPrqRtR7K2i6duKhYq9iMJzBYjSxF4uSTKZIp9N/E2uhUJKN0znIk1V1rK6oUvCpVKriI1AORGlpbsJiNBIJh0kkk3LxKGFZ4AMDThqqq3CpKrl8nkQiIXuqLLOyr9Lc3ISp3SjzcpToOKHT6aC2ppoVVZWiP35wqWERV27CaGyTSf4/wprqKtxu1+OW1P7hKzultbWFjg4zB48fB0FwEqG4cm1tDW53qVNEbk8ktFpf453e3kqEJ70kwiYmJjCZTHi9nn+VliS02Wxc7e2V1RUSEbnMZDJHNFaq8uTkJGZzB16vV86FboW/kJpAOWLlxQuvct70liQRCAaDhEIh9vb2JGRfA8Mjn1Pb2IZrrRTho0fbBAIB2UUC5RsqF7te55LtCrFYTJ4oni8xFmRiLHJbLOqMjd+i5VkT913rcmM8vl8hE76CUOz/EzWIo+eCOgOgAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/330bcfc3bfca680766f8a15b413ed5fd/8ac56/localErrorBoundary.webp 240w,
/static/330bcfc3bfca680766f8a15b413ed5fd/d3be9/localErrorBoundary.webp 480w,
/static/330bcfc3bfca680766f8a15b413ed5fd/10237/localErrorBoundary.webp 850w&quot;
              sizes=&quot;(max-width: 850px) 100vw, 850px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/330bcfc3bfca680766f8a15b413ed5fd/8ff5a/localErrorBoundary.png 240w,
/static/330bcfc3bfca680766f8a15b413ed5fd/e85cb/localErrorBoundary.png 480w,
/static/330bcfc3bfca680766f8a15b413ed5fd/ae694/localErrorBoundary.png 850w&quot;
            sizes=&quot;(max-width: 850px) 100vw, 850px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/330bcfc3bfca680766f8a15b413ed5fd/ae694/localErrorBoundary.png&quot;
            alt=&quot;localErrorBoundary&quot;
            title=&quot;localErrorBoundary&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이제 서버와 통신하는 비동기 코드를 일일히 try-catch로 감싸는 수고로움 없이 우아하게 에러를 다룰 수 있게 되었다.&lt;/p&gt;
&lt;p&gt;사실 조금만 찾아보면 여러가지 편의 기능을 제공하는 ErrorBoundary 라이브러리들이 존재한다. &lt;a href=&quot;https://www.npmjs.com/package/react-error-boundary&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;react-error-boundary&lt;/a&gt;도 있고, 토스에서 제공하는 라이브러리인 toss/slash에도 &lt;a href=&quot;https://slash.page/ko/libraries/react/error-boundary/src/ErrorBoundary.i18n&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;@toss/error-boundary&lt;/a&gt;가 있다. 내가 작성한 &lt;code class=&quot;language-text&quot;&gt;ErrorBoundary&lt;/code&gt;도 해당 라이브러리들의 코드를 많이 참고했다. 라이브러리를 설치해 사용하면 보다 손쉽게 사용이 가능하지만 라이브러리의 코드를 뜯어보고 직접 만들어 사용해보면 내부동작을 이해하고 사용할 수 있어 공부가 되기도 하고 각자의 서비스에 맞게 커스텀이 가능하니, 이 글을 읽는 누군가도 가능한 라이브러리의 코드는 참고용으로 보고 직접 만들어보길 권장해본다😋
&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;참고자료&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C&quot; aria-label=&quot;참고자료 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;참고자료&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://jbee.io/react/error-declarative-handling-0/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;효율적인 프론트엔드 에러핸들링&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://jeongyunlog.netlify.app/develop/react/react-error-boundary/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;React ErrorBoundary를 통한 선언적 에러처리&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://happysisyphe.tistory.com/52&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;ErrorBoundary로 Toast, ErrorFallback 등 공통적인 에러를 처리해보자&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://fe-developers.kakaoent.com/2022/221110-error-boundary/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;React의 Error Boundary를 이용하여 효과적으로 에러 처리하기&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Streaming SSR이 해결하는 문제]]></title><description><![CDATA[작게 나누면 더 쉬워져요]]></description><link>https://eunsonny.github.io/posts/The-problem-that-Streaming-SSR-solves</link><guid isPermaLink="false">https://eunsonny.github.io/posts/The-problem-that-Streaming-SSR-solves</guid><pubDate>Wed, 24 May 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Next.js의 버전이 13.4에 접어들면서 App Router가 stable 상태로 변경되었다. 그렇다고 당장 프로덕션에 적용하기엔 조심스럽지만 이제 더 이상 외면하고 있을 수는 없을 것 같다. App Router를 받아들일 몸(?)과 마음의 준비를 해야 한다. Streaming SSR이 해결하는 문제에 대해서 말한다더니 왜 갑자기 Next.js의 App Router 이야기냐고 🙄? 바로 App Router를 통해 우리는 Streaming SSR에 편하고 빠르게 가까워질 수 있기 때문이다. 그럼 각설하고 본론으로 들어가보자!&lt;/p&gt;
&lt;h2 id=&quot;csr과-비교했을-때-ssr이-가진-장점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#csr%EA%B3%BC-%EB%B9%84%EA%B5%90%ED%96%88%EC%9D%84-%EB%95%8C-ssr%EC%9D%B4-%EA%B0%80%EC%A7%84-%EC%9E%A5%EC%A0%90&quot; aria-label=&quot;csr과 비교했을 때 ssr이 가진 장점 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CSR과 비교했을 때 SSR이 가진 장점&lt;/h2&gt;
&lt;p&gt;SSR은 서버에서 매번 페이지를 HTML 형태로 완전히 렌더링한 후에 클라이언트로 전송한다. 따라서 자바스크립트의 파싱과 실행 절차 없이 첫 화면을 빠르게 그릴 수 있게 된다. 즉 초기 로딩 시 LCP(Largest Contentful Paint)가 빨라져 사용자들이 페이지의 주요 내용에 더 빨리 접근할 수 있게 해주고, 사용자 경험을 향상시킨다.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;그럼에도-현재-ssr이-가진-문제점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B7%B8%EB%9F%BC%EC%97%90%EB%8F%84-%ED%98%84%EC%9E%AC-ssr%EC%9D%B4-%EA%B0%80%EC%A7%84-%EB%AC%B8%EC%A0%9C%EC%A0%90&quot; aria-label=&quot;그럼에도 현재 ssr이 가진 문제점 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;그럼에도 현재 SSR이 가진 문제점&lt;/h2&gt;
&lt;h3 id=&quot;all-or-nothing-무언가-하기-전에-무엇이든-다-해야-한다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#all-or-nothing-%EB%AC%B4%EC%96%B8%EA%B0%80-%ED%95%98%EA%B8%B0-%EC%A0%84%EC%97%90-%EB%AC%B4%EC%97%87%EC%9D%B4%EB%93%A0-%EB%8B%A4-%ED%95%B4%EC%95%BC-%ED%95%9C%EB%8B%A4&quot; aria-label=&quot;all or nothing 무언가 하기 전에 무엇이든 다 해야 한다 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;All or Nothing, 무언가 하기 전에 무엇이든 다 해야 한다.&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/913a1/everything-or-nothing.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABA0lEQVQoz42R2W6DMBBF+f/Pq9jMEgVCXgrESwEDtrnVTEWVpg+tpSMZL4c748g5h33fsa4rrLU/oDXCe4/jOKBng3fdM70ZMZgRvRn4ezQPkCsiWQiBL7xCgw45EvqAVt6RyAKZKpGriqF5qkpcZMM/j7ZtYyGNU/I8p3REIOGjgxgqlP0F+VChGGuIoUY+VmjVnSv9JXxN+C10Hld5Q6YqJL1Aogsm1SXeVIarvsFt/xTSvncereogdI1sKBEbwbJYC6YxHRwlpLr/TBgoYUAjOwhZI+upbwVSWXBPYym4hzslpLopJTf/CVo/X/9MOS8zZkssmNYZk/3iw06Ylolf+RP85RrG/1C5hwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/8ac56/everything-or-nothing.webp 240w,
/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/d3be9/everything-or-nothing.webp 480w,
/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/e46b2/everything-or-nothing.webp 960w,
/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/f992d/everything-or-nothing.webp 1440w,
/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/17713/everything-or-nothing.webp 1476w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/8ff5a/everything-or-nothing.png 240w,
/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/e85cb/everything-or-nothing.png 480w,
/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/d9199/everything-or-nothing.png 960w,
/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/07a9c/everything-or-nothing.png 1440w,
/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/913a1/everything-or-nothing.png 1476w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/b25bc59e8ed1a06e01aeb45b2b78dcaa/d9199/everything-or-nothing.png&quot;
            alt=&quot;everything-or-nothing&quot;
            title=&quot;everything-or-nothing&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;유저에게 UI 보여주기 전에 필요한 데이터를 &lt;strong&gt;전부&lt;/strong&gt; 다 패치해서 HTML을 그려줘야 한다.&lt;/li&gt;
&lt;li&gt;Hydrate 하기 전에 &lt;strong&gt;모든&lt;/strong&gt; 번들을 다 로드해야한다.&lt;/li&gt;
&lt;li&gt;유저 인터랙션이 되기전에 &lt;strong&gt;모든 걸&lt;/strong&gt; 다 하이드레이션 해야한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;현재 우리가 Next.js나 &lt;code class=&quot;language-text&quot;&gt;renderToString&lt;/code&gt;을 이용해서 하는 SSR의 태생적인 한계점은 렌더링하는 페이지를 기준으로 UI 렌더링, Hydrate, User-Interaction 에 필요한 모든 자원(JS Bundle과 Server Data 등)들과 작업을 한번에 전부 다 준비해야 한다는 점이다.&lt;/p&gt;
&lt;h3 id=&quot;waterfall-폭포수-현상&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#waterfall-%ED%8F%AD%ED%8F%AC%EC%88%98-%ED%98%84%EC%83%81&quot; aria-label=&quot;waterfall 폭포수 현상 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Waterfall, 폭포수 현상&lt;/h3&gt;
&lt;p&gt;이러한 방식은 Waterfall 현상을 발생 시킨다. 데이터 가져오기(서버) -&gt; HTML로 렌더링(서버) -&gt; 코드 불러오기(클라이언트) -&gt; 하이드레이션(클라이언트). 이 중 그 어떤 단계도 이전 단계가 전체 애플리케이션에 대하여 끝나기 전까진 시작되지 못한다. 이것이 바로 비효율적인 이유다.&lt;/p&gt;
&lt;p&gt;결국 기존 방식의 SSR은 페이지 단위 전체에서 &lt;strong&gt;이뤄지거나, 혹은 이뤄지지 않는 것&lt;/strong&gt; 결국 이 2개의 상태만을 가지게 된다. 이 점 때문에 FCP(First Contentful Paint)를 많이 지연시켜, 오히려 유저 경험에 악영향을 주는 경우가 생긴다.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;streaming-ssr-streaming-html-and-selective-hydration&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#streaming-ssr-streaming-html-and-selective-hydration&quot; aria-label=&quot;streaming ssr streaming html and selective hydration permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Streaming SSR &lt;strong&gt;(Streaming HTML and Selective Hydration)&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;짜잔- 이 문제를 해결하기 위해 등장한게 바로 Streaming SSR으로 기존에 페이지 단위로 준비하던 것을 작게 나눔으로써 해결한다. 즉 기존의 SSR은 &lt;strong&gt;전체의 페이지를 최대한 빨리 준비해서 보여준다&lt;/strong&gt;의 방식이였다면, Streaming SSR은 &lt;strong&gt;페이지를 부분으로 작게 쪼개어 준비되는 부분부터 보여준다&lt;/strong&gt;의 방식을 택한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;서버에서 HTML을 스트리밍 형식으로 전달해야 한다. 이렇게 하기 위해서 전통적인 방식의 SSR을 구현할 떄 사용하던 &lt;code class=&quot;language-text&quot;&gt;renderToString&lt;/code&gt; 메소드를 대신해 &lt;a href=&quot;https://react.dev/reference/react-dom/server/renderToPipeableStream&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;renderToPipeableStream&lt;/code&gt;&lt;/a&gt; 메소드를 사용해야 한다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;클라이언트에서도 선택적으로 하이드레이션 한다. 이를 위해 클라이언트 단에서 createRoot를 &lt;a href=&quot;https://github.com/reactwg/react-18/discussions/5&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;hydrateRoot&lt;/a&gt;로 바꿔주고 애플리케이션의 부분 부분을 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Suspense&gt;&lt;/code&gt;로 감싸줘야 한다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; hydrateRoot &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-dom/client&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; App &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./App.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;hydrateRoot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;root&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Layout&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NavBar&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Sidebar&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RightPane&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Suspense&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;fallback&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Spinner&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Comments&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Suspense&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RightPane&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Layout&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;페이지는 Suspense를 경계로 쪼개져 스트리밍 된다. 위의 코드에서는 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Comments&gt;&lt;/code&gt; 항목을 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Suspense&gt;&lt;/code&gt;로 감싸줌으로써, React에게 댓글 부분을 기다리지 않고 나머지 페이지에 대해 HTML을 스트리밍 하도록 할 수 있다. 댓글 부분 대신에 React는 placeholder에 해당하는 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Spinner&gt;&lt;/code&gt; 컴포넌트를 보내준다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fd78e5f9591acd3cfe7575a605799216/32056/streaming-ssr.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJklEQVQ4y5VUa5OiQAzk//+u/XyrgjIwiK6uwvCYByjqKvRVgudad9bV3VBdGTtJMyZhvKZp0DYtyDaugbMO1loYbaC1hq416qpCXdW8J94ai8a573hjOfZ8PsPrjh1EFmNRfWNeRg/rFyGCQvCe+TL+A0EpsFYbXM4XeKeuQ6rWiIoEsVoizGMIJZGUK+ZoL3LJvrhYQpYpZLFkLilTpPUaqd1gV+1x6k7wDocDtvUO80wgyAXW5egMi5iTQxUjUgkLsLiSzBFEIZHUK+bySo2CrWuw1GtMzQJTu0BcLhFlCWY2ROAizKzAwkm2gY2Ym9qQ/cT5LsJ7GWCrPkHl86ioJDgzY0BSrSB2Ej8qHxM9h28EZjpk+Fpgqhd4rwNMdYhJPfonxRzbYjcKUodIkJLp7bJKUbkan3aPzOXInHpgb3PmdzYbYUZ8mj201aDyeVYbJHqFmREQzZIbMfQD/nfRyLRtC4/mKtUfCJ18CF6vVwz0DAP6YRT/+vpClmecSKsf+ru/59+n02k8IQ3rymxYcNFIhIXE7XrjIEoY7oIU/Pb2BqXUw/dsH4LmLji3MQtGZfJSsO97OOfYvhKkk3ddd//L5gM+jUcjuSm32+1l0q/1zD8L0ik9+h6pKRO9gG8jhKVEf+tfFv534ed1uVzGb5kuhcworOoNPvQWe52zIBe8/7Z/w68TsiAV8ng48lB2hw7d8cjt/xfwDUW3VdtyfWkSfgJNCG8ICdssoQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/fd78e5f9591acd3cfe7575a605799216/8ac56/streaming-ssr.webp 240w,
/static/fd78e5f9591acd3cfe7575a605799216/d3be9/streaming-ssr.webp 480w,
/static/fd78e5f9591acd3cfe7575a605799216/ff4b8/streaming-ssr.webp 602w&quot;
              sizes=&quot;(max-width: 602px) 100vw, 602px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/fd78e5f9591acd3cfe7575a605799216/8ff5a/streaming-ssr.png 240w,
/static/fd78e5f9591acd3cfe7575a605799216/e85cb/streaming-ssr.png 480w,
/static/fd78e5f9591acd3cfe7575a605799216/32056/streaming-ssr.png 602w&quot;
            sizes=&quot;(max-width: 602px) 100vw, 602px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/fd78e5f9591acd3cfe7575a605799216/32056/streaming-ssr.png&quot;
            alt=&quot;streaming-ssr&quot;
            title=&quot;streaming-ssr&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이 방식을 이용하면 &lt;strong&gt;전통적인 HTML 스트리밍 방식과 다르게 탑다운 순서로 진행될 필요도 없다.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Suspense를 경계로하여 서버에서 콘텐츠 렌더링이 완료되는 순서대로 클라이언트로 내려보낸다.&lt;/li&gt;
&lt;li&gt;내려보내지는 컨텐츠는 클라이언트가 수신하는대로 즉시 화면에 그려지고 hydrate된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;br /&gt;
&lt;h2 id=&quot;그래서-결과적으로-어떤게-개선되나요&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B7%B8%EB%9E%98%EC%84%9C-%EA%B2%B0%EA%B3%BC%EC%A0%81%EC%9C%BC%EB%A1%9C-%EC%96%B4%EB%96%A4%EA%B2%8C-%EA%B0%9C%EC%84%A0%EB%90%98%EB%82%98%EC%9A%94&quot; aria-label=&quot;그래서 결과적으로 어떤게 개선되나요 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;그래서 결과적으로 어떤게 개선되나요?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;기존 SSR의 단점으로 여겨지던 늦은 &lt;strong&gt;TTFB(Time To First Byte, 페이지를 요청했을 때 서버에서 데이터의 첫번째 바이트가 도착하는 시점)&lt;/strong&gt; 를 당길 수 있게 된다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FCP(First Contentful Paint, 페이지가 로드되기 시작하고 컨텐츠의 일부가 화면에 렌더링 될 때 까지의 시간)&lt;/strong&gt; 도 개선된다.&lt;/li&gt;
&lt;li&gt;작은 단위로 쪼개어 진행되기 때문에 Hydration 성능도 좋아진다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;결과적으로 사용자는 빠르게 페이지를 보게 되며, 서버 부하도 분산시킬 수 있게 된다.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;stream-with-suspense&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#stream-with-suspense&quot; aria-label=&quot;stream with suspense permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Stream with Suspense&lt;/h2&gt;
&lt;p&gt;Streaming SSR에서 Suspense는 굉장히 핵심적인 역할을 담당한다. 지금까지 수차례 ‘작게 나눈다’고 언급했는데 바로 Suspense를 경계로 UI가 나뉘게 되는 것이다.
Suspense는 비동기 동작을 선언적으로 작성할 수 있게 하는 문법적 설탕 쯤으로 생각했었는데, 이런식으로 활용될 수 있을것이라고는 상상하지 못했다. &lt;code class=&quot;language-text&quot;&gt;if (isLoading)&lt;/code&gt;을 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Suspense&gt;&lt;/code&gt;로 바꾸는 것은 큰 변화가 아닌 것 같지만, 이 과정이 여러 개선점들을 가능하게 해주는 것이다.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;streaming-ssr-찍먹-가능할까요-&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#streaming-ssr-%EC%B0%8D%EB%A8%B9-%EA%B0%80%EB%8A%A5%ED%95%A0%EA%B9%8C%EC%9A%94-&quot; aria-label=&quot;streaming ssr 찍먹 가능할까요  permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Streaming SSR 찍먹 가능할까요 😋?&lt;/h2&gt;
&lt;p&gt;가능한지 여부에 대해서 우선 답한다면 ’&lt;strong&gt;YES&lt;/strong&gt;’ 다. 그러나 기존(Next.js App Router가 나오기 이전)에는 Next.js나 Remix와 같이 SSR를 지원하는 프레임워크를 통해 Streaming SSR을 구현하기에는 어려움이 있었다. 따라서 직접 SSR을 위한 서버를 세팅해야 했고 클라이언트에서도 Suspense를 활용하기 위해 Suspense로 감싸진 컴포넌트 내부에서 의도적으로 promise를 throw 하는 동작을 추가해야 하는 번거로움이 있었다.&lt;/p&gt;
&lt;p&gt;하지만 앞으로는 Next.js의 App Router를 이용해 Streaming SSR을 좀 더 간편하게 구현할 수 있을 것으로 보인다. Next.js의 Doc에서 이와 관련한 부분의 &lt;a href=&quot;https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming#streaming-with-suspense&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;이 글&lt;/a&gt;과 &lt;a href=&quot;https://nextjs.org/docs/app/building-your-application/data-fetching/fetching#async-and-await-in-server-components&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;이 글&lt;/a&gt; 을 참고하면 좋겠다. App Router는 디폴트로 Server Component를 사용하고 있기 때문에 경계로 나누고 싶은 부분을 Suspense로 감싸주고 React Server Component에 async await를 붙여 비동기적으로 렌더링하기만 하면 Streaming SSR을 손 쉽게 맛 볼수 있다. (yummy~😋)&lt;/p&gt;
&lt;p&gt;또한 Client Component에서 React의 use라는 hook을 사용해 비동기적으로 렌더링 하는 방법도 있는데 &lt;a href=&quot;https://github.com/reactjs/rfcs/pull/229&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;use hook&lt;/a&gt;은 아직 RFC에서 논의 중인 단계이기 때문에 실험적인 수준의 찍먹이 가능할 것으로 보인다. (Next.js &lt;a href=&quot;https://nextjs.org/docs/app/building-your-application/data-fetching/fetching#use-in-client-components&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;공식문서&lt;/a&gt;에서도 아직은 Client Component의 데이터 패칭에 있어서 SWR이나 React Query와 같은 라이브러리를 사용하기를 권장하고 있다.)
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;글을-마치며-주절주절&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B8%80%EC%9D%84-%EB%A7%88%EC%B9%98%EB%A9%B0-%EC%A3%BC%EC%A0%88%EC%A3%BC%EC%A0%88&quot; aria-label=&quot;글을 마치며 주절주절 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;글을 마치며 주절주절&lt;/h4&gt;
&lt;p&gt;사실 Streaming SSR에 대한 글을 쓰게 된건 Next.js의 App router를 뜯어보다가 흘러흘러 오게 된 것이다. 최근 Next.js와 React가 서로 앞서거니 뒷서거니 하며 발맞춰 기능을 업그레이드 하는 모습을 보면 약간 경이로운데(…) 그럼과 동시에 궁금한 것은 이들이 그리는 큰 그림은 과연 어디까지 일까 하는 점이다.&lt;/p&gt;
&lt;p&gt;마치 나는 퍼즐 조각 몇 개를 받아들곤 100피스짜리 퍼즐인 줄 알고 우와- 우와- 하며 열심히 맞추고 있었는데, 알고보니 1000피스를 맞춰야 완성되는 퍼즐인 느낌이랄까? 과연 그들이 그리는 그림은 어떤 모습이고 언제부터 이런 그림을 그려왔던걸까 생각해보면 약간 아득해 지는 느낌이다^^.. 부지런히 설명서를 읽고 퍼즐을 맞춰야 그림의 윤곽을 볼 수 있을 것 같다.&lt;/p&gt;
&lt;h4 id=&quot;참고자료&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C&quot; aria-label=&quot;참고자료 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;참고자료&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/reactwg/react-18/discussions/37&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;New Suspense SSR Architecture in React 18&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.logrocket.com/streaming-ssr-with-react-18/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;A guide to streaming SSR with React 18&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://junghan92.medium.com/%EB%B2%88%EC%97%AD-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EB%A0%8C%EB%8D%94%EB%A7%81%EC%9D%98-%EB%AF%B8%EB%9E%98-5b7251bda66d&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;(번역)리액트 렌더링의 미래&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=9xl9X2pfHeI&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;스트리밍 SSR 딥 다이브&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[유치한 마음]]></title><description><![CDATA[오롯이 나만의 공간에서]]></description><link>https://eunsonny.github.io/posts/childish-mind</link><guid isPermaLink="false">https://eunsonny.github.io/posts/childish-mind</guid><pubDate>Wed, 17 May 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;이 블로그는 오롯이 나를 위한 공간이다. 그래서 이 공간에 기술과 개발에 관한 이야기 이외에 개인적인 글도 많이 남겨보려 한다. 사실 개인적인 생각을 글로 남기는 거에 익숙하지 않아서 이게 얼마나 지속될 수 있을지는 잘 모르겠지만(…)&lt;/p&gt;
&lt;p&gt;최근에는 책을 자주 읽고 있다(아니 읽으려고 노력하고 있다, 가 더 적합하려나?). 개발 서적을 제외하고 직접 읽고 싶은 책을 골라 읽는 것이 얼마만인지 모르겠다. 비는 시간만 있으면 맨날천날 핸드폰만 붙잡고 슬롯머신 당기듯 무의미하게 피드 업데이트나 하고 있는 내 모습이 너무 꼴 보기가 싫어서 다른 집중할 만 한 걸 찾은 게 책이다. 아마 이전 같았으면 예능이나 넷플릭스 같은 걸 볼텐데 무슨 이유인지 모르겠지만 최근에는 영상을 집중해서 오래 보기가 어렵다. 알록달록한 화면이 내가 원하지 않아도 시선을 잡아끄는 것이 오히려 불쾌하게 느껴졌다.&lt;/p&gt;
&lt;p&gt;음 어릴 적에는 책을 고르면 주로 추리소설을 골라 읽었다. 마지막 반전이 딱! 범인이 짠! 하면 헉! 하면서 머리가 띵해지는 충격이 좋았다. 뭐 꼭 추리소설이 아니어도 주로 소설책을 골랐다. 그때의 나는 수필류의 글을 기승전결도 없이 밍숭맹숭한 글이라고 생각했고 그래서 손이 잘 안 갔던 것 같다. 딱히 뭔가 말하고자 하는 주제가 있는 것 같지도 않고?&lt;/p&gt;
&lt;p&gt;그런데 요즘 골라 읽는 책은 다 에세이다. 읽고 싶은 책 목록에도 에세이나 인문학책을 위주로 담아놨다. 요즘은 수필이 무엇인가 특별히 말하고자 하는 게 없는 것 같아서 좋다. 단어 이면에 숨어 있는 뜻을 찾으려 노력할 필요도 없고 글자는 그냥 글자로 읽으면 된다. (작가는 무언가를 말하고자 하는 게 있을 수도 있겠지만 적어도 나는 단순하게 읽고 있다.)&lt;/p&gt;
&lt;p&gt;그냥… 내 기분 탓인지 모르겠지만 글은 다른 어떤 것들에 비해서 더 솔직한 느낌이다. 그래서 누군가가 SNS에 올려둔 백 장의 사진을 보는 것보다 진솔하게 쓰인 한 편의 글을 보는 것이 그 사람에 대해 더 잘 알 수 있다고 생각한다. 글은, 글자는 그런 힘이 있다. 꼭 타인에게 읽혀지기 위해 쓰는 글이 아니어도 나 스스로에게 솔직해질 수 있는 방법이기도 하다.&lt;/p&gt;
&lt;p&gt;나는 그걸 알면서도 개인적인 생각을 글로 잘 남기지 않는 편이었다. 만약 내가 글을 남긴다고 하면 크게 둘 중 하나의 공간 일 텐데 하나는 SNS같이 지인들 그리고 불특정 다수가 내 글을 볼 수 있는 공간 이거나 아니면 나 혼자만 볼 수 있는 일기장이거나?&lt;/p&gt;
&lt;p&gt;SNS같이 공개된 곳은 정말 의식적으로 개인적인 생각 남기기를 꺼렸다. 글재주가 없어서 내가 하고 싶은 말을 제대로 쓰지도 못할 것 같았고 내 속내를 까 보일 진짜 솔직한 글을 쓸 자신도 없었다. 그래서 이것저것 발라내고 나면 결국 남는건 밑도 끝도 없이 ’아 힘들다’ 식의 궁금증 유발형 관종 글이 탄생하고 마는데 이건 더더욱 쓰고 싶지 않았고. 그리고 대부분의 사람들은 이런 타인의 글에 별 관심이 없다는 걸 이미 알고 있었기 때문에.&lt;/p&gt;
&lt;p&gt;사실 그러면 그냥 내 일기장에 혼자 쓰고 혼자 보면 될 일인데 나는 그것도 잘 안 했다. 귀찮음이 가장 큰 이유긴 했지만서도 아마 혼자 보는 글도 쓰지 않은 이유는, 사실은, 아주 모순적이게도 누군가가 내 글을 읽어 주길 간절히 바랬기 때문이다. 아주 솔직하게 그렇다.&lt;/p&gt;
&lt;p&gt;마음속 깊이 누군가가 내 이야기를 궁금해하기를, 나에게 물어주기를, 나를 읽어 주기를 무척이나 바랬다. 그냥 피드 속에 흘러가는 글이 아니라 나를 진심으로 알고 싶어 하기를, 그러면 나는 진솔한 나를 차근차근 꺼내 보일 준비가 되어 있었다고, 그리고 내가 바랬듯이 너를 궁금해하고 너에게 묻고 너를 아주 샅샅이 읽어주어야지 하고, 네가 말하지 않아도 내가 먼저 알아주겠다고&lt;/p&gt;
&lt;p&gt;지금도 이 모순적이고 유치한 마음을 지우지 못해서 이곳에 글을 쓰는 거다. 여기는 오롯이 나를 위한 공간이고 누구나 들어올 수 있고 누구나 볼 수 있지만 일부러 찾아오지 않으면 볼 수 없는 곳이니까. 간혹 우연은 있을 수 있겠지만서도.&lt;/p&gt;
&lt;p&gt;누가 이 글을 보아줄까? 어떤 이유로 이 글을 보게 되었을까?&lt;/p&gt;
&lt;p&gt;지금 내 속내를 까 보이자면, 정말 솔직하게 요즘의 나는 너무 많이 힘들고, 엉망이다. 수없이 발버둥 치며 지내고 있다.&lt;br /&gt;지낸다기보다 버틴다는 말이 더 정확할 만큼.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[일 잘하는 개발자란?]]></title><description><![CDATA[누구야 나와]]></description><link>https://eunsonny.github.io/posts/who-is-a-good-developer</link><guid isPermaLink="false">https://eunsonny.github.io/posts/who-is-a-good-developer</guid><pubDate>Tue, 25 Apr 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;최근 내가 맡은 회사 프로젝트에 React-Query를 도입하고 그 사용범위를 점차 넓혀가는 작업을 하고 있다. 마이그레이션 작업 자체는 까다롭고 귀찮기도 한데 상당히 재밌게 하고 있다. 아마도 그 이유는 내가 이 기술의 도입을 주도적으로 이끌었기 때문일 것이다. React-Query는 도입해 보고 싶은 기술이긴 했는데 단순히 ‘요즘 다들 많이 쓰니까-‘가 아니라 지금 프로젝트에 구조적인 개선을 가져올 것이라는 합리적인 근거를 기반으로 도입을 결정했다. 나 스스로와 팀원들을 설득하기 위해 ‘왜 도입해야 하는가’에 대해 고민했고 납득할 만한 근거를 찾았다.&lt;/p&gt;
&lt;p&gt;그런데 어쨌거나 저쨌거나 React-Query 마이그레이션 작업은 눈에 보이지 않는 개선이기도 하고, 작업량이 며칠 만에 뚝딱 될만한 양은 아니라 항상 최우선 순위로 작업하는 테스크는 아니다. 기획 &amp;#x26; 마케팅에서 요구하는 변경 사항이나 다른 피쳐 개발이 있으면 그 업무들이 일 순위가 되고 마이그레이션 작업은 잠시 뒤로 밀렸다가 다른 우선순위 작업이 완료되면 다시 마이그레이션 작업을 하는 식으로 틈틈이 하고 있다. 사실 마음 같아서는 진득하니 마이그레이션 업무만 하고 싶다는 생각이 스멀스멀 피어올랐다. 자꾸 업무 컨텍스트가 스위칭 되는 게 피곤하기도 하고…&lt;/p&gt;
&lt;p&gt;이런 업무 루틴 속에서 최근 마케팅팀의 요청으로 했던 우선순위 작업 중 하나가 Facebook pixel 세팅 작업이었다. Facebook pixel은 Facebook을 통해서 우리 서비스에 유입된 사람들의 행동을 트래킹 할 수 있는 유저 트래킹 툴이다. 근데 이거 영, 문서도 불친절한 것 같고, 적용 사례도 잘 안 찾아지고 해서 세팅 작업을 진행하는 내내 귀찮다는 마음이 커졌다. (근데 결과적으로 &lt;a href=&quot;https://github.com/vercel/next.js/tree/canary/examples/with-facebook-pixel&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;요거&lt;/a&gt; 찾아서 잘 세팅했음 😇)&lt;/p&gt;
&lt;p&gt;그리고 생각해 보자구, 내가 이력서를 쓴다고 할 때 “React-Query 도입을 통한 어쩌구 저쩌구…” 한 줄은 쓸지 몰라도, “Facebook pixel 세팅”이라는 한 줄을 쓰게 될까? 이 업무가 나한테 어떤 기술적인 성장이나 깨달음을 주는 것도 아니고 말이야… 흐음’ 뭐 이런 생각들을 하고 있었는데, 순간 이건 지극히 개발만을 위한 개발자의 관점이라는 생각이 들었다.&lt;/p&gt;
&lt;p&gt;내가 만약 마케팅팀이였다면 사실 React-Query가 무엇인지 알 바인가? “트래킹 툴 적용 좀 해주세요” 하면 삼십분 뒤에 “적용 됐습니다”라고 말해주는 개발자랑 일하고 싶지 않을까? 그리고 마케팅팀 입장에서는 그런 개발자가 일 잘하는 개발자로 여겨지지 않을까(다소 비약적이긴 하다만…🤔)? 더 나아가서 만약 마케팅팀이 트래킹 툴에서 얻어진 데이터를 기반으로 더 효율적인 전략을 마련하고 그게 수익 창출로 이어진다면, 회사 입장에서도 그게 일 잘하는 개발자 아닌가?&lt;/p&gt;
&lt;p&gt;… 음 여튼 서론이 길었는데 일 잘하는 개발자는 하드 스킬이 뛰어난 개발자와 동의어가 아니라는 것을 말하고 싶다. 개인마다 생각의 차이는 있겠지만 적어도 나는 그렇게 생각한다. 그런 점에서 나는 그토록 잘하고 싶어 몸부림치면서도 하드 스킬을 키우는 것에만 너무 집중하지 않았는지 스스로를 되돌아볼 필요가 있겠다.&lt;/p&gt;
&lt;p&gt;그런데 일단 나 역시도 그랬고 ‘개발자’라는 역할에 몰입해 일을 하다보면 ‘기술을 위한 개발’에 몰두하게 되는 경우가 많은 것 같다. 하지만 잊지 말아야 할 점은 기술은 목적이 아니라 가치를 실현하기 위한 수단이며, 가치는 사람들이 서비스를 이용함으로써 생길 수 있다는 점이다. 프로 스포츠 선수들에게 관중(팬)이 없다면 그건 그저 공놀이에 그친다. 나는 기술(개발)도 마찬가지라고 생각한다. 제아무리 기술적으로 뛰어난 서비스라고 해도 아무도 사용하지 않는다면 무슨 소용이 있을까? 서비스 위에 기술이 있는 것이 아니라 기술 위에 서비스가 있다는 점을 잊지 말자. 서비스가 생명력을 가지고 있을 때 기술도 그 가치를 더 할 수 있다. 기술을 위한 개발은 사이드 프로젝트나 토이 프로젝트서 충분히 할 수 있다.
&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;​-&lt;br /&gt;
근데 참 아이러니하게도 기술을 위한 개발을 할 때 재밌는 경우가 많은 것 같다(…)
그래서 회사의 상황이나 프로젝트의 성숙도가 ‘기술을 위한 개발을 해야 하는 경우일 때’ 개발자가 몰입해서 일할 수 있는 환경이 쉽게 조성되는 듯 하다. 아니면 서비스를 위한 개발 테스크를 쳐내고 기술을 위한 개발을 고민할 시간이 주어지는 환경이라면 그것도 좋겠다.
&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;​-&lt;br /&gt;
물론 당연히! 서비스를 위한 개발과 기술을 위한 개발이 항상 따로 있는 것은 아니다. 오히려 두 가지가 공존하는 경우가 많고, 최근에 서비스의 유의미한 개선 + 기술적인 깨달음 포인트가 동시에 왔던 테스트는 모바일 웹 뷰 테스크였는데 이것도 조만간 글로 정리해 블로그에 포스팅할 수 있도록 해보아야겠다.
&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;​-&lt;br /&gt;
내가 지금의 업무에 어느 정도 만족을 느끼는 포인트는 조직이 개편되고 내가 메인으로 맡는 프로젝트가 바뀌면서 기술을 위한 개발을 고민할 여유가 조금 생겼고, 시도해 볼 수 있는 환경이 조성됐다는 점이다. 아마 이렇게 조직이 바뀌지 않았다면 이직에 대한 욕구가 훨씬 강렬했을 것이고, 주도적인 성장 포인트를 찾는데에 보다 큰 어려움을 느끼고 있었을 것이다. 내가 지금 할 수 있는 최대한의 것을 하고 최대한의 것을 얻어야 한다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[React Query를 왜 그리고 어떻게 써야할까?]]></title><description><![CDATA[우리 그냥 쓰진 말자구 😋]]></description><link>https://eunsonny.github.io/posts/Why-and-how-should-I-use-React-Query</link><guid isPermaLink="false">https://eunsonny.github.io/posts/Why-and-how-should-I-use-React-Query</guid><pubDate>Sun, 16 Apr 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;사내 프로젝트에 React Query 도입을 추진하며 팀원들에게 공유했던 글을 블로그에도 올려본다. 이 글을 작성하며 스스로 정리도 많이 되었고 새로운 기술 도입에 있어서 ‘그냥 좋으니까 쓰자’가 아닌 근거있는 제안을 할 수 있게 되어서 좋았던 경험이었다.&lt;/p&gt;
&lt;h2 id=&quot;우리가-이제껏-서버-데이터를-다루는-방식은요-&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9A%B0%EB%A6%AC%EA%B0%80-%EC%9D%B4%EC%A0%9C%EA%BB%8F-%EC%84%9C%EB%B2%84-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EB%8B%A4%EB%A3%A8%EB%8A%94-%EB%B0%A9%EC%8B%9D%EC%9D%80%EC%9A%94-&quot; aria-label=&quot;우리가 이제껏 서버 데이터를 다루는 방식은요  permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;우리가 이제껏 서버 데이터를 다루는 방식은요 🫢&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;서버로부터 데이터를 받아온다&lt;/li&gt;
&lt;li&gt;State에 값을 저장하고 해당 값을 이용해 화면을 렌더링 한다.&lt;/li&gt;
&lt;li&gt;전역적으로 필요한 값의 경우에는 State가 아닌 전역상태관리(Ex. Redux, mobx, recoil 등)의 Store에 저장하여 값을 다룬다.&lt;/li&gt;
&lt;li&gt;필요에 따라 State(또는 store)에 담긴 상태 값을 업데이트하며 사용한다.&lt;/li&gt;
&lt;/ol&gt;
&lt;br /&gt;
&lt;h2 id=&quot;이제껏-이렇게-잘-써왔는데-무슨-문제가-있을까-&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%B4%EC%A0%9C%EA%BB%8F-%EC%9D%B4%EB%A0%87%EA%B2%8C-%EC%9E%98-%EC%8D%A8%EC%99%94%EB%8A%94%EB%8D%B0-%EB%AC%B4%EC%8A%A8-%EB%AC%B8%EC%A0%9C%EA%B0%80-%EC%9E%88%EC%9D%84%EA%B9%8C-&quot; aria-label=&quot;이제껏 이렇게 잘 써왔는데 무슨 문제가 있을까  permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;이제껏 이렇게 잘 써왔는데 무슨 문제가 있을까? 🤔&lt;/h2&gt;
&lt;h3 id=&quot;1-single-source-of-truth&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-single-source-of-truth&quot; aria-label=&quot;1 single source of truth permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. Single Source of Truth&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;For each unique piece of state, you will choose the component that “owns” it.&lt;/strong&gt; This principle is also known as having a &lt;a href=&quot;https://en.wikipedia.org/wiki/Single_source_of_truth&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;“single source of truth”.&lt;/a&gt; It doesn’t mean that all state lives in one place—but that for &lt;em&gt;each&lt;/em&gt; piece of state, there is a &lt;em&gt;specific&lt;/em&gt; component that holds that piece of information. Instead of duplicating shared state between components, &lt;em&gt;lift it up&lt;/em&gt; to their common shared parent, and &lt;em&gt;pass it down&lt;/em&gt; to the children that need it.&lt;br /&gt;
출처: &lt;a href=&quot;https://react.dev/learn/sharing-state-between-components&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://react.dev/learn/sharing-state-between-components&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;리액트는 각 각의 상태값이 &lt;strong&gt;단일한 정보의 원천(Single Source of Truth)&lt;/strong&gt; 이 될 것을 권장한다. 그러나 이 원칙은 자칫 잘못하면 어그러지기 십상이다. 구체적인 예를 들어보겠다. A 컴포넌트와 B 컴포넌트에서 동일하게 유저의 정보가 필요하다고 하자. 만약에 A와 B 컴포넌트에게 공통의 부모가 있다면 우리는 그 부모 컴포넌트에서 유저의 정보를 받아와 A와 B 컴포넌트에 props로 필요한 유저 정보를 내려줄 것이다.&lt;/p&gt;
&lt;p&gt;그런데 만약 두 컴포넌트 사이 공통의 부모 컴포넌트가 없다면? 그리고 무지성으로 A와 B 컴포넌트 각 각 유저정보를 호출하여 각자의 State에 담아 사용한다면? 그 순간 &lt;strong&gt;Single Source of Truth&lt;/strong&gt;의 원칙은 깨지고 만다. 이 상태에서 더 나아가 각 각의 컴포넌트에서 유저 정보를 다른 형태로 업데이트하여 사용한다면, 과연 어떤 데이터가 가장 최신화된 현재의 상태 값인지를 신뢰하기 힘들어지게 된다.&lt;/p&gt;
&lt;p&gt;그래서 우리는 &lt;strong&gt;Single Source of Truth&lt;/strong&gt; 와 같은 원칙을 지키고, props drilling과 같은 불편함을 없애기 위해 전역상태관리 시스템을 사용하게 된다. 서버의 데이터를 받아와 Store에 저장해 놓고 어떤 컴포넌트이던 해당 값을 참조하게 되면 Store라는 단일한 정보의 원천을 바라보게 되는 것이다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;아니 그런데 잠깐! 이것으로 진짜 Single Source of Truth의 원칙이 지켜졌다고 볼 수 있을까?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;서버 데이터(Server state)가 서버를 떠나 클라이언트의 Store(혹은 state)에 저장되는 순간 이 데이터는 원본이 아니라 서버 데이터의 복사본일 뿐이며 클라이언트의 상태 값으로 바뀌게 된다. 결국은 복사본이 되었다는 점에서 Store를 사용하는 방식도 진정으로 단일한 정보의 원천이 맞는지에 대해 의문이 든다. 🧐&lt;/p&gt;
&lt;h3 id=&quot;2-방대한-보일러-플레이트-코드&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-%EB%B0%A9%EB%8C%80%ED%95%9C-%EB%B3%B4%EC%9D%BC%EB%9F%AC-%ED%94%8C%EB%A0%88%EC%9D%B4%ED%8A%B8-%EC%BD%94%EB%93%9C&quot; aria-label=&quot;2 방대한 보일러 플레이트 코드 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. 방대한 보일러 플레이트 코드&lt;/h3&gt;
&lt;p&gt;또한 우리는 전역 상태관리 시스템에서 서버에서 가져온 비동기 데이터를 관리하기 위해 거대한 보일러 플레이트 코드를 작성해야 하기도 했다. 사실 나는 redux를 제대로 써본적이 없어 redux-thunk나 redux-saga를 이용해 비동기를 핸들링하는 코드를 직접 작성해 본 적은 없지만(…) 그 악명에 대해서는 전해 들은 바가 많다.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;그래서-react-query는요&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B7%B8%EB%9E%98%EC%84%9C-react-query%EB%8A%94%EC%9A%94&quot; aria-label=&quot;그래서 react query는요 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;그래서 React-Query는요!&lt;/h2&gt;
&lt;p&gt;리액트 쿼리는 이러한 기존의 상태값 관리에서 나아가 새로운 관점을 주장한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Global state&lt;/code&gt;는 Client와 Server로 분류할 수 있고, 이 두 state는 다른 방식으로 다뤄져야 효율적이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Server state&lt;/code&gt;: 서버에서 가져오는 데이터들도 하나의 상태이다!&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Server-State&lt;/code&gt;과 &lt;code class=&quot;language-text&quot;&gt;Client-State&lt;/code&gt;의 구분
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Client State&lt;/code&gt; : 세션간 지속적이지 않는 데이터, 동기적, 클라이언트가 소유, 항상 최신 데이터로 업데이트(렌더링에 반영)
&lt;ul&gt;
&lt;li&gt;ex) 리액트 컴포넌트의 state, 동기적으로 저장되는 redux store의 데이터&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Server State&lt;/code&gt; : 세션간 지속되는 데이터, 비동기적, 세션을 진행하는 클라이언트만 소유하는게 아니고 공유되는 데이터도 존재하며 여러 클라이언트에 의해 수정될 수 있음, 클라이언트에서는 서버 데이터의 스냅샷만을 사용하기 때문에 클라이언트에서 보이는 서버 데이터는 항상 최신임을 보장할 수 없음.
&lt;ul&gt;
&lt;li&gt;ex) 리액트 앱에서는 비동기 요청으로 받아올 수 있는, 백엔드 DB에 저장되어있는 데이터&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;이러한 관점을 따른다면 우리는 상태 값을 다음과 같은 형태로 나누어 볼 수 있겠다.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Server state&lt;/code&gt;: 서버에서 받아오는 데이터&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Client State&lt;/code&gt;:
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;local(UI) state&lt;/strong&gt;: Input의 value, Checkbox의 선택 여부(checked), 모달을 숨겼다 보여주는 값 등 하나 또는 여러 개의 컴포넌트에서 다루는 상태 값&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Global State&lt;/strong&gt;: 다수의 컴포넌트를 넘나들며 전역적으로 사용되는 상태 값. 전역상태관리의 Store에 담아 이용하는 값들이라고 볼 수 있음. ex.다크모드 여부, 고정된 Nav에서 보여져야 하는 상태 값, 로그인 여부 등&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;URL State&lt;/strong&gt;: URL에 포함된 상태 값. 쿼리 스트링, 쿼리 파라미터 값&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;br /&gt;
&lt;h2 id=&quot;stale-while-revalidate-전략&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#stale-while-revalidate-%EC%A0%84%EB%9E%B5&quot; aria-label=&quot;stale while revalidate 전략 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Stale-While-Revalidate 전략&lt;/h2&gt;
&lt;p&gt;즉 React Query는 Server state를 Client state와 분리하여 다룰 수 있게 해주는 툴이며, 보다 효과적으로 Server state를 다루기 위해 &lt;code class=&quot;language-text&quot;&gt;stale-while-revalidate&lt;/code&gt; 전략(캐시 패러다임)을 사용하고 있다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;stale-while-revalidate&lt;/code&gt; 는 &lt;strong&gt;1) 캐시된 응답이 오래될 수 있다고 가정하는 부분&lt;/strong&gt;과 &lt;strong&gt;2) 그 캐시된 응답을 재검증하는 프로세스&lt;/strong&gt; 두 부분으로 나뉜다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// HTTP Response Cache-Control Header&lt;/span&gt;
Cache&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Control&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; max&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;age&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; stale&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;revalidate&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;59&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;1) Cache-Control Header의 max-age를 확인&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;아직 만료되지 않았으면 → Do nothing&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;2) 만료되었으면 stale-while-revalidate 값을 확인&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;stale-while-revalidate 값을 넘지 않았다면
&lt;ul&gt;
&lt;li&gt;일단 캐싱된 값을 반환&lt;/li&gt;
&lt;li&gt;동시에 향후 사용을 위해 데이터를 요청하여 최신화&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;넘었다면
&lt;ul&gt;
&lt;li&gt;데이터를 새로 요청해서 최신화&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;br /&gt;
&lt;h2 id=&quot;써보니-이런게-좋던데요-&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%8D%A8%EB%B3%B4%EB%8B%88-%EC%9D%B4%EB%9F%B0%EA%B2%8C-%EC%A2%8B%EB%8D%98%EB%8D%B0%EC%9A%94-&quot; aria-label=&quot;써보니 이런게 좋던데요  permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;써보니 이런게 좋던데요? 😋&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;비동기 로직을 보다 선언적인 코드로 작성할 수 있으며, (과거 redux saga같이 장황한 것들을 이용할 필요 없이) 작은 보일러 플레이트 코드로 사용할 수 있다.&lt;/li&gt;
&lt;li&gt;서버 상태를 관리하는 레이어 전체를 추상화 시켜 서버 데이터와 UI 레이어의 관심사를 분리한 코드 작성이 가능해졌다.&lt;/li&gt;
&lt;li&gt;캐싱을 이용하여 불필요한 데이터 요청을 줄일 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;br /&gt;
&lt;h2 id=&quot;중요한-기본사항들&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A4%91%EC%9A%94%ED%95%9C-%EA%B8%B0%EB%B3%B8%EC%82%AC%ED%95%AD%EB%93%A4&quot; aria-label=&quot;중요한 기본사항들 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;중요한 기본사항들&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Query들은 4개의 상태를 가지며, useQuery가 반환하는 객체의 프로퍼티로 어떤 상태인지 확인이 가능하다.
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;fresh&lt;/code&gt; : 새롭게 추가된 쿼리 인스턴스 → active 상태의 시작, 기본 staleTime이 0이기 때문에 아무것도 설정을 안해주면 호출이 끝나고 바로 stale 상태로 변한다. staleTime을 늘려줄 경우 fresh한 상태가 유지되는데, 이때는 쿼리가 다시 마운트되도 패칭이 발생하지 않고 기존의 fresh한 값을 반환한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;fetching&lt;/code&gt; : 요청을 수행하는 중인 쿼리&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;stale&lt;/code&gt; : 인스턴스가 존재하지만 이미 패칭이 완료된 쿼리. 특정 쿼리가 stale된 상태에서 같은 쿼리 마운트를 시도한다면 캐싱된 데이터를 반환하면서 리패칭을 시도한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;inactive&lt;/code&gt; : active 인스턴스가 하나도 없는 쿼리. inactive된 이후에도 cacheTime 동안 캐시된 데이터가 유지된다. cacheTime이 지나면 GC된다.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;어떻게 inactive가 되는가? : 렌더링간에 다시 호출되지 않고 언마운트되는 쿼리들은 inactive가 된다.&lt;/li&gt;
&lt;li&gt;다음의 경우에는 리패칭이 일어난다
&lt;ol&gt;
&lt;li&gt;런타임에 stale인 특정 쿼리 인스턴스가 다시 만들어졌을 때 (refetchOnMount 옵션으로 끄고 키는게 가능)&lt;/li&gt;
&lt;li&gt;window가 다시 포커스가 되었을 때(refetchOnWindowFocus 옵션으로 끄고 키는게 가능)&lt;/li&gt;
&lt;li&gt;네트워크가 다시 연결 되었을 때(refetchOnReconnect 옵션으로 끄고 키는게 가능)&lt;/li&gt;
&lt;li&gt;refetch interval이 있을때 : 요청 실패한 쿼리는 디폴트로 3번 더 백그라운드단에서 요청하며, retry, retryDelay 옵션으로 간격과 횟수를 커스텀 가능하다.&lt;/li&gt;
&lt;li&gt;개발자가 직접 Mutation 등의 작업 이후 queryClient.invalidateQueries 를 사용해 수동으로 쿼리를 무효화 하여 revalidate 했을 때&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;br /&gt;
&lt;h2 id=&quot;react-query의-라이프사이클&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#react-query%EC%9D%98-%EB%9D%BC%EC%9D%B4%ED%94%84%EC%82%AC%EC%9D%B4%ED%81%B4&quot; aria-label=&quot;react query의 라이프사이클 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;React-query의 라이프사이클&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;‘a’ 쿼리 인스턴스가 mount 됨&lt;/li&gt;
&lt;li&gt;네트워크에서 데이터 fetching 하고 ‘a’라는 query key로 캐싱&lt;/li&gt;
&lt;li&gt;받아온 데이터는 fresh 상태에서 staleTime (default 0) 이후 stale 상태로 변경&lt;/li&gt;
&lt;li&gt;‘a’ 쿼리 인스턴스가 unmount 되고 쿼리의 상태 값이 inactive로 변경&lt;/li&gt;
&lt;li&gt;캐시는 inactive 상태에서 cacheTime (default 5 mins) 만큼 유지되고 그 이후엔 가비지 컬렉팅&lt;/li&gt;
&lt;li&gt;만일 cacheTime이 지나기 전에 ‘a’ 쿼리 인스턴스가 새롭게 mount되면 refetching 되고 fresh한 값을 가져오는 동안 캐시된 데이터를 보여줌&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;cf 1.&lt;/strong&gt; 쿼리가 언마운트되거나 더 이상 사용하지 않을 때 ⇒ 마지막 인스턴스가 언마운트되어 inactive 상태가 되었을때 5분(cacheTime의 기본값)이 지나면 자동으로 삭제한다.&lt;br /&gt;
&lt;strong&gt;cf 2.&lt;/strong&gt; cacheTime은 stateTime과 관계없이 무조건 inactive된 시점을 기준으로 캐시 데이터 삭제. &lt;br /&gt;
&lt;strong&gt;cf 3.&lt;/strong&gt; cf.2의 규칙에 따라 cacheTime은 stateTime보다 길게 잡아야한다. 그렇지 않으면 쿼리가 fresh함에도 불구하고 캐시 데이터가 삭제되어 데이터를 리패칭하는 상황이 발생하기 때문. (&lt;a href=&quot;https://www.codemzy.com/blog/react-query-cachetime-staletime&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;참고&lt;/a&gt;)
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;react-query를-좀-더-자알-사용하는-방법들-&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#react-query%EB%A5%BC-%EC%A2%80-%EB%8D%94-%EC%9E%90%EC%95%8C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95%EB%93%A4-&quot; aria-label=&quot;react query를 좀 더 자알 사용하는 방법들  permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;React Query를 좀 더 자알 사용하는 방법들 😋&lt;/h2&gt;
&lt;p&gt;기본적인 사용 방법에 대해서는 공식문서에 너무 잘 나와있기 때문에 그보다는 어떻게 해야 좀 더 잘 쓸 수 있는지에 대한 방법을 공유하고자 한다.&lt;/p&gt;
&lt;h3 id=&quot;1-실시간으로-변하지-않는-값을-한번만-받아와서-재-사용하고-싶을-때&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%EC%8B%A4%EC%8B%9C%EA%B0%84%EC%9C%BC%EB%A1%9C-%EB%B3%80%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B0%92%EC%9D%84-%ED%95%9C%EB%B2%88%EB%A7%8C-%EB%B0%9B%EC%95%84%EC%99%80%EC%84%9C-%EC%9E%AC-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%9D%84-%EB%95%8C&quot; aria-label=&quot;1 실시간으로 변하지 않는 값을 한번만 받아와서 재 사용하고 싶을 때 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1) 실시간으로 변하지 않는 값을 한번만 받아와서 재 사용하고 싶을 때&lt;/h3&gt;
&lt;p&gt;UI를 그릴때 필요한 행정구역 정보, 국가 리스트 등의 데이터는 실시간으로 바뀌지 않는 정보 값들이지만 그 양이 많아 서버로부터 받아오곤 한다. 이런 데이터들은 처음 한번만 호출한 뒤 캐싱하여 재활용함으로써 서버 요청을 줄일 수 있다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;💡 staleTime: Infinity, cacheTime: Infinity로 설정한다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;staleTime을 Inifinity로 설정하게 되면, 데이터를 한번 받아오면 언제나 fresh한 것으로 간주된다. cacheTime (default. 5mins) 내에 인스턴스가 언마운트 되었다가 다시 마운트 되면 데이터는 fresh 상태이기 때문에 refetch 하지 않는다.&lt;/li&gt;
&lt;li&gt;그러나 인스턴스가 언마운트 되고(쿼리가 inactive 상태로 변한다.), cacheTime이 지나면 가비지 컬렉팅 되기 때문에, 이 이후에 다시 마운트되면 refetch 된다.&lt;/li&gt;
&lt;li&gt;따라서 런타임 내내 처음 한번만 받아와 계속 사용하고 싶다면, staleTime, cacheTime 모두 Infinity로 설정하면 된다.&lt;/li&gt;
&lt;li&gt;쿼리 값은 계속 fresh한 상태이며, cacheTime이 Infinity이기 때문에 GC되지 않는다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-invalidation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-invalidation&quot; aria-label=&quot;2 invalidation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2) Invalidation&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;useQuery를 이용해 &lt;code class=&quot;language-text&quot;&gt;queryKey: [’user’]&lt;/code&gt; 의 정보를 받아온다 -&gt; user 정보가 캐싱된다.&lt;/li&gt;
&lt;li&gt;유저가 닉네임을 변경한다(mutation). -&gt; mutate가 성공하면 유저 정보가 변경되면서 캐싱되어 있던  &lt;code class=&quot;language-text&quot;&gt;queryKey: [’user’]&lt;/code&gt; query의 상태가 stale 하게 변한다.&lt;/li&gt;
&lt;li&gt;이 경우, useQuery를 이용하여 &lt;code class=&quot;language-text&quot;&gt;queryKey: [’user’]&lt;/code&gt;를 리패칭하려고 시도할 수 있으나 그러지 말고,&lt;/li&gt;
&lt;li&gt;invalidateQueries 메소드를 사용하여 개발자가 명시적으로 query가 stale되는 지점을 지정해 줄 수 있다. 해당 메소드가 호출되면 쿼리가 바로 stale되고, 리패치가 진행된다. Mutation 생명주기(onSuccess 옵션) 내에서 해주면 자연스럽다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useMutation&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; useQueryClient &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-query&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queryClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useQueryClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 뮤테이션이 성공한다면, 쿼리의 데이터를 invalidate해 관련된 쿼리가 리패치되도록 만든다.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mutation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useMutation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;addTodo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;onSuccess&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    queryClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invalidateQueries&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    queryClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invalidateQueries&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;reminders&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;또한 mutation으로 요청 후 서버에서 받는 response값이 갱신된 새로운 데이터일 경우도 있다. 이럴때는 mutation을 성공했을 때 쿼리 데이터를 명시적으로 바꿔주는 queryClient 인스턴스의 setQueryData 메소드를 사용하면 좋다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queryClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useQueryClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mutation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useMutation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;editTodo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;onSuccess&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; queryClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setQueryData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;todo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

mutation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mutate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Do the laundry&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 뮤테이션의 response 값으로 업데이트된 data를 사용할 수 있다.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; status&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;todo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fetchTodoByID&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;3-initialdata-활용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-initialdata-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;3 initialdata 활용하기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3) initialData 활용하기&lt;/h3&gt;
&lt;p&gt;initialData 옵션을 사용하면 &lt;strong&gt;쿼리의 초기 데이터를 설정하고 초기 로딩 상태를 건너 뛸 수 있다&lt;/strong&gt;. initialData는 캐시에도 유지되기 때문에, 불완전한 데이터를 제공하지 않는 것이 좋다. 불완전한 데이터의 경우에는 initialData가 아닌 placeholderData 옵션을 이용하자!&lt;/p&gt;
&lt;p&gt;다른 쿼리의 캐시된 결과에서 쿼리의 초기 데이터를 제공할 수 있다. 예를 들어 할일 목록 쿼리에서 캐시된 데이터를 검색하여 개별 할일 항목을 찾은 다음 이를 개별 할일 쿼리의 초기 데이터로 사용하는 것을 좋은 예로 들 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;queryKey&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;todo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; todoId&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;queryFn&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/todos&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;initialData&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Use a todo from the &apos;todos&apos; query as the initial data for this todo query&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; queryClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getQueryData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;todos&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; d&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; todoId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;4-쿼리-키를-의존성-배열로-생각하자&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-%EC%BF%BC%EB%A6%AC-%ED%82%A4%EB%A5%BC-%EC%9D%98%EC%A1%B4%EC%84%B1-%EB%B0%B0%EC%97%B4%EB%A1%9C-%EC%83%9D%EA%B0%81%ED%95%98%EC%9E%90&quot; aria-label=&quot;4 쿼리 키를 의존성 배열로 생각하자 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4) 쿼리 키를 의존성 배열로 생각하자&lt;/h3&gt;
&lt;p&gt;그간 우리는 기본적으로 어떠한 비동기 호출을 명령형에 가까운 방식으로 처리해왔다. 그러나 React Query를 이용하면 &lt;code class=&quot;language-text&quot;&gt;이 비동기 요청은 state가 x인 경우의 결과물이다&lt;/code&gt; 는 식의 선언형으로 호출할 수 있게 된다. 만약 state의 값이 바뀐다면 쿼리 키 배열의 변화를 감지하여 자동으로 새로운 요청을 보낸다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setState&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setData&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; res &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetchTodos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;setData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;res&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;useTodosQuery&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; State&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;useQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;todos&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetchTodos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이러한 컨셉을 이해한다면 아래와 같이 &lt;code class=&quot;language-text&quot;&gt;refetch&lt;/code&gt; 가 실행될 상황이나, 함수 인자로 특정 요청에 필요한 id를 넘기지 않게 될 것이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 잘못된 예시&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; refetch &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;item&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetchItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 🚨 this is not how it works&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;refetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Show Item &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;데이터 요청이 state(&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;)에 의존하도록 수정하는 것이 맞다.&lt;/p&gt;
&lt;h3 id=&quot;5-에러-핸들링&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#5-%EC%97%90%EB%9F%AC-%ED%95%B8%EB%93%A4%EB%A7%81&quot; aria-label=&quot;5 에러 핸들링 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5) 에러 핸들링&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Default Options의 onError에 에러 핸들러를 세팅해두면, 에러 발생시 전역 onError에서 Catch된다.&lt;/li&gt;
&lt;li&gt;그러나 개별의 쿼리(useMutation, useQuery)에서 onError를 세팅해두면 개별의 onError 핸들러가 동작하고 해당 에러는 이미 잡혔으므로 상위 스코프로 전파되지 않아, Default Options의 전역 onError 는 동작하지 않는다.&lt;/li&gt;
&lt;li&gt;또한 기본적으로 Error Boundary에서는 비동기 동작에 대한 에러를 캐치하지 못하지만, React Query의 &lt;code class=&quot;language-text&quot;&gt;useErrorBoudnary&lt;/code&gt; 옵션을 사용하면 Error Boundary를 이용해서 데이터 요청에 대한 에러를 핸들링 할 수도 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;cf.&lt;/strong&gt; 참고사항! useMutation과 mutate 함수에 onError/onSuccess 핸들러를 각 각 세팅할 경우 두 개의 핸들러는 모두 동작한다. (그 중 useMutation에 설정된 핸들러가 먼저 동작하는 것으로 보임)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Router 동작방식 알아보기]]></title><description><![CDATA[라우터는 어떤 원리로 동작하는 것일까?]]></description><link>https://eunsonny.github.io/posts/how-routers-work</link><guid isPermaLink="false">https://eunsonny.github.io/posts/how-routers-work</guid><pubDate>Wed, 05 Apr 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;이 글에서는 SPA에서 사용하는 라우터의 동작 원리를 살펴보며 바닐라 JS로 구현한다면 어떻게 구현할지 고민해볼 것이다. 하지만 구체적인 구현은 하지 않을 것이니 참고해주길 😇&lt;/p&gt;
&lt;h2 id=&quot;router의-동작방식&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#router%EC%9D%98-%EB%8F%99%EC%9E%91%EB%B0%A9%EC%8B%9D&quot; aria-label=&quot;router의 동작방식 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Router의 동작방식&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;URL을 변경한다.&lt;/li&gt;
&lt;li&gt;URL의 변경을 클라이언트에서 감지한다.&lt;/li&gt;
&lt;li&gt;변경된 URL에 맞춰 렌더링 해야 할 컴포넌트를 찾고 화면에 그린다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;꽤나 단순하지 않은가? URL에 따라 렌더링 해야할 컴포넌트를 맵핑해 놓고 URL의 변경을 감지하여 그에 맞는 화면을 보여주는 것이다.&lt;/p&gt;
&lt;p&gt;따라서 라우팅 시스템은 &lt;strong&gt;두 가지의 핵심 요소&lt;/strong&gt;를 가진다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;어플리케이션의 경로 목록을 수집하는 레지스트리&lt;/li&gt;
&lt;li&gt;URL의 리스너&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;레지스트리를 정말 단순한 형태로 만들어 본다면 다음과 같겠다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 어플리케이션 경로 목록을 수집하는 레지스트리로, URL에 따라 구성요소를 맵핑한 객체&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; routes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token constant&quot;&gt;URL_A&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ComponentA&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;URL_B&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ComponentB&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token constant&quot;&gt;URL_C&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ComponentC&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 예시에서 URL에 해당하는 key값을 어떤 형태로 사용할 것인가, (해시가 붙어있는 형태로 사용할 것인가? 아닌가?)에 따라 해시 라우터와 브라우저 라우터로 나뉘며 그에 따라 URL 리스너도 달라진다.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;해시-라우터의-경우&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EC%8B%9C-%EB%9D%BC%EC%9A%B0%ED%84%B0%EC%9D%98-%EA%B2%BD%EC%9A%B0&quot; aria-label=&quot;해시 라우터의 경우 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해시 라우터의 경우&lt;/h2&gt;
&lt;p&gt;해시로 시작하는 선택적 부분을 &lt;code class=&quot;language-text&quot;&gt;프래그먼트 식별자&lt;/code&gt;라고 부르는데, 이 값을 key 값으로 사용한다고 보면 된다. 프래그먼트 식별자는 location 객체의 hash 속성에 저장되기 때문에 &lt;code class=&quot;language-text&quot;&gt;window.location.hash&lt;/code&gt;를 통해 그 값을 가져올 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 898px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cf029731536c7494bf6701074787ff5c/84cc5/location-hash.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4ElEQVQY05WNS1LEMAxEfYUcgNj54nz8jR3HkxmKFcX9L9SUVQPDYhaweNUtqSWxEA94H7GsBilfceQbat6gqipwXpM6H5HPNxgbyJ/Xd7hthzae+mUvpgvmRYOFmLCFROGYToT9QuFpXlFmTdNT0NiNnv7206zoaEFpBzmtYJuPOPYM7xxidLBWI+cIYy3mxaAfJLr+FW03kj78+OO/KTVTe0L4+ISKHkaNUEpCa4lxHPBStxBNTzTt8NSL9s69Zp1cwKcFfJCoeQcuetT8yeIfYVx0ELyFKErNh5bZf/kCUqmwSMurXNsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/cf029731536c7494bf6701074787ff5c/8ac56/location-hash.webp 240w,
/static/cf029731536c7494bf6701074787ff5c/d3be9/location-hash.webp 480w,
/static/cf029731536c7494bf6701074787ff5c/005c4/location-hash.webp 898w&quot;
              sizes=&quot;(max-width: 898px) 100vw, 898px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/cf029731536c7494bf6701074787ff5c/8ff5a/location-hash.png 240w,
/static/cf029731536c7494bf6701074787ff5c/e85cb/location-hash.png 480w,
/static/cf029731536c7494bf6701074787ff5c/84cc5/location-hash.png 898w&quot;
            sizes=&quot;(max-width: 898px) 100vw, 898px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/cf029731536c7494bf6701074787ff5c/84cc5/location-hash.png&quot;
            alt=&quot;window.location.hash&quot;
            title=&quot;window.location.hash&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;페이지를 이동하고 싶을 때는 앵커 태그를 이용해서 URL 변경한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;a&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;#/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Go To Index&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;a&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;#/list&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Go To List&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;a&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;#/detail&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Go To Detail&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 &lt;strong&gt;hashChange&lt;/strong&gt;라는 이벤트를 통해서 프래그먼트가 변경될 때마다 알림을 받을 수 있다. &lt;strong&gt;즉 해시 라우터의 URL 리스너는 hashChange 이벤트다.&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;hashChange&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; checkRoutes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;프래그먼트가 바뀔 때마다 &lt;code class=&quot;language-text&quot;&gt;checkRoutes&lt;/code&gt; 함수가 동작할 것이고, &lt;code class=&quot;language-text&quot;&gt;checkRoutes&lt;/code&gt; 내부에서는 프래그먼트가 레지스트리에 있는지 확인한 뒤 그에 맞는 구성요소를 렌더링한다.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;브라우저-라우터의-경우에는&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EB%9D%BC%EC%9A%B0%ED%84%B0%EC%9D%98-%EA%B2%BD%EC%9A%B0%EC%97%90%EB%8A%94&quot; aria-label=&quot;브라우저 라우터의 경우에는 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;브라우저 라우터의 경우에는&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;window.location.pathname&lt;/code&gt;을 key 값으로 사용한다.&lt;/p&gt;
&lt;p&gt;페이지를 이동하고 싶을 때는 HTML5에서 등장한 &lt;a href=&quot;https://developer.mozilla.org/ko/docs/Web/API/History_API&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;History API&lt;/a&gt;를 사용하여 URL을 변경한다. 주요 메서드는 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;back()&lt;/code&gt; :  히스토리에서 이전 페이지로 이동한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;forward()&lt;/code&gt;: 히스토리에서 다음 페이지로 이동한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;go(index)&lt;/code&gt;: 히스토리에서 특정 페이지로 이동한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;pushState(state, title, URL)&lt;/code&gt;: 히스토리 스택의 데이터를 푸시하고 제공된 URL로 이동한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;replaceState(state, title, URL)&lt;/code&gt;: 히스토리 스택에서 가장 최근 데이터를 바꾸고 제공된 URL로 이동한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://developer.mozilla.org/ko/docs/Web/API/Window/popstate_event&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;popState&lt;/a&gt;&lt;/strong&gt; 이벤트는 브라우저의 뒤로가기/앞으로가기 버튼을 클릭하거나, &lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;pushState()&lt;/code&gt;&lt;/strong&gt; 또는 &lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;replaceState()&lt;/code&gt;&lt;/strong&gt; 메서드를 호출하여 URL을 업데이트할 때 발생하며 브라우저 라우터의 URL 리스너로 사용된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;popState&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; checkRoutes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;URL이 업데이트 될 때마다 &lt;code class=&quot;language-text&quot;&gt;checkRoutes&lt;/code&gt; 함수가 동작하고, 해시 라우터에서와 마찬가지로 &lt;code class=&quot;language-text&quot;&gt;checkRoutes&lt;/code&gt; 내부에서는 프래그먼트가 레지스트리에 있는지 확인한 뒤 그에 맞는 구성요소를 렌더링한다.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;또-다른-방법은-없을까&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%98%90-%EB%8B%A4%EB%A5%B8-%EB%B0%A9%EB%B2%95%EC%9D%80-%EC%97%86%EC%9D%84%EA%B9%8C&quot; aria-label=&quot;또 다른 방법은 없을까 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;또 다른 방법은 없을까?&lt;/h2&gt;
&lt;p&gt;또 다른 URL 리스너의 형태로는 &lt;code class=&quot;language-text&quot;&gt;setInterval&lt;/code&gt;을 사용하는 방법이 있다. 주기적으로 pathname이 변경되었는지를 확인하고, 변경 되었으면 그에 맞는 구성요소를 렌더링 하는 것이다. 그러나 이 방식은 정확도가 떨어져 권장되지 않는다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token function&quot;&gt;setInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pathname &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; previousPathname&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;pathname changed to &apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pathname&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    previousPathname &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pathname&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;br /&gt;
&lt;h3 id=&quot;참고사항&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B0%B8%EA%B3%A0%EC%82%AC%ED%95%AD&quot; aria-label=&quot;참고사항 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;참고사항&lt;/h3&gt;
&lt;p&gt;라우터에 관련한 추가적인 참고사항으로는 History API는 IE 9 이하에서 지원되지 않아 모든 브라우저에서 지원되는 브라우저를 개발하기 위해서는 해시 라우터를 사용해야 한다는 점이 있다. 😇
&lt;br /&gt;&lt;/p&gt;
&lt;h3 id=&quot;참고자료&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C&quot; aria-label=&quot;참고자료 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;참고자료&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;(도서) 프레임워크 없는 프론트엔드 개발, 프란세스코 스트라츨로 지음&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://fe-developers.kakaoent.com/2022/221124-router-without-library/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;라이브러리 없이 라우터(Router) 만들기 | 카카오엔터테인먼트 FE 기술블로그&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Browser Router와 Hash Router]]></title><description><![CDATA[잠깐, 이 프로젝트는 왜 해시 라우터로 되어 있는거지?]]></description><link>https://eunsonny.github.io/posts/browser-router-hash-router</link><guid isPermaLink="false">https://eunsonny.github.io/posts/browser-router-hash-router</guid><pubDate>Sun, 26 Mar 2023 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;hash-router-너는-누구니&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#hash-router-%EB%84%88%EB%8A%94-%EB%88%84%EA%B5%AC%EB%8B%88&quot; aria-label=&quot;hash router 너는 누구니 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Hash Router 너는 누구니?&lt;/h2&gt;
&lt;p&gt;회사 어드민 프로젝트에 필터 기능을 구현하기 위해 쿼리스트링을 열심히 달던 중이였다. 그런데 정말 귀신이 곡할 노릇으로 새로 고침만 하면 쿼리스트링 부분이 홀랑 날아가버렸다. 아니 이게 무슨 일이냐고. (헛짚은거 같긴 한데) 해시 라우터 니가 범인이니? 아니 그런데 잠깐(…) 이 프로젝트는 도대체 왜 해시 라우터로 되어 있는거지? &lt;br /&gt;
(깔깔 포인트: 너무나 당연하게도 해시 라우터는 범인이 아니였다. 그저 어떤 HOC에서 의도치 않게 쿼리스트링을 날려버리는 버그가 있었을 뿐 ^^ 결국 이 문제는 잘 해결했다.)&lt;/p&gt;
&lt;p&gt;(… 부끄러운 이야기이지만) 나는 이제껏 경험한 React 프로젝트에서는 모두 Browser Router만을 사용했기 때문에 Hash Router는 친숙하지 않았다.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/45271769c5fe76130557f3d0abd4d1ae/4719e/hash-router-not-recommended.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 16.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAeElEQVQI153NOwoDMQwE0D3CSq5CYmwW/7As1m0w5P63mhBV2ZQpXjODNFt4MKIn1GOHVocjMIgIzHzhnDO/+bfP3SaZ8Von1npingOqHSIDvXe01kwpBbVWzDmRUkLOGSJinapijGFj9vB+I8To4X0AEWMnsuJfb1IOTnW0c7iTAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/45271769c5fe76130557f3d0abd4d1ae/8ac56/hash-router-not-recommended.webp 240w,
/static/45271769c5fe76130557f3d0abd4d1ae/d3be9/hash-router-not-recommended.webp 480w,
/static/45271769c5fe76130557f3d0abd4d1ae/e46b2/hash-router-not-recommended.webp 960w,
/static/45271769c5fe76130557f3d0abd4d1ae/f37ae/hash-router-not-recommended.webp 1330w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/45271769c5fe76130557f3d0abd4d1ae/8ff5a/hash-router-not-recommended.png 240w,
/static/45271769c5fe76130557f3d0abd4d1ae/e85cb/hash-router-not-recommended.png 480w,
/static/45271769c5fe76130557f3d0abd4d1ae/d9199/hash-router-not-recommended.png 960w,
/static/45271769c5fe76130557f3d0abd4d1ae/4719e/hash-router-not-recommended.png 1330w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/45271769c5fe76130557f3d0abd4d1ae/d9199/hash-router-not-recommended.png&quot;
            alt=&quot;https://reactrouter.com/en/main/router-components/hash-router&quot;
            title=&quot;https://reactrouter.com/en/main/router-components/hash-router&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;
심지어 React Router의 공식 문서에도 강력하게 해시 라우터의 사용을 추천하지 않고 있었다. 그런데 왜 이 프로젝트는 무슨 이유로 브라우저 라우터를 사용하지 않고 해시 라우터를 사용한 것일까? 두 라우터 간의 차이점은 뭘까?&lt;/p&gt;
&lt;br /&gt;
&lt;p&gt;여러가지 글을 찾아본 결과 두 라우터가 다음과 같은 특징을 갖고 있음을 알 수 있었다.&lt;/p&gt;
&lt;h3 id=&quot;browser-router&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#browser-router&quot; aria-label=&quot;browser router permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Browser Router&lt;/h3&gt;
&lt;p&gt;Browser Router는 HTML5의 &lt;strong&gt;History API&lt;/strong&gt;를 사용하여 페이지 간의 전환을 처리한다. 이 방식은 실제 URL 경로를 사용하므로 &lt;code class=&quot;language-text&quot;&gt;http://example.com/about&lt;/code&gt; 과 같은 형태의 URL을 가진다. 주요 특징은 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;브라우저 지원: HTML5의 History API를 지원하는 최신 브라우저에서 사용 가능하다.&lt;/li&gt;
&lt;li&gt;서버 요청: URL 경로가 변경되면 서버로 요청이 전송된다. 따라서 서버 측에서도 동일한 경로에 대한 응답을 제공해야 한다.&lt;/li&gt;
&lt;li&gt;깔끔한 URL: 해시(#) 없이 실제 경로를 사용하므로 URL이 깔끔하고 읽기 쉽다.&lt;/li&gt;
&lt;li&gt;새로 고침시에 에러가 발생하며 이를 해결하기 위해서는 &lt;strong&gt;서버에 추가적인 세팅&lt;/strong&gt;이 필요하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;hash-router&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#hash-router&quot; aria-label=&quot;hash router permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Hash Router&lt;/h3&gt;
&lt;p&gt;Hash Router는 URL의 해시(#)를 사용하여 페이지 간의 전환을 처리한다. 예를 들어, &lt;code class=&quot;language-text&quot;&gt;http://example.com/#/about&lt;/code&gt; 과 같은 형태의 URL을 사용한다. 해시(#)는 URL의 일부로 간주되지만 클라이언트 측에서만 해석되고 서버로의 요청에는 포함되지 않는다. 이는 웹 브라우저의 내장된 기능으로 이러한 특징으로 인해 서버 측에서는 항상 동일한 URL(&lt;code class=&quot;language-text&quot;&gt;http://example.com/&lt;/code&gt;)의 요청만을 받게 되고 그 결과 동일한 페이지를 반환하게 된다. 주요 특징은 다음과 같다&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;브라우저 지원: 모든 최신 브라우저에서 사용 가능하다.&lt;/li&gt;
&lt;li&gt;서버 요청: 해시가 변경되어도 서버로 요청이 전송되지 않는다. 즉, 클라이언트 측에서만 라우팅이 처리된다.&lt;/li&gt;
&lt;li&gt;SEO에 취약: 해시 라우터를 사용하면 여러 페이지가 동일한 기본 URL을 공유하게 된다. 예를 들어, &lt;code class=&quot;language-text&quot;&gt;http://example.com/#/about&lt;/code&gt; 과 &lt;code class=&quot;language-text&quot;&gt;http://example.com/#/contact&lt;/code&gt; 라는 두 개의 페이지는 실제로는 동일한 기본 URL인 &lt;code class=&quot;language-text&quot;&gt;http://example.com/&lt;/code&gt;을 공유한다. 이로 인해 검색 엔진은 각각의 페이지를 별개의 인덱스로 처리하기 어려울 수 있다.&lt;/li&gt;
&lt;li&gt;호환성: 구형 브라우저와 호환되는 라우팅 방식이다.&lt;/li&gt;
&lt;li&gt;새로 고침해도 에러가 발생하지 않는다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;대부분의 항목에서 고개를 끄덕이며 읽어 내려오는데, 한 가지 특징에서 의문이 들었다. &lt;strong&gt;Browser Router를 사용하면 새로 고침시에 에러가 난다&lt;/strong&gt;고? 왜?&lt;/p&gt;
&lt;p&gt;이제까지 내가 경험했던 React 기반 프로젝트에서는 React Router의 Browser Router를 사용했으나 새로 고침시에 에러가 나는 현상을 만나지 못했었다. 그럼 내가 썼던 Browser Router는 무엇이었을까? (…) 나도 모르게 누군가가 추가적인 세팅을 해 주었던 것일까? (혹시 코드 우렁각시라도 있는 것일까? 🥺) 그 새로고침 에러를 해결하기 위해선 추가적인 세팅이 필요하다고 하는데, 그 &lt;strong&gt;추가적인 세팅&lt;/strong&gt;이란 과연 무엇일까?&lt;/p&gt;
&lt;br /&gt;
&lt;h2 id=&quot;browser-router를-사용하면-새로-고침시에-에러가-난다던데요-&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#browser-router%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%A9%B4-%EC%83%88%EB%A1%9C-%EA%B3%A0%EC%B9%A8%EC%8B%9C%EC%97%90-%EC%97%90%EB%9F%AC%EA%B0%80-%EB%82%9C%EB%8B%A4%EB%8D%98%EB%8D%B0%EC%9A%94-&quot; aria-label=&quot;browser router를 사용하면 새로 고침시에 에러가 난다던데요  permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Browser Router를 사용하면 새로 고침시에 에러가 난다던데요? 🤔&lt;/h2&gt;
&lt;p&gt;우선 Browser Router 를 사용하면 왜 새로 고침시에 에러가 발생 하는지 근본적인 원인을 살펴보고자 했다.&lt;/p&gt;
&lt;p&gt;MPA(Multi page Application)으로 구현된 웹사이트의 경우, 경로를 이동하면 다음과 같은 동작을 하게 된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;유저가 &lt;code class=&quot;language-text&quot;&gt;www.example.com/about&lt;/code&gt; 페이지로 앵커 태그를 통해 이동을 한다.&lt;/li&gt;
&lt;li&gt;URL이 변경되면 서버에 GET 요청을 보내 &lt;code class=&quot;language-text&quot;&gt;about.html&lt;/code&gt; 을 받아온다.&lt;/li&gt;
&lt;li&gt;브라우저는 &lt;code class=&quot;language-text&quot;&gt;about.html&lt;/code&gt; 이용해 화면을 그린다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;즉, 이 MPA에서 &lt;code class=&quot;language-text&quot;&gt;새로운 화면을 보여준다는 것은 = 새로운 html 파일을 받아온다&lt;/code&gt;, 이며 새로운 페이지를 보기 위해서는 새로고침(과 같은 효과)가 일어나야만 했다. 따라서 유저들은 새로운 html 페이지를 받아올 때까지 하얗게 날아간 화면을 봐야만 했다.
&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;그러나 SPA(Single Page Application)방식의 프레임 워크들이 대두되고 CSR을 하게 되면서 라우팅의 동작 방식이 변하게 된다. SPA는 html은 한번만 받아오고 나머지 화면을 전부 JS로 그리는 형태이다. 따라서 SPA / CSR 상황에서 페이지 이동(라우팅)이 일어날 때는 다음과 같이 동작한다 (+브라우저 라우터 기준이다).&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;React(SPA / CSR)로 구현된 웹 사이트의 홈페이지(인덱스 페이지)에 접속하면 웹 서버에 요청해 html, CSS, JS 파일을 받아온다.&lt;/li&gt;
&lt;li&gt;유저가 버튼을 눌러 다른 페이지로 이동하려고 하면, History API의 pushState를 이용하여 URL을 변경한다.&lt;/li&gt;
&lt;li&gt;이 때 pushState를 이용하면 URL만을 변경하고 웹서버에 요청을 보내지 않는다. (앵커 태그를 이용해 페이지를 이동하면 웹브라우저의 내장 기능에 따라 URL을 변경함과 동시에 자동으로 웹서버에 요청을 보낸다.)&lt;/li&gt;
&lt;li&gt;클라이언트 단에서는 URL의 변경을 감지하여 DOM API가 URL에 알맞는 화면을 그리게 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;URL의 변경과 라우팅은 이뤄지지만 모든 것이 클라이언트 사이드에서 행해지고 서버는 아무런 관계가 없다.
&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;위와 같은 방식의 Browser Router를 이용한 라우팅은 해당 사이트를 사용하는 모든 유저가 무조건 홈페이지(인덱스 페이지 &lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;)로 처음 접속하여 버튼을 눌러서만 이동 한다면, 문제 될 것이 없다. 인덱스 페이지에 접속하는 순간, URL의 요청을 받은 서버는 필요한 자원(Html, CSS, JS)을 제공할 것이고 그 다음 라우팅은 앞서 말한 CSR의 방식으로 동작할 것이기 때문이다. 하지만 유저가 언제나 이렇게 행동할 것이라고 누구도 장담 할 수 없다. 누군가는 F5를 눌러 의도적인 새로 고침을 유도할 것이고, 누군가는 인덱스 페이지가 아닌 다른 페이지(ex. &lt;code class=&quot;language-text&quot;&gt;/about&lt;/code&gt;) 주소를 주소창에 직접 입력하여 바로 접근하고 싶어할 것이다.
&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;그럼 유저가 인덱스 페이지가 아닌 페이지에서 의도적으로 새로 고침을 하거나, 주소를 직접 쳐서 들어오려 되면 어떻게 될까?&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;유저가 &lt;code class=&quot;language-text&quot;&gt;www.example.com/detail&lt;/code&gt; 페이지에서 새로 고침을 시도한다.&lt;/li&gt;
&lt;li&gt;웹브라우저의 내장 기능으로 인해 웹 서버에 파일을 요청하게 된다.&lt;/li&gt;
&lt;li&gt;이 때, 이미 URL은 React Router의 path로 얼룩져 있는 상태이기 때문에, 서버는 그것이 무엇을 반환해 달라는 말인지 알지 못한다. (서버는 인덱스 페이지에 대한 요청에만 무엇을 반환해야 할지 알고 있다.)&lt;/li&gt;
&lt;li&gt;따라서 서버는 404 not found 에러를 반환한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;💡 바로 이 부분이 &lt;strong&gt;Browser Router를 이용하면, 새로 고침시에 에러가 난다!&lt;/strong&gt; 는 것이다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br /&gt;
&lt;h2 id=&quot;그렇다면-browser-router에서-새로-고침시에-에러가-나는-현상을-해결하려면-어떻게-해야-할까&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-browser-router%EC%97%90%EC%84%9C-%EC%83%88%EB%A1%9C-%EA%B3%A0%EC%B9%A8%EC%8B%9C%EC%97%90-%EC%97%90%EB%9F%AC%EA%B0%80-%EB%82%98%EB%8A%94-%ED%98%84%EC%83%81%EC%9D%84-%ED%95%B4%EA%B2%B0%ED%95%98%EB%A0%A4%EB%A9%B4-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4%EC%95%BC-%ED%95%A0%EA%B9%8C&quot; aria-label=&quot;그렇다면 browser router에서 새로 고침시에 에러가 나는 현상을 해결하려면 어떻게 해야 할까 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;그렇다면 Browser Router에서 새로 고침시에 에러가 나는 현상을 해결하려면 어떻게 해야 할까?&lt;/h2&gt;
&lt;p&gt;이를 &lt;strong&gt;해결하는 방법은 크게 2가지&lt;/strong&gt; 이다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;라우터를 Hash Router로 변경한다.&lt;/li&gt;
&lt;li&gt;웹서버 세팅 시에 404 페이지에 대해서 작업한다.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;1-hash-router로-변경한다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-hash-router%EB%A1%9C-%EB%B3%80%EA%B2%BD%ED%95%9C%EB%8B%A4&quot; aria-label=&quot;1 hash router로 변경한다 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1) Hash Router로 변경한다.&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;hash router의 경우 URL이 &lt;code class=&quot;language-text&quot;&gt;www.domain.com/#/path&lt;/code&gt; 과 같은 형태로 이루어지는데, URL의 해시 부분은 서버에 전송되지 않고 브라우저에서만 사용된다.&lt;/li&gt;
&lt;li&gt;서버는 언제나 해시 값을 제외한 &lt;code class=&quot;language-text&quot;&gt;www.domain.com&lt;/code&gt;(인덱스 페이지)에 대한 요청만 받아 들이게 되므로 무엇을 반환해야 하는지 알고 있다.&lt;/li&gt;
&lt;li&gt;따라서 서버 에러가 발생하지 않는다.&lt;/li&gt;
&lt;li&gt;클라이언트에서는 해시 값을 이용해서 라우팅 한다. (클라이언트에서 해시값에 해당하는 페이지가 없을 경우 index.html 만이 노출된다. 빈페이지 같은 것..)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-서버에서-404-페이지에-대한-작업을-한다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-%EC%84%9C%EB%B2%84%EC%97%90%EC%84%9C-404-%ED%8E%98%EC%9D%B4%EC%A7%80%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9E%91%EC%97%85%EC%9D%84-%ED%95%9C%EB%8B%A4&quot; aria-label=&quot;2 서버에서 404 페이지에 대한 작업을 한다 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2) 서버에서 404 페이지에 대한 작업을 한다.&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt; 이외의 path로 서버에 요청할 때 무조건 서버가 무조건 index.html을 리턴하도록 설정해준다. 이 방법이 글 초반에 언급한 &lt;code class=&quot;language-text&quot;&gt;서버의 추가적인 세팅&lt;/code&gt;이다.&lt;/p&gt;
&lt;br /&gt;
&lt;h3 id=&quot;생각해보니&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%83%9D%EA%B0%81%ED%95%B4%EB%B3%B4%EB%8B%88&quot; aria-label=&quot;생각해보니 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;생각해보니&lt;/h3&gt;
&lt;p&gt;브라우저 라우터와 해시 라우터의 근본적인 동작 원리를 알아보고 나니, 왜 어드민에 해시 라우터를 사용했는지 이해되었다. 사내에서만 사용하는 작은 서비스이고 SEO를 고려할 필요도 없기 때문에 따로 추가적인 세팅을 하며 웹서버를 구축하기 보다는 간편하게 해시 라우터를 사용하여 새로 고침 에러를 방지한 것이었다. 사실 이제서야 이런 부분에 대해 이해하게 되었다는 것이 조금 부끄럽기도 하다. 익숙하고 자연스럽다고 생각한 것들에 좀 더 ‘왜’라는 물음표를 자주 띄워야 겠다는 생각이 든다.&lt;/p&gt;</content:encoded></item></channel></rss>