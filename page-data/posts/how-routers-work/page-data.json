{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/how-routers-work","result":{"data":{"markdownRemark":{"id":"5982628a-fa7f-5f9d-859b-3650762e5008","html":"<p>이 글에서는 SPA에서 사용하는 라우터의 동작 원리를 살펴보며 바닐라 JS로 구현한다면 어떻게 구현할지 고민해볼 것이다. 하지만 구체적인 구현은 하지 않을 것이니 참고해주길 😇</p>\n<h2 id=\"router의-동작방식\" style=\"position:relative;\"><a href=\"#router%EC%9D%98-%EB%8F%99%EC%9E%91%EB%B0%A9%EC%8B%9D\" aria-label=\"router의 동작방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Router의 동작방식</h2>\n<ul>\n<li>URL을 변경한다.</li>\n<li>URL의 변경을 클라이언트에서 감지한다.</li>\n<li>변경된 URL에 맞춰 렌더링 해야 할 컴포넌트를 찾고 화면에 그린다.</li>\n</ul>\n<p>꽤나 단순하지 않은가? URL에 따라 렌더링 해야할 컴포넌트를 맵핑해 놓고 URL의 변경을 감지하여 그에 맞는 화면을 보여주는 것이다.</p>\n<p>따라서 라우팅 시스템은 <strong>두 가지의 핵심 요소</strong>를 가진다.</p>\n<ul>\n<li>어플리케이션의 경로 목록을 수집하는 레지스트리</li>\n<li>URL의 리스너</li>\n</ul>\n<p>레지스트리를 정말 단순한 형태로 만들어 본다면 다음과 같겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 어플리케이션 경로 목록을 수집하는 레지스트리로, URL에 따라 구성요소를 맵핑한 객체</span>\n<span class=\"token keyword\">const</span> routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token constant\">URL_A</span><span class=\"token operator\">:</span> ComponentA<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">URL_B</span><span class=\"token operator\">:</span> ComponentB<span class=\"token punctuation\">,</span>\n\t<span class=\"token constant\">URL_C</span><span class=\"token operator\">:</span> ComponentC<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 예시에서 URL에 해당하는 key값을 어떤 형태로 사용할 것인가, (해시가 붙어있는 형태로 사용할 것인가? 아닌가?)에 따라 해시 라우터와 브라우저 라우터로 나뉘며 그에 따라 URL 리스너도 달라진다.\n<br /><br /></p>\n<h2 id=\"해시-라우터의-경우\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EC%8B%9C-%EB%9D%BC%EC%9A%B0%ED%84%B0%EC%9D%98-%EA%B2%BD%EC%9A%B0\" aria-label=\"해시 라우터의 경우 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해시 라우터의 경우</h2>\n<p>해시로 시작하는 선택적 부분을 <code class=\"language-text\">프래그먼트 식별자</code>라고 부르는데, 이 값을 key 값으로 사용한다고 보면 된다. 프래그먼트 식별자는 location 객체의 hash 속성에 저장되기 때문에 <code class=\"language-text\">window.location.hash</code>를 통해 그 값을 가져올 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 898px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf029731536c7494bf6701074787ff5c/84cc5/location-hash.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4ElEQVQY05WNS1LEMAxEfYUcgNj54nz8jR3HkxmKFcX9L9SUVQPDYhaweNUtqSWxEA94H7GsBilfceQbat6gqipwXpM6H5HPNxgbyJ/Xd7hthzae+mUvpgvmRYOFmLCFROGYToT9QuFpXlFmTdNT0NiNnv7206zoaEFpBzmtYJuPOPYM7xxidLBWI+cIYy3mxaAfJLr+FW03kj78+OO/KTVTe0L4+ISKHkaNUEpCa4lxHPBStxBNTzTt8NSL9s69Zp1cwKcFfJCoeQcuetT8yeIfYVx0ELyFKErNh5bZf/kCUqmwSMurXNsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cf029731536c7494bf6701074787ff5c/8ac56/location-hash.webp 240w,\n/static/cf029731536c7494bf6701074787ff5c/d3be9/location-hash.webp 480w,\n/static/cf029731536c7494bf6701074787ff5c/005c4/location-hash.webp 898w\"\n              sizes=\"(max-width: 898px) 100vw, 898px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cf029731536c7494bf6701074787ff5c/8ff5a/location-hash.png 240w,\n/static/cf029731536c7494bf6701074787ff5c/e85cb/location-hash.png 480w,\n/static/cf029731536c7494bf6701074787ff5c/84cc5/location-hash.png 898w\"\n            sizes=\"(max-width: 898px) 100vw, 898px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cf029731536c7494bf6701074787ff5c/84cc5/location-hash.png\"\n            alt=\"window.location.hash\"\n            title=\"window.location.hash\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>페이지를 이동하고 싶을 때는 앵커 태그를 이용해서 URL 변경한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#/<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Go To Index</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#/list<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Go To List</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#/detail<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Go To Detail</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>그리고 <strong>hashChange</strong>라는 이벤트를 통해서 프래그먼트가 변경될 때마다 알림을 받을 수 있다. <strong>즉 해시 라우터의 URL 리스너는 hashChange 이벤트다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hashChange'</span><span class=\"token punctuation\">,</span> checkRoutes<span class=\"token punctuation\">)</span> </code></pre></div>\n<p>프래그먼트가 바뀔 때마다 <code class=\"language-text\">checkRoutes</code> 함수가 동작할 것이고, <code class=\"language-text\">checkRoutes</code> 내부에서는 프래그먼트가 레지스트리에 있는지 확인한 뒤 그에 맞는 구성요소를 렌더링한다.\n<br /><br /></p>\n<h2 id=\"브라우저-라우터의-경우에는\" style=\"position:relative;\"><a href=\"#%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EB%9D%BC%EC%9A%B0%ED%84%B0%EC%9D%98-%EA%B2%BD%EC%9A%B0%EC%97%90%EB%8A%94\" aria-label=\"브라우저 라우터의 경우에는 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>브라우저 라우터의 경우에는</h2>\n<p><code class=\"language-text\">window.location.pathname</code>을 key 값으로 사용한다.</p>\n<p>페이지를 이동하고 싶을 때는 HTML5에서 등장한 <a href=\"https://developer.mozilla.org/ko/docs/Web/API/History_API\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">History API</a>를 사용하여 URL을 변경한다. 주요 메서드는 다음과 같다.</p>\n<ul>\n<li><code class=\"language-text\">back()</code> :  히스토리에서 이전 페이지로 이동한다.</li>\n<li><code class=\"language-text\">forward()</code>: 히스토리에서 다음 페이지로 이동한다.</li>\n<li><code class=\"language-text\">go(index)</code>: 히스토리에서 특정 페이지로 이동한다.</li>\n<li><code class=\"language-text\">pushState(state, title, URL)</code>: 히스토리 스택의 데이터를 푸시하고 제공된 URL로 이동한다.</li>\n<li><code class=\"language-text\">replaceState(state, title, URL)</code>: 히스토리 스택에서 가장 최근 데이터를 바꾸고 제공된 URL로 이동한다.</li>\n</ul>\n<p><strong><a href=\"https://developer.mozilla.org/ko/docs/Web/API/Window/popstate_event\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">popState</a></strong> 이벤트는 브라우저의 뒤로가기/앞으로가기 버튼을 클릭하거나, <strong><code class=\"language-text\">pushState()</code></strong> 또는 <strong><code class=\"language-text\">replaceState()</code></strong> 메서드를 호출하여 URL을 업데이트할 때 발생하며 브라우저 라우터의 URL 리스너로 사용된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'popState'</span><span class=\"token punctuation\">,</span> checkRoutes<span class=\"token punctuation\">)</span> </code></pre></div>\n<p>URL이 업데이트 될 때마다 <code class=\"language-text\">checkRoutes</code> 함수가 동작하고, 해시 라우터에서와 마찬가지로 <code class=\"language-text\">checkRoutes</code> 내부에서는 프래그먼트가 레지스트리에 있는지 확인한 뒤 그에 맞는 구성요소를 렌더링한다.\n<br /><br /></p>\n<h2 id=\"또-다른-방법은-없을까\" style=\"position:relative;\"><a href=\"#%EB%98%90-%EB%8B%A4%EB%A5%B8-%EB%B0%A9%EB%B2%95%EC%9D%80-%EC%97%86%EC%9D%84%EA%B9%8C\" aria-label=\"또 다른 방법은 없을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>또 다른 방법은 없을까?</h2>\n<p>또 다른 URL 리스너의 형태로는 <code class=\"language-text\">setInterval</code>을 사용하는 방법이 있다. 주기적으로 pathname이 변경되었는지를 확인하고, 변경 되었으면 그에 맞는 구성요소를 렌더링 하는 것이다. 그러나 이 방식은 정확도가 떨어져 권장되지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">!==</span> previousPathname<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pathname changed to '</span> <span class=\"token operator\">+</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    previousPathname <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<h3 id=\"참고사항\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%82%AC%ED%95%AD\" aria-label=\"참고사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고사항</h3>\n<p>라우터에 관련한 추가적인 참고사항으로는 History API는 IE 9 이하에서 지원되지 않아 모든 브라우저에서 지원되는 브라우저를 개발하기 위해서는 해시 라우터를 사용해야 한다는 점이 있다. 😇\n<br /></p>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<ul>\n<li>(도서) 프레임워크 없는 프론트엔드 개발, 프란세스코 스트라츨로 지음</li>\n<li><a href=\"https://fe-developers.kakaoent.com/2022/221124-router-without-library/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">라이브러리 없이 라우터(Router) 만들기 | 카카오엔터테인먼트 FE 기술블로그</a></li>\n</ul>","fields":{"slug":"/posts/2023-04-05---Router-동작방식-알아보기//posts/how-routers-work","tagSlugs":["/tag/router/"]},"frontmatter":{"date":"2023-04-05","description":"라우터는 어떤 원리로 동작하는 것일까?","tags":["Router"],"title":"Router 동작방식 알아보기","socialImage":null}}},"pageContext":{"slug":"/posts/2023-04-05---Router-동작방식-알아보기//posts/how-routers-work"}},"staticQueryHashes":["1342736242","251939775","401334301","63107425"]}